"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[980],{7980:(n,e,t)=>{t.r(e),t.d(e,{default:()=>nu});var r=t(698),i=t(5155),o=t(2115),l=t(5285),c=t(9757),d=t(5055),a=t(1522),s=t(3697);function u(){let n=(0,r._)(["\n  max-width: 500px;\n"]);return u=function(){return n},n}function p(){let n=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n"]);return p=function(){return n},n}function f(){let n=(0,r._)(["\n  display: flex;\n  width: 100%;\n  align-items: center;\n  justify-content: space-between;\n  background-color: var(--background-light);\n  border: ",";\n  border-radius: 8px;\n  padding: 8px;\n  cursor: pointer;\n"]);return f=function(){return n},n}function x(){let n=(0,r._)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n"]);return x=function(){return n},n}function h(){let n=(0,r._)(["\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  background-color: ",";\n"]);return h=function(){return n},n}function g(){let n=(0,r._)(["\n  cursor: pointer;\n"]);return g=function(){return n},n}function v(){let n=(0,r._)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  margin-bottom: 8px;\n"]);return v=function(){return n},n}function m(){let n=(0,r._)(["\n  padding: 8px;\n  padding-right: 36px;\n  border-radius: 8px;\n  background-color: var(--background-light);\n  border: 1px solid #ccc;\n  width: 100%;\n  height: 38px;\n"]);return m=function(){return n},n}function y(){let n=(0,r._)(["\n  position: absolute;\n  right: 10px;\n  color: var(--background-muted);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  pointer-events: none;\n"]);return y=function(){return n},n}function w(){let n=(0,r._)(["\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  margin-top: 4px;\n  padding: 4px;\n  list-style-type: none;\n  max-height: 150px;\n  overflow-y: auto;\n  background-color: #fff;\n"]);return w=function(){return n},n}function j(){let n=(0,r._)(["\n  padding: 4px 8px;\n  cursor: pointer;\n\n  &:hover {\n    background-color: #f1f1f1;\n  }\n"]);return j=function(){return n},n}let b=l.Ay.div(u()),k=l.Ay.div(p()),A=l.Ay.div.withConfig({shouldForwardProp:n=>"isSelected"!==n&&"color"!==n})(f(),n=>n.isSelected?"2px solid ".concat(n.color):"2px solid var(--background-light)"),_=l.Ay.div(x()),C=l.Ay.div(h(),n=>n.color),S=l.Ay.span.withConfig({shouldForwardProp:n=>"isSelected"!==n&&"color"!==n})(g()),E=l.Ay.div(v()),I=l.Ay.input(m()),D=l.Ay.div(y()),F=l.Ay.ul(w()),P=l.Ay.li(j()),M=()=>{let n=()=>Math.floor(100*Math.random()+155);return"rgb(".concat(n(),", ").concat(n(),", ").concat(n(),")")},z=n=>{let{classes:e,saveImage:t,activeClasses:r,saveClass:l,deleteClass:u,lastClickedImage:p,selectedDatasetIds:f,selectedImageIds:x,images:h}=n,[g,v]=(0,o.useState)([]),[m,y]=(0,o.useState)(""),[w,j]=(0,o.useState)([]),[z,L]=(0,o.useState)(!1),O=(0,o.useMemo)(()=>x.reduce((n,e)=>(h[e]&&(n[e]=h[e]),n),{}),[h,x]),B=(0,o.useMemo)(()=>{let n={};return Object.values(O).forEach(e=>{let t=e.classIds||"";t&&(n[t]=n[t]||{count:0,total:0},n[t].count+=1),n[t]=n[t]||{count:0,total:0},n[t].total+=1}),n},[O]);(0,o.useEffect)(()=>{v(r)},[r]);let K=(0,o.useCallback)(n=>{Object.keys(O).forEach(e=>{let r=O[e],i=(r.classIds||[]).includes(n.id);t({...r,id:e,classIds:i?[]:[n.id]})})},[O,t]);(0,o.useEffect)(()=>{let n=n=>{if(!z&&/^[1-9]$/.test(n.key)){let e=parseInt(n.key,10)-1;if(e>=0&&e<g.length){let n=r.find(n=>n.id===g[e]);n&&K(n)}}};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[K,g,z,r]);let W=n=>{if(null==n?void 0:n.id){let e={...n,imageIds:Array.from(new Set([...p?[p.id]:[],...x])),datasetIds:Array.from(new Set([...f]))};l(e),v(g.map(t=>t.id===n.id?e:t))}else if(null==n?void 0:n.name){let e={id:(0,s.A)(),name:n.name,color:M(),imageIds:Array.from(new Set([...p?[p.id]:[],...x])),datasetIds:Array.from(new Set([...f]))};l(e),v([...g,e.id])}y(""),j([])},N=n=>{u(n,x,f,!1),v(e=>e.filter(e=>e!==n)),(null==p?void 0:p.class)===n&&t(p.id,{class:""})},X=r.filter(n=>{var t;return!!(null===(t=e[n])||void 0===t?void 0:t.createdAt)}).sort((n,t)=>new Date(e[t].createdAt)-new Date(e[n].createdAt));return(0,i.jsxs)(b,{children:[(0,i.jsxs)(E,{children:[(0,i.jsx)(I,{type:"text",value:m,onChange:n=>{let t=n.target.value;y(t),j(Object.values(e).filter(n=>n.name.toLowerCase().startsWith(t.toLowerCase())&&!g.includes(n.id)))},onKeyDown:n=>{"Enter"===n.key&&(w.length>0?W(w[0]):m.trim()&&W({name:m.trim()}))},onFocus:()=>L(!0),onBlur:()=>L(!1),placeholder:"Type and add class"}),(0,i.jsx)(D,{children:(0,i.jsx)(a.eS,{})})]}),z&&w.length>0&&(0,i.jsx)(F,{children:w.map((n,e)=>(0,i.jsx)(P,{onMouseDown:n=>n.preventDefault(),onClick:()=>W(n),children:n.name},e))}),(0,i.jsx)(k,{children:X.map(n=>{let t=e[n]||{},r=B[n]||{count:0},o=r.count>0;return(0,i.jsxs)(A,{color:t.color,isSelected:o,onClick:()=>K(t),children:[(0,i.jsxs)(_,{children:[(0,i.jsx)(C,{color:t.color}),(0,i.jsx)("span",{children:t.name}),r.count>1&&(0,i.jsxs)("span",{children:["(",r.count,")"]})]}),(0,i.jsx)(S,{onClick:e=>{e.stopPropagation(),N(n)},children:(0,i.jsx)(c.g,{icon:d.Jyw})})]},n)})})]})};var L=t(3214),O=t(628);function B(){let n=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  width: 300px;\n  height: 100vh;\n  border-left: 1px solid #ccc;\n  overflow: hidden;\n"]);return B=function(){return n},n}function K(){let n=(0,r._)(["\n  padding: 16px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n"]);return K=function(){return n},n}function W(){let n=(0,r._)(["\n  display: flex;\n  flex-wrap: nowrap;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  width: 100%;\n"]);return W=function(){return n},n}function N(){let n=(0,r._)(["\n  display: inline-block;\n  margin-right: 4px;\n  max-width: calc(100% - 20px);\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"]);return N=function(){return n},n}function X(){let n=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  flex-grow: 1;\n  padding: 16px;\n  overflow-y: auto;\n"]);return X=function(){return n},n}function J(){let n=(0,r._)(["\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  overflow-y: auto;\n"]);return J=function(){return n},n}function R(){let n=(0,r._)(["\n  display: flex;\n  padding: 16px;\n  background: var(--background-muted);\n  flex-direction: column;\n  gap: 14px;\n  border-radius: 8px;\n"]);return R=function(){return n},n}function T(){let n=(0,r._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  border-radius: 8px;\n  border: 1px solid #D0DAE8;\n  background: var(--background-light);\n  padding: 8px;\n"]);return T=function(){return n},n}function U(){let n=(0,r._)(["\n  width: 28px;\n  height: 28px;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  display: ",";\n  align-items: center;\n  justify-content: center;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: normal;\n  color: var(--color-black);\n  background-color: var(--neutral-200);\n\n  & > svg + svg {\n    margin-left: -4px;\n  }\n"]);return U=function(){return n},n}function $(){let n=(0,r._)(["\n  width: 100%;\n  min-height: 80px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n  padding: 8px;\n  font-size: 14px;\n  font-family: Arial, sans-serif;\n  resize: none;\n"]);return $=function(){return n},n}function q(){let n=(0,r._)(["\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n"]);return q=function(){return n},n}function G(){let n=(0,r._)(["\n  flex: 1;\n  padding: 12px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n  cursor: pointer;\n  background-color: ",";\n  color: ",";\n  font-weight: ",";\n\n  &:hover {\n    background-color: var(--accent-hover);\n    color: white;\n  }\n"]);return G=function(){return n},n}function H(){let n=(0,r._)(["\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n"]);return H=function(){return n},n}function Q(){let n=(0,r._)(["\n  padding: 8px 12px;\n  border-radius: 16px;\n  white-space: nowrap;\n  background-color: ",";\n  color: ",";\n  border: 1px solid black;\n  cursor: ",";\n"]);return Q=function(){return n},n}let V=l.Ay.div(B()),Y=l.Ay.div(K()),Z=l.Ay.div(W()),nn=l.Ay.span(N()),ne=l.Ay.div(X()),nt=l.Ay.div(J()),nr=l.Ay.div(R()),ni=l.Ay.div(T()),no=l.Ay.button(U(),n=>{let{$isDrawerOpen:e}=n;return e?"none":"flex"}),nl=l.Ay.textarea($()),nc=l.Ay.div(q()),nd=l.Ay.button.withConfig({shouldForwardProp:n=>"isSelected"!==n})(G(),n=>{let{isSelected:e}=n;return e?"var(--accent-active)":"white"},n=>{let{isSelected:e}=n;return e?"white":"black"},n=>{let{isSelected:e}=n;return e?"bold":"normal"}),na=l.Ay.div(H()),ns=l.Ay.div.withConfig({shouldForwardProp:n=>"isActive"!==n})(Q(),n=>{let{isActive:e}=n;return e?"black":"white"},n=>{let{isActive:e}=n;return e?"white":"black"},n=>{let{isActive:e}=n;return e?"default":"pointer"});function nu(n){var e;let{isPropertyVisible:t,toggleDrawer:r,lastClickedImage:l,images:a,selectedDatasetIds:s,selectedImageIds:u,classes:p,activeClasses:f,saveClass:x,deleteClass:h,saveImage:g}=n,[v,m]=(0,o.useState)(null),{startLoading:y,stopLoading:w,setProgress:j,setLoadingStatus:b}=(0,L.A)(),[k,A]=(0,o.useState)((null===(e=l.properties)||void 0===e?void 0:e.description)||""),[_,C]=(0,o.useState)(l.comment||""),[S,E]=(0,o.useState)([]);(0,o.useEffect)(()=>{var n;A((null===(n=l.properties)||void 0===n?void 0:n.description)||""),C(l.comment||"")},[l]),(0,o.useEffect)(()=>{(async function(){try{let n=await (0,O.D)("feature_extract");E(n)}catch(n){console.error("Failed to fetch models:",n)}})()},[]);let I=n=>{m(e=>e===n?null:n)},D=async n=>{let e=Object.values(a).filter(e=>u.includes(e.id)&&(!e.model||!e.model[n.id]));if(0===e.length){alert("All selected images are already processed by this model.");return}y(),j(0),b("Starting inference...");try{(await F(e,n.id)).forEach(n=>{g(n)})}catch(n){console.error("Error during feature extraction:",n)}finally{w(),b("Done.")}},F=async function(n,e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=[],i=n.length;for(let o=0;o<Math.ceil(i/t);o++){let l=o*t,c=n.slice(l,l+t);for(let n=0;n<c.length;n++){let t=l+n,o=c[n];try{j(Math.round(t/i*100)),b("[".concat(t,"/").concat(i,"] Processing: ").concat(o.filename));let n=(await (0,O.nL)(e,o.id)).featureId;r.push({...o,model:{...o.model,[e]:n}})}catch(n){console.error("Failed to process image ".concat(o.id,":"),n)}}}return r},P=(0,o.useMemo)(()=>{let n={};return S.length&&(S.forEach(e=>{n[e.id]={name:e.name,total:u.length,notPredicted:0}}),u.forEach(e=>{let t=a[e];if(!t||!t.model){S.forEach(e=>{n[e.id].notPredicted+=1});return}S.forEach(e=>{t.model[e.id]||(n[e.id].notPredicted+=1)})})),n},[u,a,S]);return(0,i.jsxs)(V,{children:[(0,i.jsxs)(Y,{children:[(0,i.jsx)(no,{onClick:r,children:t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.g,{icon:d.XkK}),(0,i.jsx)(c.g,{icon:d.XkK})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.g,{icon:d.Wzs}),(0,i.jsx)(c.g,{icon:d.Wzs})]})}),(0,i.jsx)("h1",{children:"Property"})]}),(0,i.jsx)(ne,{children:(0,i.jsxs)(nt,{children:[(0,i.jsxs)(nr,{children:[(0,i.jsx)("h3",{children:"Filename"}),(0,i.jsx)(ni,{children:(0,i.jsxs)(Z,{children:[u.slice(0,3).map((n,e)=>{let t=a[n];return(0,i.jsxs)(nn,{children:[(null==t?void 0:t.filename)||"Unknown",e<u.slice(0,3).length-1?", ":""]},n)}),u.length>5&&(0,i.jsxs)(nn,{children:["+",u.length-5," more"]})]})})]}),(0,i.jsxs)(nr,{children:[(0,i.jsx)("h3",{children:"Class"}),(0,i.jsx)(z,{classes:p,saveImage:g,activeClasses:f,saveClass:x,deleteClass:h,selectedDatasetIds:s,selectedImageIds:u,images:a,lastClickedImage:l})]}),(0,i.jsxs)(nr,{children:[(0,i.jsx)("h3",{children:"Inference By"}),(0,i.jsx)(na,{children:S.length>0&&Object.entries(P).map(n=>{let[e,{name:t,total:r,notPredicted:o}]=n;return(0,i.jsxs)(ns,{isActive:0===o,onClick:()=>{if(o>0){let n=S.find(n=>n.id===e);n&&D(n)}},children:[t," (",r-o,"/",r,")"]},e)})})]}),(0,i.jsxs)(nr,{children:[(0,i.jsx)("h3",{children:"Description"}),(0,i.jsx)(nl,{value:k,onChange:n=>A(n.target.value),onBlur:()=>{let n={...l.properties,description:k};g({...l,properties:n})}})]}),(0,i.jsxs)(nr,{children:[(0,i.jsx)("h3",{children:"Memo"}),(0,i.jsx)(nl,{value:_,onChange:n=>C(n.target.value),onBlur:()=>{g({...l,comment:_})}})]}),(0,i.jsxs)(nr,{children:[(0,i.jsx)("h3",{children:"Approval"}),(0,i.jsxs)(nc,{children:[(0,i.jsx)(nd,{isSelected:"approve"===v,onClick:()=>I("approve"),children:"Approve"}),(0,i.jsx)(nd,{isSelected:"reject"===v,onClick:()=>I("reject"),children:"Reject"})]})]})]})})]})}}}]);