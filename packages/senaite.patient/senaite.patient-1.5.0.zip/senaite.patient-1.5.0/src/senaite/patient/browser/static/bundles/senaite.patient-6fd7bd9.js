!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/++plone++senaite.patient.static/bundles",r(r.s=1)}([function(e,t){e.exports=jQuery},function(e,t,r){e.exports=r(2)},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,o=void 0,o=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===a(o)?o:String(o)),n)}var i,o}var u=[].indexOf,l=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset_temporary_identifiers=this.reset_temporary_identifiers.bind(this),this.set_patient_data=this.set_patient_data.bind(this),this.on_temporary_change=this.on_temporary_change.bind(this),this.on_mrn_deselected=this.on_mrn_deselected.bind(this),this.on_mrn_selected=this.on_mrn_selected.bind(this),this.get_input_element=this.get_input_element.bind(this),this.get_field_name=this.get_field_name.bind(this),this.get_sibling=this.get_sibling.bind(this),this.set_sibling_value=this.set_sibling_value.bind(this),this.native_set_value=this.native_set_value.bind(this),this.format_date=this.format_date.bind(this),this.search_patient=this.search_patient.bind(this),this.ajax_submit=this.ajax_submit.bind(this),this.get_portal_url=this.get_portal_url.bind(this),this.debug=this.debug.bind(this),console.debug("TemporaryIdentifierWidget::load"),this.auto_wildcard="-- autogenerated --",this.is_add_sample_form=document.body.classList.contains("template-ar_add"),this.is_add_sample_form&&this.reset_temporary_identifiers(),i()("body").on("change",".TemporaryIdentifier input[type='checkbox']",this.on_temporary_change),i()("body").on("select",".TemporaryIdentifier",this.on_mrn_selected),i()("body").on("deselect",".TemporaryIdentifier",this.on_mrn_deselected),this}var t,r,n;return t=e,(r=[{key:"reset_temporary_identifiers",value:function(){var e=this;return this.debug("TemporaryIdentifierWidget::reset_temporary_identifiers"),document.querySelectorAll(".TemporaryIdentifier").forEach((function(t,r){var n,i,a;if((a=t.querySelector("input[name*='_temporary']")).checked)return a.checked=!1,n=t.querySelector("input[name*='_value_auto']"),e.native_set_value(n,""),i=t.querySelector("textarea"),e.native_set_value(i,"")}))}},{key:"set_patient_data",value:function(e,t){var r,n,i,a;for(r in n={MedicalRecordNumber:"","PatientFullName.firstname":"","PatientFullName.lastname":"",PatientAddress:"","DateOfBirth.dob":"",Age:"",Sex:"",Gender:""},i=[],n=Object.assign(n,t))a=n[r],i.push(this.set_sibling_value(e,r,a));return i}},{key:"on_temporary_change",value:function(e){var t,r,n,i;return this.debug("°°° TemporaryIdentifierWidget::on_temporary_change °°°"),t=e.currentTarget,r=this.get_field_name(t),i=t.checked,n=this.get_input_element(r),i&&!n.value?this.native_set_value(n,this.auto_wildcard):i||n.value!==this.auto_wildcard?void 0:this.native_set_value(n,"")}},{key:"on_mrn_deselected",value:function(e){var t,r;return this.debug("°°° TemporaryIdentifierWidget::on_mrn_deselected °°°"),t=e.currentTarget,r=this.get_field_name(t),document.getElementById("".concat(r,"_temporary")).checked=!1,this.set_patient_data(t,{})}},{key:"on_mrn_selected",value:function(e){var t,r,n=this;if(this.debug("°°° TemporaryIdentifierWidget::on_mrn_selected °°°"),e.currentTarget,(r=e.detail.value)!==this.auto_wildcard)return t=e.currentTarget,this.search_patient({patient_mrn:r}).done((function(e){var r,i,a;if(e)return r=[(i=e.address[0]).address,i.zip,i.city,i.country].filter((function(e){return e})).join(", "),e.address_line=r,a={MedicalRecordNumber:e.mrn,"PatientFullName.firstname":e.firstname,"PatientFullName.lastname":e.lastname,PatientAddress:r,"DateOfBirth.dob":n.format_date(e.birthdate),Age:e.age,Sex:e.sex,Gender:e.gender,review_state:e.review_state},n.set_patient_data(t,a)}))}},{key:"get_input_element",value:function(e){return document.querySelector("#".concat(e," textarea"))}},{key:"get_field_name",value:function(e){var t;return t=e.closest("div[data-fieldname]"),i()(t).attr("data-fieldname")}},{key:"get_sibling",value:function(e,t){var r,n,a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return r=t,this.is_add_sample_form&&(n=e.closest("td[arnum]"),r=t+"-"+i()(n).attr("arnum")),a='[name="'+r+'"]',""!==o&&(a='[name^="'+(r=r+"."+o)+':"]'),document.querySelector(a)}},{key:"set_sibling_value",value:function(e,t,r){var n,i,a;if(this.debug("°°° TemporaryIdentifierWidget::set_sibling_value:name=".concat(t,",value=").concat(r," °°°")),a="",u.call(t,".")>=0&&(i=t.split("."),t=i[0],a=i[1]),n=this.get_sibling(e,t,a))return this.debug(">>> ".concat(n.name," = ").concat(r," ")),this.native_set_value(n,r)}},{key:"native_set_value",value:function(e,t){var r,n;return n=null,"TEXTAREA"===e.tagName?n=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set:"SELECT"===e.tagName?n=Object.getOwnPropertyDescriptor(window.HTMLSelectElement.prototype,"value").set:"INPUT"===e.tagName?n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set:e.value=t,n&&n.call(e,t),r=new Event("input",{bubbles:!0}),e.dispatchEvent(r)}},{key:"format_date",value:function(e){var t;return null==e?"":[(t=new Date(e)).getFullYear(),("0"+(t.getMonth()+1)).slice(-2),("0"+t.getDate()).slice(-2)].join("-")}},{key:"search_patient",value:function(e){var t,r,n;return this.debug("°°° TemporaryIdentifierWidget::search_patient °°°"),t={portal_type:"Patient",catalog_name:document.querySelector('[name="config_catalog"]').value,include_fields:["mrn","firstname","lastname","age","birthdate","sex","gender","email","address","review_state"],page_size:1},t=Object.assign(t,e),r=i.a.Deferred(),n={url:this.get_portal_url()+"/@@API/read",data:t},this.ajax_submit(n).done((function(e){var t;return t={},e.objects&&(t=e.objects[0]),r.resolveWith(this,[t])})),r.promise()}},{key:"ajax_submit",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.debug("°°° TemporaryIdentifierWidget::ajax_submit °°°"),null==t.type&&(t.type="POST"),null==t.url&&(t.url=this.get_portal_url()),null==t.context&&(t.context=this),null==t.dataType&&(t.dataType="json"),null==t.data&&(t.data={}),null==t._authenticator&&(t._authenticator=i()("input[name='_authenticator']").val()),console.debug(">>> ajax_submit::options=",t),i()(this).trigger("ajax:submit:start"),e=function(){return i()(this).trigger("ajax:submit:end")},i.a.ajax(t).done(e)}},{key:"get_portal_url",value:function(){return i()("input[name=portal_url]").val()||window.portal_url}},{key:"debug",value:function(e){return console.debug("[senaite.patient.temporary_identifier_widget] ",e)}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,a=void 0,a=function(e,t){if("object"!==s(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===s(a)?a:String(a)),n)}var i,a}var c=function(){function e(){var t,r,n,a;for(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bind_event_handler=this.bind_event_handler.bind(this),this.on_age_selector_change=this.on_age_selector_change.bind(this),this.on_fallback_dob_change=this.on_fallback_dob_change.bind(this),console.debug("AgeDoBWidgetController::load"),this.bind_event_handler(),".AgeDoBWidget input[type='radio'][checked]",r=0,n=(a=document.querySelectorAll(".AgeDoBWidget input[type='radio'][checked]")).length;r<n;r++)t=a[r],i()(t).trigger("change");return this}var t,r,n;return t=e,(r=[{key:"bind_event_handler",value:function(){var e;return console.debug("AgeDoBWidgetController::bind_event_handler"),e=".AgeDoBWidget input[type='radio']",i()("body").on("change",e,this.on_age_selector_change),e=".AgeDoBWidget input[id$='-dob-fallback']",i()("body").on("change",e,this.on_fallback_dob_change)}},{key:"on_age_selector_change",value:function(e){var t,r,n,a,o,u,l,s;return console.debug("AgeDoBWidgetController::on_age_selector_change"),l=(a=e.currentTarget).closest(".AgeDoBWidget"),u=null!=(o="1"===i()(l).attr("data-required"))?o:{required:""},t=l.querySelector('[id$="_age_controls"]'),r=l.querySelector('[id$="_dob_controls"]'),s=l.querySelector('[id$=".years:ignore_empty:record"]'),n=l.querySelector('[id$=".dob:ignore_empty:record"]'),"age"===i()(a).val()?(i()(t).show(),i()(r).hide(),s.setAttribute("required",u),n.removeAttribute("required")):(i()(t).hide(),i()(r).show(),s.removeAttribute("required"),n.setAttribute("required",u))}},{key:"on_fallback_dob_change",value:function(e){var t,r,n;return console.debug("AgeDoBWidgetController::on_fallback_dob_change"),(t=(n=(r=e.currentTarget).closest(".AgeDoBWidget")).querySelector("input[id$='_dob_selector']")).setAttribute("checked",""),i()(t).trigger("change"),n.querySelector('[id$=".dob:ignore_empty:record"]').value=r.value}}])&&d(t.prototype,r),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();document.addEventListener("DOMContentLoaded",(function(){console.debug("*** SENAITE PATIENT JS LOADED ***"),window.temporary_identifier_widget=new l,window.age_dob_widget=new c}))}]);