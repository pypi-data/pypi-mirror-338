container_id: null
date_created: "2025-03-27T16:19:48.828683"
desc: ""
env_vars: { PLURALLY_PUBLIC_OUTPUT_LANGUAGE: French }
flow_json:
  _inter_subflow_run_links: {}
  directed: true
  graph: {}
  id: fl-805e072c-064f-430c-9b21-22d5efa16042
  links:
    - {
        key: compte_rendu###audio,
        label: Compte rendu -> Audio,
        source: nd-806a16b4-7c25-49e3-a63c-8c4b73ee21b5,
        src_handle: compte_rendu,
        target: nd-59399c98-bd9d-4ca9-821a-77f715b5bbd3,
        tgt_handle: audio,
      }
    - {
        key: catégorie###query,
        label: Catégorie -> Query,
        source: nd-806a16b4-7c25-49e3-a63c-8c4b73ee21b5,
        src_handle: catégorie,
        target: nd-faf71e16-05fd-4d6e-87cd-6045a15d7c00,
        tgt_handle: query,
      }
    - {
        key: report###report,
        label: report -> report,
        source: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        src_handle: report,
        target: nd-6beb29b6-96e3-43b7-bfff-f8c0d2f5ff80,
        tgt_handle: report,
      }
    - {
        key: transcript###transcript,
        label: Transcript -> transcript,
        source: nd-59399c98-bd9d-4ca9-821a-77f715b5bbd3,
        src_handle: transcript,
        target: nd-2e699a47-f3d2-44e3-b1a4-e4aeb7dcdc54,
        tgt_handle: transcript,
      }
    - {
        key: transcript###transcript,
        label: Transcript -> transcript,
        source: nd-59399c98-bd9d-4ca9-821a-77f715b5bbd3,
        src_handle: transcript,
        target: nd-e634a716-cc90-4437-add7-0f05c6b41460,
        tgt_handle: transcript,
      }
    - {
        key: values###table,
        label: Values -> Table,
        source: nd-b92ebef0-bad5-492d-9785-6d2c03cbda28,
        src_handle: values,
        target: nd-74780aeb-767b-47ca-b011-62ad25f9f4c2,
        tgt_handle: table,
      }
    - {
        key: values###vocabulary,
        label: Values -> vocabulary,
        source: nd-fbf71c70-04cf-4e21-ba31-43a51cd117f0,
        src_handle: values,
        target: nd-2e699a47-f3d2-44e3-b1a4-e4aeb7dcdc54,
        tgt_handle: vocabulary,
      }
    - {
        key: corrected_transcript###content,
        label: corrected_transcript -> Content,
        source: nd-2e699a47-f3d2-44e3-b1a4-e4aeb7dcdc54,
        src_handle: corrected_transcript,
        target: nd-b0561d56-4ae3-48be-87c5-ed0529cbd1ad,
        tgt_handle: content,
      }
    - {
        key: corrected_transcript###transcript,
        label: corrected_transcript -> transcript,
        source: nd-2e699a47-f3d2-44e3-b1a4-e4aeb7dcdc54,
        src_handle: corrected_transcript,
        target: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        tgt_handle: transcript,
      }
    - {
        key: values###table,
        label: Values -> Table,
        source: nd-faf71e16-05fd-4d6e-87cd-6045a15d7c00,
        src_handle: values,
        target: nd-0e9124f3-31d5-4ccf-9269-148b735307c3,
        tgt_handle: table,
      }
    - {
        key: values###table,
        label: Values -> Table,
        source: nd-faf71e16-05fd-4d6e-87cd-6045a15d7c00,
        src_handle: values,
        target: nd-8231f361-7376-47a5-a67f-46bab03abd13,
        tgt_handle: table,
      }
    - {
        key: values###knowledge,
        label: Values -> Knowledge,
        source: nd-446f3480-90a9-45dc-aa39-50cd90edef31,
        src_handle: values,
        target: nd-faf71e16-05fd-4d6e-87cd-6045a15d7c00,
        tgt_handle: knowledge,
      }
    - {
        key: formatted_text###template,
        label: Formatted Text -> template,
        source: nd-0e9124f3-31d5-4ccf-9269-148b735307c3,
        src_handle: formatted_text,
        target: nd-194a358a-09f9-4057-aa18-fe8ef9368feb,
        tgt_handle: template,
      }
    - {
        key: formatted_text###template,
        label: Formatted Text -> template,
        source: nd-0e9124f3-31d5-4ccf-9269-148b735307c3,
        src_handle: formatted_text,
        target: nd-0291f3bc-dbc1-4aec-b705-cd0fed5f22a4,
        tgt_handle: template,
      }
    - {
        key: values###acronyms,
        label: Values -> acronyms,
        source: nd-a4d74224-9c19-47b9-bf38-ed15ed4c148b,
        src_handle: values,
        target: nd-2e699a47-f3d2-44e3-b1a4-e4aeb7dcdc54,
        tgt_handle: acronyms,
      }
    - {
        key: values###acronyms,
        label: Values -> acronyms,
        source: nd-a4d74224-9c19-47b9-bf38-ed15ed4c148b,
        src_handle: values,
        target: nd-6beb29b6-96e3-43b7-bfff-f8c0d2f5ff80,
        tgt_handle: acronyms,
      }
    - {
        key: report###previous_run,
        label: Report -> previous_run,
        source: nd-c1e190a6-7b01-4458-9737-c9f7cc1eac85,
        src_handle: report,
        target: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        tgt_handle: previous_run,
      }
    - {
        key: transcript###previous_transcript,
        label: Transcript -> previous_transcript,
        source: nd-c1e190a6-7b01-4458-9737-c9f7cc1eac85,
        src_handle: transcript,
        target: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        tgt_handle: previous_transcript,
      }
    - {
        key: template###template_saved,
        label: Template -> template_saved,
        source: nd-c1e190a6-7b01-4458-9737-c9f7cc1eac85,
        src_handle: template,
        target: nd-194a358a-09f9-4057-aa18-fe8ef9368feb,
        tgt_handle: template_saved,
      }
    - {
        key: report###report,
        label: Report -> report,
        source: nd-c1e190a6-7b01-4458-9737-c9f7cc1eac85,
        src_handle: report,
        target: nd-0291f3bc-dbc1-4aec-b705-cd0fed5f22a4,
        tgt_handle: report,
      }
    - {
        key: template_category###template_category_saved,
        label: Template Category ->
          template_category_saved,
        source: nd-c1e190a6-7b01-4458-9737-c9f7cc1eac85,
        src_handle: template_category,
        target: nd-85a43d42-b39c-42d2-9df6-635bfc05a309,
        tgt_handle: template_category_saved,
      }
    - {
        key: formatted_text###content,
        label: Formatted Text -> Content,
        source: nd-194a358a-09f9-4057-aa18-fe8ef9368feb,
        src_handle: formatted_text,
        target: nd-00a860f2-9619-453e-81a9-1e9eebe7c27b,
        tgt_handle: content,
      }
    - {
        key: formatted_text###template,
        label: Formatted Text -> template,
        source: nd-194a358a-09f9-4057-aa18-fe8ef9368feb,
        src_handle: formatted_text,
        target: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        tgt_handle: template,
      }
    - {
        key: formatted_text###previous_content,
        label: Formatted Text -> Previous Content,
        source: nd-0291f3bc-dbc1-4aec-b705-cd0fed5f22a4,
        src_handle: formatted_text,
        target: nd-c319a4d2-8140-464a-902e-1d9416b676a3,
        tgt_handle: previous_content,
      }
    - {
        key: formatted_text###examples,
        label: Formatted Text -> examples,
        source: nd-bb98af3e-61c7-4f7b-87b5-7908cb1f5b2d,
        src_handle: formatted_text,
        target: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        tgt_handle: examples,
      }
    - {
        key: formatted_text###category,
        label: Formatted Text -> category,
        source: nd-8231f361-7376-47a5-a67f-46bab03abd13,
        src_handle: formatted_text,
        target: nd-26430211-b1c7-41b2-88a0-7092adc9cfe0,
        tgt_handle: category,
      }
    - {
        key: formatted_text###content,
        label: Formatted Text -> Content,
        source: nd-26430211-b1c7-41b2-88a0-7092adc9cfe0,
        src_handle: formatted_text,
        target: nd-138e918a-2d78-47f6-a43d-abfc196095b3,
        tgt_handle: content,
      }
    - {
        key: formatted_text###template_category,
        label: Formatted Text -> template_category,
        source: nd-26430211-b1c7-41b2-88a0-7092adc9cfe0,
        src_handle: formatted_text,
        target: nd-85a43d42-b39c-42d2-9df6-635bfc05a309,
        tgt_handle: template_category,
      }
    - {
        key: formatted_text###template_category,
        label: Formatted Text -> template_category,
        source: nd-85a43d42-b39c-42d2-9df6-635bfc05a309,
        src_handle: formatted_text,
        target: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5,
        tgt_handle: template_category,
      }
    - {
        key: corrected_report###report,
        label: corrected_report -> report,
        source: nd-6beb29b6-96e3-43b7-bfff-f8c0d2f5ff80,
        src_handle: corrected_report,
        target: nd-e634a716-cc90-4437-add7-0f05c6b41460,
        tgt_handle: report,
      }
    - {
        key: corrected_report###content,
        label: corrected_report -> Content,
        source: nd-e634a716-cc90-4437-add7-0f05c6b41460,
        src_handle: corrected_report,
        target: nd-c319a4d2-8140-464a-902e-1d9416b676a3,
        tgt_handle: content,
      }
  multigraph: true
  name: ""
  nodes:
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-806a16b4-7c25-49e3-a63c-8c4b73ee21b5
        button_color: "#3b41cc"
        button_on_same_row: false
        button_text: Valider
        form:
          - col_span: 12
            is_only_first_run: true
            is_required: true
            name: Catégorie
            options:
              [
                COMPTE RENDU STANDARD,
                CESARIENNE,
                SDTE,
                OEDEME DE QUINCKE,
                PIROPLASMOSE,
                ENTEROTOMIE,
                CHENILLES PROCESSIONNAIRES,
                EPILLET OREILLE,
                EPILLET NEZ,
                PYOMETRE,
              ]
            placeholder: ""
            type: select
          - col_span: 12
            is_only_first_run: false
            is_required: true
            name: Compte rendu
            options: []
            placeholder: ""
            type: audio record
        is_output_fixable: false
        is_trigger: true
        kls: Form
        name: Initialisation
        output_schema:
          $defs:
            MicAudioFile:
              properties:
                content:
                  anyOf:
                    - { format: binary, type: string }
                    - { type: "null" }
                  default: null
                  description: The content of the audio file
                  title: Content
                  uiSchema: { ui:widget: hidden }
                file:
                  accept: audio/*
                  is-file: true
                  minLength: 1
                  title: record_audio_title
                  type: string
                  uiExampleSchema: { ui:widget: file }
                  uiSchema:
                    errorMessages:
                      { minLength: Please finish recording some audio first }
                    ui:widget: AudioRecorderWidget
                filename:
                  anyOf:
                    - { type: string }
                    - { type: "null" }
                  default: null
                  description: The name of the audio file
                  title: Filename
                  uiSchema: { ui:widget: hidden }
              required: [file]
              title: MicAudioFile
              type: object
              type-friendly: Audio
              uiSchema:
                ui:options: { label: false }
          properties:
            catégorie:
              enum:
                [
                  COMPTE RENDU STANDARD,
                  CESARIENNE,
                  SDTE,
                  OEDEME DE QUINCKE,
                  PIROPLASMOSE,
                  ENTEROTOMIE,
                  CHENILLES PROCESSIONNAIRES,
                  EPILLET OREILLE,
                  EPILLET NEZ,
                  PYOMETRE,
                ]
              title: Catégorie
              type: string
              uiSchema: { ui:label: true, ui:placeholder: "" }
            compte_rendu:
              file_label_override: Compte rendu
              properties:
                content:
                  anyOf:
                    - { format: binary, type: string }
                    - { type: "null" }
                  default: null
                  description: The content of the audio file
                  title: Content
                  uiSchema: { ui:widget: hidden }
                file:
                  accept: audio/*
                  is-file: true
                  minLength: 1
                  title: record_audio_title
                  type: string
                  uiExampleSchema: { ui:widget: file }
                  uiSchema:
                    errorMessages:
                      { minLength: Please finish recording some audio first }
                    ui:widget: AudioRecorderWidget
                filename:
                  anyOf:
                    - { type: string }
                    - { type: "null" }
                  default: null
                  description: The name of the audio file
                  title: Filename
                  uiSchema: { ui:widget: hidden }
              required: [file]
              title: Compte rendu
              type: object
              type-friendly: Record Audio
              uiSchema: { ui:label: true, ui:placeholder: "" }
          required: [catégorie, compte_rendu]
          title: Form
          type: object
          uiSchema:
            ui:grid:
              - [catégorie, 12]
              - [compte_rendu, 12]
        pos_x: 994.5
        pos_y: 0.0
        show_label: true
        src_handles: [catégorie, compte_rendu]
        tgt_handles: []
        use_case: true
    - id:
        PLURALLY_VERSION: 1
        _node_id: nd-9a9fa721-0e59-4830-a6a4-e4b9af98dfb5
        add_explanation: false
        examples: ""
        general_info: ""
        input_fields:
          - { free: transcript, handle_id: a5d9, type: Auto }
          - { free: template, handle_id: d34f, type: Auto }
          - { free: examples, handle_id: bd16, type: Auto }
          - { free: previous_run, handle_id: f60d, type: Auto }
          - { free: template_category, handle_id: "3653", type: Auto }
          - { free: previous_transcript, handle_id: 342a, type: Auto }
        input_schema:
          $defs:
            Auto:
              properties: {}
              title: Auto
              type: object
          additionalProperties: false
          can-add-fields: true
          properties:
            examples:
              handle_id: bd16
              properties: {}
              title: examples
              type: object
              type-friendly: Auto (BETA)
            previous_run:
              handle_id: f60d
              properties: {}
              title: previous_run
              type: object
              type-friendly: Auto (BETA)
            previous_transcript:
              handle_id: 342a
              properties: {}
              title: previous_transcript
              type: object
              type-friendly: Auto (BETA)
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
            template:
              handle_id: d34f
              properties: {}
              title: template
              type: object
              type-friendly: Auto (BETA)
            template_category:
              handle_id: "3653"
              properties: {}
              title: template_category
              type: object
              type-friendly: Auto (BETA)
            transcript:
              handle_id: a5d9
              properties: {}
              title: transcript
              type: object
              type-friendly: Auto (BETA)
          required:
            [
              transcript,
              template,
              examples,
              previous_run,
              template_category,
              previous_transcript,
            ]
          title: InputSchema
          type: object
        instruct: |-
          {%- set baseline = "Current Report State" if previous_run else "Template" %}
          # Plurally System Prompts

          ## Introduction
          You are a Veterinary Clinic AI-powered assistant, helping to generate **veterinary reports**.

          You are given a **Transcript** dictated by the veterinary after a consultation as well as a **{{baseline}}**.

          ## General Instructions
          - Always up-to-date with the latest veterinary reporting best practices.
          - Respond in the **same language as the input language**.
          - Use only the provided context—do not make assumptions or generate fictional information.

          ## General Informations
          {PLURALLY_GENERAL_INFO}

          ## Task Objective
          Given:
          - A **Transcript** dictated by the veterinary.
          - The **{{baseline}}** of the report.

          Your goal is to:
          - Modify the **{{baseline}}** based on the information in the **Transcript**.

          ## Rules

          1. **Keep All Information**
             - **Important**: **All details** mentioned in the **Transcript** must appear in the output report, even if no placeholder or section was planned in **{{baseline}}**
             - If some dosage (e.g. TID, SID) are mentioned keep them.
          {%- if template_category == "COMPTE RENDU STANDARD" %}
          2. **Fill Exams Or Remove**
             - If the **{{baseline}}** has placeholders for exams (e.g. "Analyse d'urine :"), and the veterinary gives results about them in the **Transcript**, fill them.
             - If the exams were not mentioned in the **Transcript**, then remove those from the **output report**.
             - If some sections end up being empty (e.g. no complementary exams / diagnostic), **remove the section title altogether**.
             - Remove "Examen de la cavétité de la cavité buccale" if there is no mention of it.
             - Reorder "Examens Complémentaires" bullet list in the order they are listed by the veterinary.
          {%- else %}
          2. **Sane Baseline**
             - Use the **{{baseline}}** as a **sane baseline**. **Keep all sections (including empty sections) intact**, unless the **Transcript** explicitly contradicts the **{{baseline}}**.
             - If conflicts arise between the **Transcript** and the **{{baseline}}**, what is in the **Transcript** should be used.
          {%- endif %}
          3. **Avoid Repetitions**
             - If some information is already present in the **{{baseline}}**, do not add it again.

          4. **Location Matters**
             - Information should be filled in the right place. If the veterinary dictates the temperature of the animal on the 2nd day of hospitalization in the morning, make sure to fill in the correct location, but do not change the temperature in other parts of the report.
             - If veterinary specifies where the information should be, for instance by preceding a sentence by "au niveau des examens complémentaires", then what comes after should be in the "Examens complémentaires" section. Sometimes the veterinary will switch to another section without specifying it. In that case, use your best judgement to detect that what is being dictated belongs to a different section and make changes accordingly.
          {%- if not previous_run %}
             - Generally, the beginning of the **Transcript** is about the ANAMNESE.
             - If a diagnostic is given in another part of the report (e.g. ANAMNSE or EXAMENS COMPLÉMENTAIRES), it should also be given in the DIAGNOSTIC.
          {%- endif %}
             - Only fill the tables in "Suivi d'hospitalisation"  when it is clear that the content is meant for these. I.e. if the veterinary mentions general observations in the **Transcript**, they should be included in the "Examen clinique" and not in the tables.</rule>

          5. **Formatting**
             - Avoid formatting and white space changes.

          6. **Empty Sections**
             - If a section ends up being empty, remove the section.

          7. **Placeholders**
             - Some placeholders are marked within parenthesis, for example `(traitement 1)`.
             - If a placeholder is not filled, remove it.

          8. **Professional Tone**
             - Rephrase to professional tone, making sure no information is lost, e.g. if veterinary says in **Transcript**: "I believe the animal could have been bitten by a dog", this should be rephrased as "Possible dog bite".
             - Use newlines rather than use long paragraphs, group information semantically, e.g. if the veterinary says in **Transcript**:
          ```plaintext
          L'animal était alerte et calme, il est ambulatoire, je n'ai pas observé de boiterie en consultation, pas non plus d'anomalies à l'examen orthopédique, je n'ai pas pu identifier de plaies sur les membres, se déplaçait normalement, il sautait sur la table de consultation et même depuis le sol sans difficulté. J'ai remarqué des griffes cassées et arrachées au niveau des membres pelviens, mais les griffes des membres thoraciques ne présentaient pas d'anomalies, hyperkératose des coussinets des membres thoraciques et absence d'anomalies des coussinets pelviens, selles et urines normales en consultation.
          ```
          The rephrased content in the **output report** should be
          ```plaintext
          Animal alerte et calme.

          Ambulatoire (absence de boiterie en consultation). Déplacement normal (sautait sur la table de consultation depuis le sol sans difficulté).

          Absence d'anomalies à l'examen orthopédique. Pas de plaies sur les membres.

          Griffes cassées et arrachées au niveau des membres pelviens, griffes des membres thoraciques sans anomalies.

          Hyperkératose des coussinets des membres thoraciques, absence d'anomalies des coussinets pelviens.

          Selles et urines normales en consultation.
          ```

          {%- if template_category == "COMPTE RENDU STANDARD" %}
          9. **Hospitalization**
             - If there is no hospitalization, remove the section **SUIVI D'HOSPITALISATION**.
             - If there is hospitalization, fill the relevant placeholders and subsections and remove the rest.
                For example:
                - If there is only one day of hospitalisation, keep "Jour 1" and fill the details, remove the other days.
                - If there are more days of hospitalization than what is present in the template, add more days and fill accordingly.
          {%- endif -%}
          ## Inputs
          ### Transcript
          ```plaintext
          {{transcript}}
          ```

          ### {{baseline}}
          ```markdown
          {% if previous_run %}
          {{previous_run.content.content}}
          {% else %}
          {{template | trim}}
          {% endif %}
          ```

          {% if examples | trim %}
          ### Examples
          {{examples}}
          {% endif %}

          ## Output Expectations
          - Date format is DD/MM/YYYY.
          - Do not include the **Transcript** or **{{baseline}}** again in your output.
          - Output should be a **clean, complete, and human-readable report** in Markdown format.
        is_output_fixable: false
        is_table: false
        is_trigger: false
        kls: Instruct
        model: gpt-4o
        name: Création du rapport
        output_fields:
          - { free: report, handle_id: 683e, type: Text }
        output_schema:
          can-add-fields: true
          properties:
            report: { handle_id: 683e, title: report, type: string }
          required: [report]
          title: OutputSchema
          type: object
        pos_x: 540.0
        pos_y: 1380.0
        src_handles: [report]
        tgt_handles:
          [
            run,
            transcript,
            previous_run,
            previous_transcript,
            template_category,
            template,
            examples,
          ]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-59399c98-bd9d-4ca9-821a-77f715b5bbd3
        is_output_fixable: false
        is_trigger: false
        kls: Transcript
        language: ""
        name: Transcription
        pos_x: 1004.0
        pos_y: 189.0
        src_handles: [transcript]
        tgt_handles: [run, audio]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-b92ebef0-bad5-492d-9785-6d2c03cbda28
        is_output_fixable: false
        is_trigger: false
        kls: SheetsRead
        name: Check exemples
        pos_x: 559.0
        pos_y: 16.5
        range_name: Exemples
        sheet_id: 1F4i5R9-WPdBSDXUZAJzBuvtYaCdJBT8OFFfJmh_biCw
        src_handles: [values]
        tgt_handles: [run]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-74780aeb-767b-47ca-b011-62ad25f9f4c2
        is_output_fixable: false
        is_trigger: false
        kls: FormatTable
        name: Check exemples
        pos_x: 500.0
        pos_y: 180.0
        prefix: ""
        separator: |2+



        src_handles: [formatted_text]
        suffix: ""
        template: |-
          <example>
          <report>
          {report}
          </report>
          </example>
        tgt_handles: [run, table]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-fbf71c70-04cf-4e21-ba31-43a51cd117f0
        is_output_fixable: false
        is_trigger: false
        kls: SheetsRead
        name: Vocabulaire
        pos_x: 789.0
        pos_y: 16.5
        range_name: Vocabulaire
        sheet_id: 1F4i5R9-WPdBSDXUZAJzBuvtYaCdJBT8OFFfJmh_biCw
        src_handles: [values]
        tgt_handles: [run]
    - id:
        PLURALLY_VERSION: 1
        _node_id: nd-2e699a47-f3d2-44e3-b1a4-e4aeb7dcdc54
        add_explanation: false
        examples: ""
        general_info: ""
        input_fields:
          - { free: transcript, handle_id: 8c56, type: Auto }
          - { free: vocabulary, handle_id: 50fb, type: Auto }
          - { free: acronyms, handle_id: 1a4a, type: Auto }
        input_schema:
          $defs:
            Auto:
              properties: {}
              title: Auto
              type: object
          additionalProperties: false
          can-add-fields: true
          properties:
            acronyms:
              handle_id: 1a4a
              properties: {}
              title: acronyms
              type: object
              type-friendly: Auto (BETA)
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
            transcript:
              handle_id: 8c56
              properties: {}
              title: transcript
              type: object
              type-friendly: Auto (BETA)
            vocabulary:
              handle_id: 50fb
              properties: {}
              title: vocabulary
              type: object
              type-friendly: Auto (BETA)
          required: [transcript, vocabulary, acronyms]
          title: InputSchema
          type: object
        instruct: |+
          # Plurally System Prompts

          ## Introduction
          You are an **AI-powered assistant** for a **French emergency veterinary clinic**, helping to **optimize and correct veterinary transcriptions**.

          Your task is to ensure the **accuracy and clarity** of the transcription by correcting phonetic errors, using proper veterinary terminology, and maintaining consistency with best practices.

          ## General Instructions
          - Always use **{{OUTPUT_LANGUAGE}}** as the output language.
          - Never invent or assume information not present in the provided input.
          - Follow veterinary best practices and make sure all phrases make contextual sense.
          - Pay special attention to **homophones**, **phonetically similar terms**, and **veterinary-specific vocabulary**.
          - Use **global context** when correcting to ensure internal coherence.

          ## General Information
          {PLURALLY_GENERAL_INFO}

          ## Task Objective
          Given:
          - A **Transcript** dictated by the veterinary
          - Common **Vocabulary**

          Your goal is to:
          - **Correct transcription errors** using the Vocabulary
          - **Ensure clarity and correctness**

          ## Rules

          1. **Phonetic Errors**
          - Fix transcription phonetic mistakes using the provided **Vocabulary**.
             Examples:
                - `normes au therme` → `normotherme`

          2. **Watch Out For Acronyms**
          - Keep in mind that the veterinary might be "speaking" some acronyms as well. Make sure to notice and correct acronyms in the **Transcript**
             Examples:
                - `injection U nassim` → `injection UNACIM`
                - `meloxicam bide` → `meloxicam BID`
                - `ivétide` → `IV TID`
          - Terms should be split and mapped if their components match **Vocabulary**.
             Examples:
                - `estocélanside` → `estocelan SID`
                - `meloxicambid` → `meloxicam BID`

          2. **Contextual Non-Sense**
          - Use overall context to fix unclear or incoherent phrasing.
             Example:
                - `pour lait gazeux` → `relais gazeux`
                - `vicril decimal 3 5` → `Vicryl décimal 3.5`

          ## Inputs

          ### Transcript
          ```plaintext
          {{transcript}}

          ### Vocabulary
          ```
          {%- for vocab in vocabulary.data %}
          - {{vocab.Vocabulaire}}
          {%- endfor %}
          {%- for acronym in acronyms.data %}
          - {{acronym.Signification}}
          - {{acronym.Acronym}}
          {%- endfor %}
          ```

          ## Output Expectations
          - Output must follow this structure and adhere to language and formatting rules.
          - Use DD/MM/YYYY for dates.
          - Prioritize clarity, accuracy, and veterinary-relevant phrasing.

        is_output_fixable: false
        is_table: false
        is_trigger: false
        kls: Instruct
        model: gpt-4o
        name: Correction des fautes
        output_fields:
          - { free: corrected_transcript, handle_id: fbc7, type: Text }
        output_schema:
          can-add-fields: true
          properties:
            corrected_transcript:
              { handle_id: fbc7, title: corrected_transcript, type: string }
          required: [corrected_transcript]
          title: OutputSchema
          type: object
        pos_x: 580.0
        pos_y: 400.0
        src_handles: [corrected_transcript]
        tgt_handles: [vocabulary, acronyms, run, transcript]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-faf71e16-05fd-4d6e-87cd-6045a15d7c00
        index_col: category
        is_output_fixable: false
        is_trigger: false
        kls: Indexer
        name: Smart Search
        pos_x: 679.5
        pos_y: 744.0
        src_handles: [values]
        tgt_handles: [run, query, knowledge]
        top_k: 1
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-446f3480-90a9-45dc-aa39-50cd90edef31
        is_output_fixable: false
        is_trigger: false
        kls: SheetsRead
        name: Choix template
        pos_x: 1020.0
        pos_y: 600.0
        range_name: Templates2
        sheet_id: 1F4i5R9-WPdBSDXUZAJzBuvtYaCdJBT8OFFfJmh_biCw
        src_handles: [values]
        tgt_handles: [run]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-0e9124f3-31d5-4ccf-9269-148b735307c3
        is_output_fixable: false
        is_trigger: false
        kls: FormatTable
        name: Table Formatter
        pos_x: 969.5
        pos_y: 1010.0
        prefix: ""
        separator: |2+

        src_handles: [formatted_text]
        suffix: ""
        template: "{template}"
        tgt_handles: [run, table]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-a4d74224-9c19-47b9-bf38-ed15ed4c148b
        is_output_fixable: false
        is_trigger: false
        kls: SheetsRead
        name: Acronyms
        pos_x: 329.0
        pos_y: 16.5
        range_name: Acronymes
        sheet_id: 1F4i5R9-WPdBSDXUZAJzBuvtYaCdJBT8OFFfJmh_biCw
        src_handles: [values]
        tgt_handles: [run]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-c1e190a6-7b01-4458-9737-c9f7cc1eac85
        is_output_fixable: false
        is_trigger: false
        keys: [report, template, transcript, template_category]
        kls: StateInput
        name: StateInput
        output_schema:
          properties:
            report:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: Report
            template:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: Template
            template_category:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: Template Category
            transcript:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: Transcript
          title: OutputSchema
          type: object
          uiSchema:
            ui:options: { label: false }
        pos_x: 694.0
        pos_y: 1010.0
        src_handles: [report, template_category, template, transcript]
        tgt_handles: [run]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-00a860f2-9619-453e-81a9-1e9eebe7c27b
        is_correctible: true
        is_hidden: true
        is_output_fixable: false
        is_trigger: false
        key: template
        kls: TextOutput
        name: template output
        pos_x: 1227.0
        pos_y: 1276.0
        src_handles: []
        tgt_handles: [run, content]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-194a358a-09f9-4057-aa18-fe8ef9368feb
        input_schema:
          additionalProperties: false
          properties:
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
            template:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: template
            template_saved:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: template_saved
          title: InputSchema
          type: object
        is_output_fixable: false
        is_trigger: false
        kls: FormatJinja
        name: FormatJinja
        pos_x: 974.5
        pos_y: 1143.0
        src_handles: [formatted_text]
        template: |
          {% if template_saved %}
          {{template_saved.content}}
          {% else %}
          {{template}}
          {% endif %}
        tgt_handles: [run, template_saved, template]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-c319a4d2-8140-464a-902e-1d9416b676a3
        is_correctible: true
        is_hidden: false
        is_output_fixable: false
        is_trigger: false
        key: report
        kls: MarkdownOutput
        name: MarkdownOutput
        pos_x: 440.0
        pos_y: 1860.0
        src_handles: []
        tgt_handles: [previous_content, run, content]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-0291f3bc-dbc1-4aec-b705-cd0fed5f22a4
        input_schema:
          additionalProperties: false
          properties:
            report:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: report
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
            template:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: template
          title: InputSchema
          type: object
        is_output_fixable: false
        is_trigger: false
        kls: FormatJinja
        name: FormatJinja
        pos_x: 20.0
        pos_y: 1400.0
        src_handles: [formatted_text]
        template: |-
          {%- if report %}
          {{report.content.content}}
          {%- else %}
          {{template | trim}}
          {%- endif %}
        tgt_handles: [report, run, template]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-bb98af3e-61c7-4f7b-87b5-7908cb1f5b2d
        input_schema:
          additionalProperties: false
          properties:
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
          title: InputSchema
          type: object
        is_output_fixable: false
        is_trigger: false
        kls: FormatJinja
        name: FormatJinja
        pos_x: 405.0
        pos_y: 1143.0
        src_handles: [formatted_text]
        template: |-
          {% if false %}
          {% endif %}
        tgt_handles: [run]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-8231f361-7376-47a5-a67f-46bab03abd13
        is_output_fixable: false
        is_trigger: false
        kls: FormatTable
        name: Table Formatter
        pos_x: 399.0
        pos_y: 877.0
        prefix: ""
        separator: |2+

        src_handles: [formatted_text]
        suffix: ""
        template: "{category}"
        tgt_handles: [run, table]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-26430211-b1c7-41b2-88a0-7092adc9cfe0
        input_schema:
          additionalProperties: false
          properties:
            category:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: category
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
          title: InputSchema
          type: object
        is_output_fixable: false
        is_trigger: false
        kls: FormatJinja
        name: FormatJinja
        pos_x: 414.0
        pos_y: 1010.0
        src_handles: [formatted_text]
        template: "{{category | trim}}"
        tgt_handles: [run, category]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-b0561d56-4ae3-48be-87c5-ed0529cbd1ad
        is_correctible: true
        is_hidden: true
        is_output_fixable: false
        is_trigger: false
        key: transcript
        kls: TextOutput
        name: TextOutput
        pos_x: 680.0
        pos_y: 600.0
        src_handles: []
        tgt_handles: [run, content]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-138e918a-2d78-47f6-a43d-abfc196095b3
        is_correctible: true
        is_hidden: true
        is_output_fixable: false
        is_trigger: false
        key: template_category
        kls: TextOutput
        name: Template Category Save
        pos_x: 605.0
        pos_y: 1143.0
        src_handles: []
        tgt_handles: [run, content]
    - id:
        PLURALLY_VERSION: 0
        _node_id: nd-85a43d42-b39c-42d2-9df6-635bfc05a309
        input_schema:
          additionalProperties: false
          properties:
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
            template_category:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: template_category
            template_category_saved:
              anyOf:
                - {}
                - { type: "null" }
              default: null
              title: template_category_saved
          title: InputSchema
          type: object
        is_output_fixable: false
        is_trigger: false
        kls: FormatJinja
        name: FormatJinja
        pos_x: 205.0
        pos_y: 1143.0
        src_handles: [formatted_text]
        template:
          "{{ template_category_saved if template_category_saved else template_category
          }}"
        tgt_handles: [template_category_saved, template_category, run]
    - id:
        PLURALLY_VERSION: 1
        _node_id: nd-6beb29b6-96e3-43b7-bfff-f8c0d2f5ff80
        add_explanation: false
        examples: ""
        general_info: ""
        input_fields:
          - { free: report, handle_id: 51db, type: Auto }
          - { free: acronyms, handle_id: "3497", type: Auto }
        input_schema:
          $defs:
            Auto:
              properties: {}
              title: Auto
              type: object
          additionalProperties: false
          can-add-fields: true
          properties:
            acronyms:
              handle_id: "3497"
              properties: {}
              title: acronyms
              type: object
              type-friendly: Auto (BETA)
            report:
              handle_id: 51db
              properties: {}
              title: report
              type: object
              type-friendly: Auto (BETA)
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
          required: [report, acronyms]
          title: InputSchema
          type: object
        instruct: |
          # Plurally System Prompts

          ## Introduction
          You are a Veterinary Clinic AI-powered assistant, helping to correct **veterinary post-consultation reports**.

          ## General Instructions
          - Always up-to-date with the latest veterinary reporting best practices.
          - Respond in the **same language as the input language**.
          - Use only the provided context—do not make assumptions or generate fictional information.

          ## General Informations
          {PLURALLY_GENERAL_INFO}

          ## Task Objective
          Given:
          - A veterinary post-consultation **Report**.
          - A list of common **Acronyms**, given as: `acronym`: `signification`.

          Your goal is to make **Acronym** usage uniform in the **Report**.

          ## Rules

          1. **Patient Sections**
             - If some content in the **Report** in one of the **Patient Sections** is in **Acronyms**, replace by `signification`.
                Example: "Donner meloxicam q4h." → "Donner meloxicam toutes les 4 heures."
          2. **Non-Patient Sections**
             - If some content in the **Transcript** in any of the **Non Patient Sections** is in **Acronyms**, then replace by `acronym`.
                Example: "Donner meloxicam toutes les 4 heures." → "Donner meloxicam Q4H."
          2. **Acronym Matching**
             - Acronym matching should be **case-insensitive**.
                Example: q4h is the same as Q4H.

          ## Inputs
          ### Report
          ```markdown
          {{report}}
          ```

          ### Patient Sections
          ```plaintext
          - ### PRESCRIPTION
          ```

          ### Non Patient Sections
          These are all the sections (e.g. ### ANAMNESE) that are not in **Patient Sections**.

          ### Acronyms
          ```plaintext
          {%- for acronym in acronyms.data -%}
          {{acronym.Acronym}}: {{acronym.Signification}}
          {%- endfor -%}
        is_output_fixable: false
        is_table: false
        is_trigger: false
        kls: Instruct
        model: gpt-4o
        name: Acronyms
        output_fields:
          - { free: corrected_report, handle_id: c422, type: Auto }
        output_schema:
          $defs:
            Auto:
              properties: {}
              title: Auto
              type: object
          can-add-fields: true
          properties:
            corrected_report:
              handle_id: c422
              properties: {}
              title: corrected_report
              type: object
              type-friendly: Auto (BETA)
          required: [corrected_report]
          title: OutputSchema
          type: object
        pos_x: 540.0
        pos_y: 1560.0
        src_handles: [corrected_report]
        tgt_handles: [report, run, acronyms]
    - id:
        PLURALLY_VERSION: 1
        _node_id: nd-e634a716-cc90-4437-add7-0f05c6b41460
        add_explanation: false
        examples: ""
        general_info: ""
        input_fields:
          - { free: transcript, handle_id: 5dd5, type: Text }
          - { free: report, handle_id: a5cd, type: Text }
        input_schema:
          additionalProperties: false
          can-add-fields: true
          properties:
            report: { handle_id: a5cd, title: report, type: string }
            run:
              default: true
              description: Whether to run the block.
              examples: [true, false]
              title: Run
              type: boolean
            transcript: { handle_id: 5dd5, title: transcript, type: string }
          required: [transcript, report]
          title: InputSchema
          type: object
        instruct: |-
          # Plurally System Prompts

          ## Introduction
          You are a **Veterinary Report Reviewer**. Your job is to review and improve a **Veterinary Report** generated from a **Transcript** (in French) dictated by a veterinary during a consultation.

          ## General Instructions
          - You are always up-to-date with the latest veterinary reporting standards and best practices.
          - Use **only** the information present in the **Transcript**.
          - Do **not** invent, infer, or assume anything beyond what the **Transcript** provides.
          - The goal is to produce a clean, complete, and professional report.

          ## Task Objective
          Given:
          - A raw **Transcript** from a veterinary consultation.
          - An initial version of the **Veterinary Report**.

          Your goal is to:
          - Read and interpret the transcript carefully.
          - Identify any information that is missing.
          - Return an **improved, corrected version** of the report that contains **all clinically relevant information** from the **Transcript**.
          - Leave other parts of the **Veterinary Report** unchanged.

          ## Important Notes
          - The transcript may contain **spelling mistakes, phonetic approximations, or incomplete sentences**.
          - Your job includes interpreting and correcting these to extract accurate information.
          - Any **clinically relevant detail** in the transcript that is missing in the report must be **added**.

          ## Output Format
          Return **only** the corrected and improved version of the **Veterinary Report**, in clean Markdown format.

          ## Inputs
          ### Transcript
          ```plaintext
          {{transcript}}
          ```

          ### Veterinary Report
          ```markdown
          {{report}}
        is_output_fixable: false
        is_table: false
        is_trigger: false
        kls: Instruct
        model: gpt-4o
        name: AI (Plurally)
        output_fields:
          - { free: corrected_report, handle_id: "7259", type: Text }
        output_schema:
          can-add-fields: true
          properties:
            corrected_report:
              { handle_id: "7259", title: corrected_report, type: string }
          required: [corrected_report]
          title: OutputSchema
          type: object
        pos_x: 620.0
        pos_y: 1720.0
        src_handles: [corrected_report]
        tgt_handles: [report, run, transcript]
id: 27f1017c-1cea-4d44-ba5e-814f8a30361a
is_running: false
last_exec_dt: null
last_updated: "2025-03-31T15:01:11.619708"
logo: https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRatYxDSn_2VynzlcXpsGxy55Ilx-IPiacSw&s
name: Rapport consultation (liste)
org_id: 68525e41-fa65-4722-b55a-def7b3c48762
owner_id: 83e1fa8e-a5db-487f-9780-c69846b9f8ca
