"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[3660],{68933:(t,e,a)=>{var r=a(64094),o=a(82959).u,i=a(39604),n=a(35872),l=a(10017).rb,s=a(10017).ay,c=a(99134).extendFlat,p=a(93399).k,d=i({editType:"plot",arrayOk:!0,colorEditType:"plot",description:"Sets the font used for `textinfo`."});t.exports={labels:{valType:"data_array",editType:"calc",description:["Sets the sector labels.","If `labels` entries are duplicated, we sum associated `values`","or simply count occurrences if `values` is not provided.","For other array attributes (including color) we use the first","non-empty entry among all occurrences of the label."].join(" ")},label0:{valType:"number",dflt:0,editType:"calc",description:["Alternate to `labels`.","Builds a numeric set of labels.","Use with `dlabel`","where `label0` is the starting label and `dlabel` the step."].join(" ")},dlabel:{valType:"number",dflt:1,editType:"calc",description:"Sets the label step. See `label0` for more info."},values:{valType:"data_array",editType:"calc",description:["Sets the values of the sectors.","If omitted, we count occurrences of each label."].join(" ")},marker:{colors:{valType:"data_array",editType:"calc",description:["Sets the color of each sector.","If not specified, the default trace color set is used","to pick the sector colors."].join(" ")},line:{color:{valType:"color",dflt:n.defaultLine,arrayOk:!0,editType:"style",description:["Sets the color of the line enclosing each sector."].join(" ")},width:{valType:"number",min:0,dflt:0,arrayOk:!0,editType:"style",description:["Sets the width (in px) of the line enclosing each sector."].join(" ")},editType:"calc"},pattern:p,editType:"calc"},text:{valType:"data_array",editType:"plot",description:["Sets text elements associated with each sector.","If trace `textinfo` contains a *text* flag, these elements will be seen","on the chart.","If trace `hoverinfo` contains a *text* flag and *hovertext* is not set,","these elements will be seen in the hover labels."].join(" ")},hovertext:{valType:"string",dflt:"",arrayOk:!0,editType:"style",description:["Sets hover text elements associated with each sector.","If a single string, the same string appears for","all data points.","If an array of string, the items are mapped in order of","this trace's sectors.","To be seen, trace `hoverinfo` must contain a *text* flag."].join(" ")},scalegroup:{valType:"string",dflt:"",editType:"calc",description:["If there are multiple pie charts that should be sized according to","their totals, link them by providing a non-empty group id here","shared by every trace in the same group."].join(" ")},textinfo:{valType:"flaglist",flags:["label","text","value","percent"],extras:["none"],editType:"calc",description:["Determines which trace information appear on the graph."].join(" ")},hoverinfo:c({},r.hoverinfo,{flags:["label","text","value","percent","name"]}),hovertemplate:l({},{keys:["label","color","value","percent","text"]}),texttemplate:s({editType:"plot"},{keys:["label","color","value","percent","text"]}),textposition:{valType:"enumerated",values:["inside","outside","auto","none"],dflt:"auto",arrayOk:!0,editType:"plot",description:["Specifies the location of the `textinfo`."].join(" ")},textfont:c({},d,{description:"Sets the font used for `textinfo`."}),insidetextorientation:{valType:"enumerated",values:["horizontal","radial","tangential","auto"],dflt:"auto",editType:"plot",description:["Controls the orientation of the text inside chart sectors.","When set to *auto*, text may be oriented in any direction in order","to be as big as possible in the middle of a sector.","The *horizontal* option orients text to be parallel with the bottom","of the chart, and may make text smaller in order to achieve that goal.","The *radial* option orients text along the radius of the sector.","The *tangential* option orients text perpendicular to the radius of the sector."].join(" ")},insidetextfont:c({},d,{description:"Sets the font used for `textinfo` lying inside the sector."}),outsidetextfont:c({},d,{description:"Sets the font used for `textinfo` lying outside the sector."}),automargin:{valType:"boolean",dflt:!1,editType:"plot",description:["Determines whether outside text labels can push the margins."].join(" ")},title:{text:{valType:"string",dflt:"",editType:"plot",description:["Sets the title of the chart.","If it is empty, no title is displayed.","Note that before the existence of `title.text`, the title's","contents used to be defined as the `title` attribute itself.","This behavior has been deprecated."].join(" ")},font:c({},d,{description:["Sets the font used for `title`.","Note that the title's font used to be set","by the now deprecated `titlefont` attribute."].join(" ")}),position:{valType:"enumerated",values:["top left","top center","top right","middle center","bottom left","bottom center","bottom right"],editType:"plot",description:["Specifies the location of the `title`.","Note that the title's position used to be set","by the now deprecated `titleposition` attribute."].join(" ")},editType:"plot"},domain:o({name:"pie",trace:!0,editType:"calc"}),hole:{valType:"number",min:0,max:1,dflt:0,editType:"calc",description:["Sets the fraction of the radius to cut out of the pie.","Use this to make a donut chart."].join(" ")},sort:{valType:"boolean",dflt:!0,editType:"calc",description:["Determines whether or not the sectors are reordered","from largest to smallest."].join(" ")},direction:{valType:"enumerated",values:["clockwise","counterclockwise"],dflt:"counterclockwise",editType:"calc",description:["Specifies the direction at which succeeding sectors follow","one another."].join(" ")},rotation:{valType:"angle",dflt:0,editType:"calc",description:["Instead of the first slice starting at 12 o'clock,","rotate to some other angle."].join(" ")},pull:{valType:"number",min:0,max:1,dflt:0,arrayOk:!0,editType:"calc",description:["Sets the fraction of larger radius to pull the sectors","out from the center. This can be a constant","to pull all slices apart from each other equally","or an array to highlight one or more slices."].join(" ")},_deprecated:{title:{valType:"string",dflt:"",editType:"calc",description:["Deprecated in favor of `title.text`.","Note that value of `title` is no longer a simple","*string* but a set of sub-attributes."].join(" ")},titlefont:c({},d,{description:"Deprecated in favor of `title.font`."}),titleposition:{valType:"enumerated",values:["top left","top center","top right","middle center","bottom left","bottom center","bottom right"],editType:"calc",description:"Deprecated in favor of `title.position`."}}}},53977:(t,e,a)=>{var r=a(35646),o=a(1915),i=a(24765),n={};function l(t){return function(e,a){return!!e&&!!(e=o(e)).isValid()&&(e=i.addOpacity(e,e.getAlpha()),t[a]||(t[a]=e),e)}}function s(t,e){var a,r=JSON.stringify(t),i=e[r];if(!i){for(i=t.slice(),a=0;a<t.length;a++)i.push(o(t[a]).lighten(20).toHexString());for(a=0;a<t.length;a++)i.push(o(t[a]).darken(20).toHexString());e[r]=i}return i}t.exports={calc:function(t,e){var a,o,i=[],n=t._fullLayout,s=n.hiddenlabels||[],c=e.labels,p=e.marker.colors||[],d=e.values,h=e._length,f=e._hasValues&&h;if(e.dlabel)for(c=new Array(h),a=0;a<h;a++)c[a]=String(e.label0+a*e.dlabel);var u={},x=l(n["_"+e.type+"colormap"]),v=0,m=!1;for(a=0;a<h;a++){var y,b,g;if(f){if(y=d[a],!r(y))continue;y=+y}else y=1;void 0!==(b=c[a])&&""!==b||(b=a);var T=u[b=String(b)];void 0===T?(u[b]=i.length,(g=-1!==s.indexOf(b))||(v+=y),i.push({v:y,label:b,color:x(p[a],b),i:a,pts:[a],hidden:g})):(m=!0,(o=i[T]).v+=y,o.pts.push(a),o.hidden||(v+=y),!1===o.color&&p[a]&&(o.color=x(p[a],b)))}return i=i.filter((function(t){return t.v>=0})),("funnelarea"===e.type?m:e.sort)&&i.sort((function(t,e){return e.v-t.v})),i[0]&&(i[0].vTotal=v),i},crossTraceCalc:function(t,e){var a=(e||{}).type;a||(a="pie");var r=t._fullLayout,o=t.calcdata,i=r[a+"colorway"],l=r["_"+a+"colormap"];r["extend"+a+"colors"]&&(i=s(i,n));for(var c=0,p=0;p<o.length;p++){var d=o[p];if(d[0].trace.type===a)for(var h=0;h<d.length;h++){var f=d[h];!1===f.color&&(l[f.label]?f.color=l[f.label]:(l[f.label]=f.color=i[c%i.length],c++))}}},makePullColorFn:l,generateExtendedColors:s}},62962:(t,e,a)=>{var r=a(35646),o=a(74364),i=a(68933),n=a(82959).N,l=a(29151).handleText,s=a(74364).coercePattern;function c(t,e){var a=Array.isArray(t),i=o.isArrayOrTypedArray(e),n=Math.min(a?t.length:1/0,i?e.length:1/0);if(isFinite(n)||(n=0),n&&i){for(var l,s=0;s<n;s++){var c=e[s];if(r(c)&&c>0){l=!0;break}}l||(n=0)}return{hasLabels:a,hasValues:i,len:n}}function p(t,e,a,r,o){r("marker.line.width")&&r("marker.line.color",o?void 0:a.paper_bgcolor);var i=r("marker.colors");s(r,"marker.pattern",i),t.marker&&!e.marker.pattern.fgcolor&&(e.marker.pattern.fgcolor=t.marker.colors),e.marker.pattern.bgcolor||(e.marker.pattern.bgcolor=a.paper_bgcolor)}t.exports={handleLabelsAndValues:c,handleMarkerDefaults:p,supplyDefaults:function(t,e,a,r){function s(a,r){return o.coerce(t,e,i,a,r)}var d=c(s("labels"),s("values")),h=d.len;if(e._hasLabels=d.hasLabels,e._hasValues=d.hasValues,!e._hasLabels&&e._hasValues&&(s("label0"),s("dlabel")),h){e._length=h,p(t,e,r,s,!0),s("scalegroup");var f,u=s("text"),x=s("texttemplate");if(x||(f=s("textinfo",Array.isArray(u)?"text+percent":"percent")),s("hovertext"),s("hovertemplate"),x||f&&"none"!==f){var v=s("textposition");l(t,e,r,s,v,{moduleHasSelected:!1,moduleHasUnselected:!1,moduleHasConstrain:!1,moduleHasCliponaxis:!1,moduleHasTextangle:!1,moduleHasInsideanchor:!1}),(Array.isArray(v)||"auto"===v||"outside"===v)&&s("automargin"),("inside"===v||"auto"===v||Array.isArray(v))&&s("insidetextorientation")}n(e,r,s);var m=s("hole");if(s("title.text")){var y=s("title.position",m?"middle center":"top center");m||"middle center"!==y||(e.title.position="top center"),o.coerceFont(s,"title.font",r.font)}s("sort"),s("direction"),s("rotation"),s("pull")}else e.visible=!1}}},6217:(t,e,a)=>{var r=a(58089).appendArrayMultiPointValues;t.exports=function(t,e){var a={curveNumber:e.index,pointNumbers:t.pts,data:e._input,fullData:e,label:t.label,color:t.color,value:t.v,percent:t.percent,text:t.text,bbox:t.bbox,v:t.v};return 1===t.pts.length&&(a.pointNumber=a.i=t.pts[0]),r(a,e,t.pts),"funnelarea"===e.type&&(delete a.v,delete a.i),a}},70175:(t,e,a)=>{var r=a(36279),o=a(71223),i=a(1484),n=a(24765),l=a(92252),s=a(74364),c=s.strScale,p=s.strTranslate,d=a(2912),h=a(24687),f=h.recordMinTextSize,u=h.clearMinTextSize,x=a(83084).TEXTPAD,v=a(50015),m=a(6217),y=a(74364).isValidTextValue;function b(t,e,a){var o=a[0],n=o.cx,l=o.cy,c=o.trace,p="funnelarea"===c.type;"_hasHoverLabel"in c||(c._hasHoverLabel=!1),"_hasHoverEvent"in c||(c._hasHoverEvent=!1),t.on("mouseover",(function(t){var a=e._fullLayout,d=e._fullData[c.index];if(!e._dragging&&!1!==a.hovermode){var h=d.hoverinfo;if(Array.isArray(h)&&(h=i.castHoverinfo({hoverinfo:[v.castOption(h,t.pts)],_module:c._module},a,0)),"all"===h&&(h="label+text+value+percent+name"),d.hovertemplate||"none"!==h&&"skip"!==h&&h){var f=t.rInscribed||0,u=n+t.pxmid[0]*(1-f),x=l+t.pxmid[1]*(1-f),y=a.separators,b=[];if(h&&-1!==h.indexOf("label")&&b.push(t.label),t.text=v.castOption(d.hovertext||d.text,t.pts),h&&-1!==h.indexOf("text")){var g=t.text;s.isValidTextValue(g)&&b.push(g)}t.value=t.v,t.valueLabel=v.formatPieValue(t.v,y),h&&-1!==h.indexOf("value")&&b.push(t.valueLabel),t.percent=t.v/o.vTotal,t.percentLabel=v.formatPiePercent(t.percent,y),h&&-1!==h.indexOf("percent")&&b.push(t.percentLabel);var T=d.hoverlabel,M=T.font,_=[];i.loneHover({trace:c,x0:u-f*o.r,x1:u+f*o.r,y:x,_x0:p?n+t.TL[0]:u-f*o.r,_x1:p?n+t.TR[0]:u+f*o.r,_y0:p?l+t.TL[1]:x-f*o.r,_y1:p?l+t.BL[1]:x+f*o.r,text:b.join("<br>"),name:d.hovertemplate||-1!==h.indexOf("name")?d.name:void 0,idealAlign:t.pxmid[0]<0?"left":"right",color:v.castOption(T.bgcolor,t.pts)||t.color,borderColor:v.castOption(T.bordercolor,t.pts),fontFamily:v.castOption(M.family,t.pts),fontSize:v.castOption(M.size,t.pts),fontColor:v.castOption(M.color,t.pts),nameLength:v.castOption(T.namelength,t.pts),textAlign:v.castOption(T.align,t.pts),hovertemplate:v.castOption(d.hovertemplate,t.pts),hovertemplateLabels:t,eventData:[m(t,d)]},{container:a._hoverlayer.node(),outerContainer:a._paper.node(),gd:e,inOut_bbox:_}),t.bbox=_[0],c._hasHoverLabel=!0}c._hasHoverEvent=!0,e.emit("plotly_hover",{points:[m(t,d)],event:r.event})}})),t.on("mouseout",(function(t){var a=e._fullLayout,o=e._fullData[c.index],n=r.select(this).datum();c._hasHoverEvent&&(t.originalEvent=r.event,e.emit("plotly_unhover",{points:[m(n,o)],event:r.event}),c._hasHoverEvent=!1),c._hasHoverLabel&&(i.loneUnhover(a._hoverlayer.node()),c._hasHoverLabel=!1)})),t.on("click",(function(t){var a=e._fullLayout,o=e._fullData[c.index];e._dragging||!1===a.hovermode||(e._hoverdata=[m(t,o)],i.click(e,r.event))}))}function g(t,e,a){var r=v.castOption(t.insidetextfont.color,e.pts);!r&&t._input.textfont&&(r=v.castOption(t._input.textfont.color,e.pts));var o=v.castOption(t.insidetextfont.family,e.pts)||v.castOption(t.textfont.family,e.pts)||a.family,i=v.castOption(t.insidetextfont.size,e.pts)||v.castOption(t.textfont.size,e.pts)||a.size;return{color:r||n.contrast(e.color),family:o,size:i}}function T(t,e){for(var a,r,o=0;o<t.length;o++)if((r=(a=t[o][0]).trace).title.text){var i=r.title.text;r._meta&&(i=s.templateString(i,r._meta));var n=l.tester.append("text").attr("data-notex",1).text(i).call(l.font,r.title.font).call(d.convertToTspans,e),c=l.bBox(n.node(),!0);a.titleBox={width:c.width,height:c.height},n.remove()}}function M(t,e,a){var r=a.r||e.rpx1,o=e.rInscribed;if(e.startangle===e.stopangle)return{rCenter:1-o,scale:0,rotate:0,textPosAngle:0};var i,n=e.ring,l=1===n&&Math.abs(e.startangle-e.stopangle)===2*Math.PI,s=e.halfangle,c=e.midangle,p=a.trace.insidetextorientation,d="horizontal"===p,h="tangential"===p,f="radial"===p,u="auto"===p,x=[];if(!u){var v,m=function(a,o){if(function(t,e){var a=t.startangle,r=t.stopangle;return a>e&&e>r||a<e&&e<r}(e,a)){var l=Math.abs(a-e.startangle),s=Math.abs(a-e.stopangle),c=l<s?l:s;(i="tan"===o?O(t,r,n,c,0):_(t,r,n,c,Math.PI/2)).textPosAngle=a,x.push(i)}};if(d||h){for(v=4;v>=-4;v-=2)m(Math.PI*v,"tan");for(v=4;v>=-4;v-=2)m(Math.PI*(v+1),"tan")}if(d||f){for(v=4;v>=-4;v-=2)m(Math.PI*(v+1.5),"rad");for(v=4;v>=-4;v-=2)m(Math.PI*(v+.5),"rad")}}if(l||u||d){var y=Math.sqrt(t.width*t.width+t.height*t.height);if((i={scale:o*r*2/y,rCenter:1-o,rotate:0}).textPosAngle=(e.startangle+e.stopangle)/2,i.scale>=1)return i;x.push(i)}(u||f)&&((i=_(t,r,n,s,c)).textPosAngle=(e.startangle+e.stopangle)/2,x.push(i)),(u||h)&&((i=O(t,r,n,s,c)).textPosAngle=(e.startangle+e.stopangle)/2,x.push(i));for(var b=0,g=0,T=0;T<x.length;T++){var M=x[T].scale;if(g<M&&(g=M,b=T),!u&&g>=1)break}return x[b]}function _(t,e,a,r,o){e=Math.max(0,e-2*x);var i=t.width/t.height,n=L(i,r,e,a);return{scale:2*n/t.height,rCenter:k(i,n/e),rotate:w(o)}}function O(t,e,a,r,o){e=Math.max(0,e-2*x);var i=t.height/t.width,n=L(i,r,e,a);return{scale:2*n/t.width,rCenter:k(i,n/e),rotate:w(o+Math.PI/2)}}function k(t,e){return Math.cos(e)-t*e}function w(t){return(180/Math.PI*t+720)%180-90}function L(t,e,a,r){var o=t+1/(2*Math.tan(e));return a*Math.min(1/(Math.sqrt(o*o+.5)+o),r/(Math.sqrt(t*t+r/2)+t))}function A(t,e){return t.v!==e.vTotal||e.trace.hole?Math.min(1/(1+1/Math.sin(t.halfangle)),t.ring/2):1}function S(t,e){var a=e.pxmid[0],r=e.pxmid[1],o=t.width/2,i=t.height/2;return a<0&&(o*=-1),r<0&&(i*=-1),{scale:1,rCenter:1,rotate:0,x:o+Math.abs(i)*(o>0?1:-1)/2,y:i/(1+a*a/(r*r)),outside:!0}}function P(t,e){var a,r,o,i=t.trace,n={x:t.cx,y:t.cy},l={tx:0,ty:0};l.ty+=i.title.font.size,o=j(i),-1!==i.title.position.indexOf("top")?(n.y-=(1+o)*t.r,l.ty-=t.titleBox.height):-1!==i.title.position.indexOf("bottom")&&(n.y+=(1+o)*t.r);var s,c=t.r/(void 0===(s=t.trace.aspectratio)?1:s),p=e.w*(i.domain.x[1]-i.domain.x[0])/2;return-1!==i.title.position.indexOf("left")?(p+=c,n.x-=(1+o)*c,l.tx+=t.titleBox.width/2):-1!==i.title.position.indexOf("center")?p*=2:-1!==i.title.position.indexOf("right")&&(p+=c,n.x+=(1+o)*c,l.tx-=t.titleBox.width/2),a=p/t.titleBox.width,r=E(t,e)/t.titleBox.height,{x:n.x,y:n.y,scale:Math.min(a,r),tx:l.tx,ty:l.ty}}function E(t,e){var a=t.trace,r=e.h*(a.domain.y[1]-a.domain.y[0]);return Math.min(t.titleBox.height,r/2)}function j(t){var e,a=t.pull;if(!a)return 0;if(Array.isArray(a))for(a=0,e=0;e<t.pull.length;e++)t.pull[e]>a&&(a=t.pull[e]);return a}function I(t,e){for(var a=[],r=0;r<t.length;r++){var o=t[r][0],i=o.trace,n=i.domain,l=e.w*(n.x[1]-n.x[0]),s=e.h*(n.y[1]-n.y[0]);i.title.text&&"middle center"!==i.title.position&&(s-=E(o,e));var c=l/2,p=s/2;"funnelarea"!==i.type||i.scalegroup||(p/=i.aspectratio),o.r=Math.min(c,p)/(1+j(i)),o.cx=e.l+e.w*(i.domain.x[1]+i.domain.x[0])/2,o.cy=e.t+e.h*(1-i.domain.y[0])-s/2,i.title.text&&-1!==i.title.position.indexOf("bottom")&&(o.cy-=E(o,e)),i.scalegroup&&-1===a.indexOf(i.scalegroup)&&a.push(i.scalegroup)}!function(t,e){for(var a,r,o,i=0;i<e.length;i++){var n=1/0,l=e[i];for(r=0;r<t.length;r++)if((o=(a=t[r][0]).trace).scalegroup===l){var s;if("pie"===o.type)s=a.r*a.r;else if("funnelarea"===o.type){var c,p;o.aspectratio>1?p=(c=a.r)/o.aspectratio:c=(p=a.r)*o.aspectratio,s=(c*=(1+o.baseratio)/2)*p}n=Math.min(n,s/a.vTotal)}for(r=0;r<t.length;r++)if((o=(a=t[r][0]).trace).scalegroup===l){var d=n*a.vTotal;"funnelarea"===o.type&&(d/=(1+o.baseratio)/2,d/=o.aspectratio),a.r=Math.sqrt(d)}}}(t,a)}function z(t,e){return[t*Math.sin(e),-t*Math.cos(e)]}function F(t,e,a){var r=t._fullLayout,o=a.trace,i=o.texttemplate,n=o.textinfo;if(!i&&n&&"none"!==n){var l,c=n.split("+"),p=function(t){return-1!==c.indexOf(t)},d=p("label"),h=p("text"),f=p("value"),u=p("percent"),x=r.separators;if(l=d?[e.label]:[],h){var m=v.getFirstFilled(o.text,e.pts);y(m)&&l.push(m)}f&&l.push(v.formatPieValue(e.v,x)),u&&l.push(v.formatPiePercent(e.v/a.vTotal,x)),e.text=l.join("<br>")}if(i){var b=s.castOption(o,e.i,"texttemplate");if(b){var g=function(t){return{label:t.label,value:t.v,valueLabel:v.formatPieValue(t.v,r.separators),percent:t.v/a.vTotal,percentLabel:v.formatPiePercent(t.v/a.vTotal,r.separators),color:t.color,text:t.text,customdata:s.castOption(o,t.i,"customdata")}}(e),T=v.getFirstFilled(o.text,e.pts);(y(T)||""===T)&&(g.text=T),e.text=s.texttemplateString(b,g,t._fullLayout._d3locale,g,o._meta||{})}else e.text=""}}function H(t,e){var a=t.rotate*Math.PI/180,r=Math.cos(a),o=Math.sin(a),i=(e.left+e.right)/2,n=(e.top+e.bottom)/2;t.textX=i*r-n*o,t.textY=i*o+n*r,t.noCenter=!0}t.exports={plot:function(t,e){var a=t._context.staticPlot,i=t._fullLayout,h=i._size;u("pie",i),T(e,t),I(e,h);var x=s.makeTraceGroups(i._pielayer,e,"trace").each((function(e){var u=r.select(this),x=e[0],m=x.trace;!function(t){var e,a,r,o=t[0],i=o.r,n=o.trace,l=v.getRotationAngle(n.rotation),s=2*Math.PI/o.vTotal,c="px0",p="px1";if("counterclockwise"===n.direction){for(e=0;e<t.length&&t[e].hidden;e++);if(e===t.length)return;l+=s*t[e].v,s*=-1,c="px1",p="px0"}for(r=z(i,l),e=0;e<t.length;e++)(a=t[e]).hidden||(a[c]=r,a.startangle=l,l+=s*a.v/2,a.pxmid=z(i,l),a.midangle=l,r=z(i,l+=s*a.v/2),a.stopangle=l,a[p]=r,a.largeArc=a.v>o.vTotal/2?1:0,a.halfangle=Math.PI*Math.min(a.v/o.vTotal,.5),a.ring=1-n.hole,a.rInscribed=A(a,o))}(e),u.attr("stroke-linejoin","round"),u.each((function(){var y=r.select(this).selectAll("g.slice").data(e);y.enter().append("g").classed("slice",!0),y.exit().remove();var T=[[[],[]],[[],[]]],_=!1;y.each((function(o,n){if(o.hidden)r.select(this).selectAll("path,g").remove();else{o.pointNumber=o.i,o.curveNumber=m.index,T[o.pxmid[1]<0?0:1][o.pxmid[0]<0?0:1].push(o);var c=x.cx,p=x.cy,h=r.select(this),u=h.selectAll("path.surface").data([o]);if(u.enter().append("path").classed("surface",!0).style({"pointer-events":a?"none":"all"}),h.call(b,t,e),m.pull){var y=+v.castOption(m.pull,o.pts)||0;y>0&&(c+=y*o.pxmid[0],p+=y*o.pxmid[1])}o.cxFinal=c,o.cyFinal=p;var O=m.hole;if(o.v===x.vTotal){var k="M"+(c+o.px0[0])+","+(p+o.px0[1])+E(o.px0,o.pxmid,!0,1)+E(o.pxmid,o.px0,!0,1)+"Z";O?u.attr("d","M"+(c+O*o.px0[0])+","+(p+O*o.px0[1])+E(o.px0,o.pxmid,!1,O)+E(o.pxmid,o.px0,!1,O)+"Z"+k):u.attr("d",k)}else{var w=E(o.px0,o.px1,!0,1);if(O){var L=1-O;u.attr("d","M"+(c+O*o.px1[0])+","+(p+O*o.px1[1])+E(o.px1,o.px0,!1,O)+"l"+L*o.px0[0]+","+L*o.px0[1]+w+"Z")}else u.attr("d","M"+c+","+p+"l"+o.px0[0]+","+o.px0[1]+w+"Z")}F(t,o,x);var A=v.castOption(m.textposition,o.pts),P=h.selectAll("g.slicetext").data(o.text&&"none"!==A?[0]:[]);P.enter().append("g").classed("slicetext",!0),P.exit().remove(),P.each((function(){var a=s.ensureSingle(r.select(this),"text","",(function(t){t.attr("data-notex",1)})),h=s.ensureUniformFontSize(t,"outside"===A?function(t,e,a){return{color:v.castOption(t.outsidetextfont.color,e.pts)||v.castOption(t.textfont.color,e.pts)||a.color,family:v.castOption(t.outsidetextfont.family,e.pts)||v.castOption(t.textfont.family,e.pts)||a.family,size:v.castOption(t.outsidetextfont.size,e.pts)||v.castOption(t.textfont.size,e.pts)||a.size}}(m,o,i.font):g(m,o,i.font));a.text(o.text).attr({class:"slicetext",transform:"","text-anchor":"middle"}).call(l.font,h).call(d.convertToTspans,t);var u,y=l.bBox(a.node());if("outside"===A)u=S(y,o);else if(u=M(y,o,x),"auto"===A&&u.scale<1){var b=s.ensureUniformFontSize(t,m.outsidetextfont);a.call(l.font,b),u=S(y=l.bBox(a.node()),o)}var T=u.textPosAngle,O=void 0===T?o.pxmid:z(x.r,T);if(u.targetX=c+O[0]*u.rCenter+(u.x||0),u.targetY=p+O[1]*u.rCenter+(u.y||0),H(u,y),u.outside){var k=u.targetY;o.yLabelMin=k-y.height/2,o.yLabelMid=k,o.yLabelMax=k+y.height/2,o.labelExtraX=0,o.labelExtraY=0,_=!0}u.fontSize=h.size,f(m.type,u,i),e[n].transform=u,s.setTransormAndDisplay(a,u)}))}function E(t,e,a,r){var i=r*(e[0]-t[0]),n=r*(e[1]-t[1]);return"a"+r*x.r+","+r*x.r+" 0 "+o.largeArc+(a?" 1 ":" 0 ")+i+","+n}}));var O=r.select(this).selectAll("g.titletext").data(m.title.text?[0]:[]);if(O.enter().append("g").classed("titletext",!0),O.exit().remove(),O.each((function(){var e,a=s.ensureSingle(r.select(this),"text","",(function(t){t.attr("data-notex",1)})),o=m.title.text;m._meta&&(o=s.templateString(o,m._meta)),a.text(o).attr({class:"titletext",transform:"","text-anchor":"middle"}).call(l.font,m.title.font).call(d.convertToTspans,t),e="middle center"===m.title.position?function(t){var e=Math.sqrt(t.titleBox.width*t.titleBox.width+t.titleBox.height*t.titleBox.height);return{x:t.cx,y:t.cy,scale:t.trace.hole*t.r*2/e,tx:0,ty:-t.titleBox.height/2+t.trace.title.font.size}}(x):P(x,h),a.attr("transform",p(e.x,e.y)+c(Math.min(1,e.scale))+p(e.tx,e.ty))})),_&&function(t,e){var a,r,o,i,n,l,s,c,p,d,h,f,u;function x(t,e){return t.pxmid[1]-e.pxmid[1]}function m(t,e){return e.pxmid[1]-t.pxmid[1]}function y(t,a){a||(a={});var o,c,p,h,f=a.labelExtraY+(r?a.yLabelMax:a.yLabelMin),u=r?t.yLabelMin:t.yLabelMax,x=r?t.yLabelMax:t.yLabelMin,m=t.cyFinal+n(t.px0[1],t.px1[1]),y=f-u;if(y*s>0&&(t.labelExtraY=y),Array.isArray(e.pull))for(c=0;c<d.length;c++)(p=d[c])===t||(v.castOption(e.pull,t.pts)||0)>=(v.castOption(e.pull,p.pts)||0)||((t.pxmid[1]-p.pxmid[1])*s>0?(y=p.cyFinal+n(p.px0[1],p.px1[1])-u-t.labelExtraY)*s>0&&(t.labelExtraY+=y):(x+t.labelExtraY-m)*s>0&&(o=3*l*Math.abs(c-d.indexOf(t)),(h=p.cxFinal+i(p.px0[0],p.px1[0])+o-(t.cxFinal+t.pxmid[0])-t.labelExtraX)*l>0&&(t.labelExtraX+=h)))}for(r=0;r<2;r++)for(o=r?x:m,n=r?Math.max:Math.min,s=r?1:-1,a=0;a<2;a++){for(i=a?Math.max:Math.min,l=a?1:-1,(c=t[r][a]).sort(o),p=t[1-r][a],d=p.concat(c),f=[],h=0;h<c.length;h++)void 0!==c[h].yLabelMid&&f.push(c[h]);for(u=!1,h=0;r&&h<p.length;h++)if(void 0!==p[h].yLabelMid){u=p[h];break}for(h=0;h<f.length;h++){var b=h&&f[h-1];u&&!h&&(b=u),y(f[h],b)}}}(T,m),function(t,e){t.each((function(t){var a=r.select(this);if(t.labelExtraX||t.labelExtraY){var o=a.select("g.slicetext text");t.transform.targetX+=t.labelExtraX,t.transform.targetY+=t.labelExtraY,s.setTransormAndDisplay(o,t.transform);var i=t.cxFinal+t.pxmid[0],l="M"+i+","+(t.cyFinal+t.pxmid[1]),c=(t.yLabelMax-t.yLabelMin)*(t.pxmid[0]<0?-1:1)/4;if(t.labelExtraX){var p=t.labelExtraX*t.pxmid[1]/t.pxmid[0],d=t.yLabelMid+t.labelExtraY-(t.cyFinal+t.pxmid[1]);Math.abs(p)>Math.abs(d)?l+="l"+d*t.pxmid[0]/t.pxmid[1]+","+d+"H"+(i+t.labelExtraX+c):l+="l"+t.labelExtraX+","+p+"v"+(d-p)+"h"+c}else l+="V"+(t.yLabelMid+t.labelExtraY)+"h"+c;s.ensureSingle(a,"path","textline").call(n.stroke,e.outsidetextfont.color).attr({"stroke-width":Math.min(2,e.outsidetextfont.size/8),d:l,fill:"none"})}else a.select("path.textline").remove()}))}(y,m),_&&m.automargin){var k=l.bBox(u.node()),w=m.domain,L=h.w*(w.x[1]-w.x[0]),A=h.h*(w.y[1]-w.y[0]),E=(.5*L-x.r)/h.w,j=(.5*A-x.r)/h.h;o.autoMargin(t,"pie."+m.uid+".automargin",{xl:w.x[0]-E,xr:w.x[1]+E,yb:w.y[0]-j,yt:w.y[1]+j,l:Math.max(x.cx-x.r-k.left,0),r:Math.max(k.right-(x.cx+x.r),0),b:Math.max(k.bottom-(x.cy+x.r),0),t:Math.max(x.cy-x.r-k.top,0),pad:5})}}))}));setTimeout((function(){x.selectAll("tspan").each((function(){var t=r.select(this);t.attr("dy")&&t.attr("dy",t.attr("dy"))}))}),0)},formatSliceLabel:F,transformInsideText:M,determineInsideTextFont:g,positionTitleOutside:P,prerenderTitles:T,layoutAreas:I,attachFxHandlers:b,computeTransform:H}}}]);