"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7046],{17046:function(e,n,t){t.d(n,{Wi:function(){return q},dP:function(){return Z},rA:function(){return J}});var r=t(73235),i=t(52322),s=t(48177),l=t(18984),o=t(76154),c=t(60206),d=t(94466),a=t(27100),u=t(97077),x=t(96832),p=t(3217),h=t(99564),j=t(39361),m=t(50683),g=t(74741),y=t(15997),f=t(1026),v=t(26834),b=t(58351),C=t(2784),I=t(7267),w=t(47933),S=t(4760),_=t(43863),k=t(29872),R=t(98933),K=t(96798),z=t(84991),E=t(93781),F=t(87933),O=t(20913),P=t(87642),T=t(86224),$=t(41349),D=t(69706),L=t(54602);function N(){let e=(0,r._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return N=function(){return e},e}function U(){let e=(0,r._)(["\n  mutation DeleteConcurrencyLimit($concurrencyKey: String!) {\n    deleteConcurrencyLimit(concurrencyKey: $concurrencyKey)\n  }\n"]);return U=function(){return e},e}function A(){let e=(0,r._)(["\n  mutation FreeConcurrencySlots($runId: String!, $stepKey: String) {\n    freeConcurrencySlots(runId: $runId, stepKey: $stepKey)\n  }\n"]);return A=function(){return e},e}function Q(){let e=(0,r._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          status\n        }\n      }\n    }\n  }\n"]);return Q=function(){return e},e}let q=e=>{var n,t;let{concurrencyKey:r}=e;(0,K.Px)(),(0,E.j)("Pool: ".concat(r));let[j,m]=C.useState(),[g,y]=C.useState(!1),f=(0,S.aM)(_.l,{variables:{pool:r}}),{data:v,refetch:b}=f,z=null==v?void 0:v.instance.concurrencyLimit,F=null==v?void 0:v.instance.runQueuingSupported,P=(0,R.C4)(f,R.dT),T=(0,I.k6)(),$=null==v?void 0:null===(n=v.instance.poolConfig)||void 0===n?void 0:n.poolGranularity;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{overflowY:"auto"},children:z?(0,i.jsxs)(s.x,{children:[(0,i.jsxs)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},border:"bottom",children:[(0,i.jsx)(l.X6,{children:(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(w.rU,{to:"/deployment/concurrency",children:"Pools"})}),(0,i.jsx)("div",{children:"/"}),(0,i.jsx)("div",{children:r})]})}),(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)(R.xi,{refreshState:P}),(0,i.jsx)(o.J2,{position:"bottom-right",content:(0,i.jsx)(c.v2,{children:(0,i.jsx)(c.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>y(!0)})}),children:(0,i.jsx)(d.zx,{icon:(0,i.jsx)(a.JO,{name:"expand_more"})})})]})]}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},children:(0,i.jsx)(l.pm,{children:"Pool info"})}),F||"op"===$?null:(0,i.jsx)(s.x,{margin:{horizontal:20,bottom:20},children:(0,i.jsx)(u.b,{intent:"warning",title:"Run granularity for pools not supported",description:(0,i.jsxs)(i.Fragment,{children:["The pool granularity is set to ",(0,i.jsx)(l.fv,{children:"run"}),", but run-level concurrency is not supported with this run coordinator. To enable run granularity for pools, configure your instance to use the default ",(0,i.jsx)(l.fv,{children:"QueuedRunCoordinator"})," ","in your ",(0,i.jsx)(l.fv,{children:"dagster.yaml"}),". See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})})}),(0,i.jsx)(s.x,{padding:{bottom:24},children:(0,i.jsx)(x.fJ,{style:{marginLeft:-1},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Granularity"}),(0,i.jsx)("td",{children:"run"===$?"Run":"Op"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Limit"}),(0,i.jsx)("td",{children:(0,i.jsxs)(s.x,{flex:{justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:z.slotCount?z.slotCount:null===z.limit?(0,i.jsx)(i.Fragment,{children:"—"}):z.limit}),z.usingDefaultLimit?(0,i.jsx)(l.YS,{color:p.Aw(),children:"(default)"}):null]}),(0,i.jsx)(d.zx,{icon:(0,i.jsx)(a.JO,{name:"edit"}),onClick:()=>m(!0),children:"Edit limit"})]})})]})]})})}),(null==v?void 0:null===(t=v.instance.poolConfig)||void 0===t?void 0:t.poolGranularity)!=="run"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"In progress steps"})}),(0,i.jsx)(s.x,{style:{marginLeft:-1},children:(0,i.jsx)(H,{keyInfo:z,refresh:b})}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"Queued runs"})}),(0,i.jsx)(Y,{pool:r,runStatuses:O.sy})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"In progress"})}),(0,i.jsx)(Y,{pool:r,runStatuses:O.Ys}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"Queued"})}),(0,i.jsx)(Y,{pool:r,runStatuses:O.sy})]})]}):(0,i.jsx)(s.x,{flex:{direction:"column",alignItems:"center"},padding:{vertical:64},children:(0,i.jsx)(h.f,{label:"Loading…"})})}),(0,i.jsx)(B,{concurrencyKey:r,open:!!j,onClose:()=>m(!1),onComplete:b,minValue:(null==v?void 0:v.instance.minConcurrencyLimitValue)||0,maxValue:(null==v?void 0:v.instance.maxConcurrencyLimitValue)||1e3}),(0,i.jsx)(V,{concurrencyKey:r,open:!!g,onClose:()=>y(!1),onComplete:()=>{T.push("/deployment/concurrency"),(0,k.B)({icon:"trash",intent:"success",message:"Deleted pool limit"})}})]})},J=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!e)return!1;let r=parseInt(e);return!isNaN(r)&&String(r)===e.trim()&&r>=n&&r<=t},B=e=>{let{concurrencyKey:n,open:t,onClose:r,onComplete:o,minValue:c,maxValue:a}=e,[u,x]=C.useState(!1),[p,h]=C.useState("");C.useEffect(()=>{h("")},[t]);let[g]=(0,S.Db)(W),y=async()=>{x(!0),await g({variables:{concurrencyKey:n,limit:parseInt(p.trim())}}),x(!1),o(),r()};return(0,i.jsxs)(j.Vq,{isOpen:t,title:(0,i.jsxs)("span",{children:["Edit ",(0,i.jsx)(l.fv,{children:n})]}),onClose:r,children:[(0,i.jsxs)(j.a7,{children:[(0,i.jsx)(s.x,{margin:{bottom:4},children:"Pool:"}),(0,i.jsx)(s.x,{margin:{bottom:16},children:(0,i.jsx)("strong",{children:n})}),(0,i.jsxs)(s.x,{margin:{bottom:4},children:["Pool limit (",c,"-",a,"):"]}),(0,i.jsx)(s.x,{children:(0,i.jsx)(m.oi,{value:p||"",onChange:e=>h(e.target.value),placeholder:"".concat(c," - ").concat(a)})})]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(d.zx,{intent:"none",onClick:r,children:"Close"}),u?(0,i.jsx)(d.zx,{intent:"primary",disabled:!0,children:"Updating…"}):(0,i.jsx)(d.zx,{intent:"primary",onClick:y,disabled:!J(p.trim(),c,a),children:"Update limit"})]})]})},V=e=>{let{concurrencyKey:n,open:t,onClose:r,onComplete:s}=e,[o,c]=C.useState(!1),[a]=(0,S.Db)(X),u=async()=>{c(!0),await a({variables:{concurrencyKey:n}}),c(!1),s(),r()},x=(0,i.jsxs)(i.Fragment,{children:["Delete ",(0,i.jsx)(l.fv,{children:n})]});return(0,i.jsxs)(j.Vq,{isOpen:t,title:x,onClose:r,children:[(0,i.jsxs)(j.a7,{children:["Delete concurrency limit\xa0",(0,i.jsx)("strong",{children:n}),"?"]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(d.zx,{onClick:r,children:"Close"}),(0,i.jsx)(d.zx,{intent:"danger",disabled:o,onClick:u,children:o?"Deleting…":"Delete limit"})]})]})},G=e=>{let{pendingStep:n,onUpdate:t}=e,[r]=(0,S.Db)(Z);return(0,i.jsx)(o.J2,{content:(0,i.jsxs)(c.v2,{children:[(0,i.jsx)(c.sN,{icon:"status",text:"Free concurrency slot for step",onClick:async()=>{var e;(null===(e=(await r({variables:{runId:n.runId,stepKey:n.stepKey}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&(t(),await (0,k.B)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slot"}))}},"free-concurrency-slots-step"),(0,i.jsx)(c.sN,{icon:"status",text:"Free all concurrency slots for run",onClick:async()=>{var e;await (0,k.B)({intent:"primary",message:"Freeing concurrency slots..."}),(null===(e=(await r({variables:{runId:n.runId}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&(t(),await (0,k.B)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"}))}},"free-concurrency-slots-run")]}),position:"bottom-right",children:(0,i.jsx)(d.zx,{rightIcon:(0,i.jsx)(a.JO,{name:"expand_more"}),children:"Actions"})})},Y=e=>{var n,t;let{pool:r,runStatuses:l}=e,o={statuses:Array.from(l),tags:[{key:"".concat(T.H.PoolTagPrefix,"/").concat(r),value:"true"}]},{queryResult:c,paginationProps:d}=(0,L.E)(o,10),a=(null===(n=c.data)||void 0===n?void 0:n.pipelineRunsOrError)||(null===(t=c.previousData)||void 0===t?void 0:t.pipelineRunsOrError),u=(0,R.C4)(c,15e3);return a?"Runs"!==a.__typename?(0,i.jsx)(s.x,{padding:{vertical:64},children:(0,i.jsx)(y.t,{icon:"error",title:"Query error",description:a.message})}):a.results.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{position:"absolute",right:16,top:-32},children:(0,i.jsx)(R.xi,{refreshState:u})}),(0,i.jsx)(P.A,{runs:a.results,loading:c.loading}),a.results.length>0?(0,i.jsx)(s.x,{margin:{vertical:16},children:(0,i.jsx)(f.pI,{...d})}):null]}):(0,i.jsx)(s.x,{padding:{vertical:24},border:"top-and-bottom",flex:{direction:"column",alignItems:"center"},children:l.has(z.VOA.STARTED)?"No matching runs in progress.":"No matching runs in queue."}):(0,i.jsx)(s.x,{padding:{vertical:48},children:(0,i.jsx)(g.$,{purpose:"page"})})},H=e=>{var n;let{keyInfo:t,refresh:r}=e,l=[...new Set(t.pendingSteps.map(e=>e.runId))],o=(0,S.aM)(ee,{variables:{filter:{runIds:l}},skip:!t.pendingSteps.length}),c={};((null===(n=o.data)||void 0===n?void 0:n.pipelineRunsOrError.__typename)==="Runs"?o.data.pipelineRunsOrError.results:[]).forEach(e=>{c[e.id]=e.status});let d=[...t.pendingSteps];d.sort((e,n)=>e.priority&&n.priority&&e.priority!==n.priority?e.priority-n.priority:e.enqueuedTimestamp-n.enqueuedTimestamp);let u=d.filter(e=>!!e.assignedTimestamp),x=d.filter(e=>!e.assignedTimestamp),h=(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Run ID"}),(0,i.jsx)("th",{children:"Step key"}),(0,i.jsx)("th",{children:"Assigned"}),(0,i.jsx)("th",{children:"Queued"}),(0,i.jsx)("th",{children:(0,i.jsxs)(s.x,{flex:{alignItems:"center",direction:"row",gap:4},children:["Priority",(0,i.jsx)(v.u,{placement:"top",content:"Priority can be set on each op/asset using the 'dagster/priority' tag. Higher priority steps will be assigned slots first.",children:(0,i.jsx)(a.JO,{name:"info",color:p.md()})})]})}),(0,i.jsx)("th",{})]})});return d.length?(0,i.jsxs)(b.i,{children:[h,(0,i.jsx)("tbody",{style:{backgroundColor:p.B5()},children:u.map(e=>(0,i.jsx)(M,{step:e,statusByRunId:c,onUpdate:r},e.runId+e.stepKey))}),(0,i.jsx)("tbody",{children:x.map(e=>(0,i.jsx)(M,{step:e,statusByRunId:c,onUpdate:r},e.runId+e.stepKey))})]}):(0,i.jsx)(y.t,{icon:"no-results",title:"No active steps",description:"There are no active or pending steps for this pool."})},M=e=>{let{step:n,statusByRunId:t,onUpdate:r}=e,o=t[n.runId];return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:o?(0,i.jsx)(w.rU,{to:"/runs/".concat(n.runId),children:(0,i.jsxs)(s.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,i.jsx)(F.O_,{status:o,size:10}),(0,i.jsx)(l.fv,{children:(0,$.EI)({id:n.runId})}),O.hd.has(o)?(0,i.jsx)(v.u,{placement:"top",content:"Slots for canceled / failed runs can automatically be freed by configuring a run monitoring setting.",children:(0,i.jsx)(a.JO,{name:"info",color:p.md()})}):null]})}):(0,i.jsx)(l.fv,{children:(0,$.EI)({id:n.runId})})}),(0,i.jsx)("td",{children:(0,i.jsx)(l.fv,{children:n.stepKey})}),(0,i.jsx)("td",{children:n.assignedTimestamp?(0,i.jsx)(D.Q,{startUnix:n.assignedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.enqueuedTimestamp?(0,i.jsx)(D.Q,{startUnix:n.enqueuedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.priority}),(0,i.jsx)("td",{children:(0,i.jsx)(G,{pendingStep:n,onUpdate:r})})]})},W=(0,S.Ps)(N()),X=(0,S.Ps)(U()),Z=(0,S.Ps)(A()),ee=(0,S.Ps)(Q())}}]);
//# sourceMappingURL=7046.2c9b74f6c5a31dac.js.map