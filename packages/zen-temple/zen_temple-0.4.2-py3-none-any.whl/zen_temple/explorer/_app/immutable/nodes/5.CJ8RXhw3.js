import"../chunks/Bg9kRutz.js";import{p as da,a as s,s as m,f as z,b as ca,c as g,d as l,g as e,e as Q,r as f,h as Be}from"../chunks/AM9C8FsA.js";import{s as Ze}from"../chunks/B6F1ZNoe.js";import{p as t,i as k,b as Ee}from"../chunks/D-bC_bvq.js";import{e as _a,i as ua}from"../chunks/C3oA2Kkp.js";import{t as h,a as v,c as Y}from"../chunks/CmMFD2-g.js";import{d as va}from"../chunks/DY_kk6CS.js";import{S as pa,b as U,f as X,c as ga,B as Me}from"../chunks/B0llF2z6.js";import{A as fa}from"../chunks/Rklybz_u.js";import{D as Pe}from"../chunks/B5Bv56A2.js";import{g as $}from"../chunks/CqS7hfz2.js";import{T as ma}from"../chunks/CiahgOPt.js";var ha=h("<option> </option>"),ba=h('<h3>Carrier</h3> <select class="form-select"><!> </select> <h3>Year</h3> <!> <h3>Smoothing Window Size</h3> <!>',1),ya=h('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Technology Subdivision</h3> <!> <h3>Node</h3> <!></div></div></div>'),wa=h('<div class="accordion-item variable-selction"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!>',1),xa=h('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Sa=h('<div class="text-center">No technologies with this selection.</div>'),za=h('<div class="text-center">No carriers with this selection.</div>'),ka=h('<div class="text-center">No solution selected.</div>'),Ca=h('<div class="text-center">No data with this selection.</div>'),Da=h('<div class="text-center">No locations with this selection.</div>'),Ta=h('<div class="text-center">No data with this selection.</div>'),Oa=h("<!> <!>",1),ja=h('<h2>The Energy Balance Storage</h2> <div class="position-relative z-1"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!></div></div></div> <div class="mt-4"><!></div>',1);function La(He,Ke){da(Ke,!0);let x=s(null),ce=s(null),_e=s(null),q=s(null),G=s(null),C=s(null),ee=s(null),ae=s(null),xe=s(null),Se=s(null),O=s(t([])),R=s(t([])),I=s(t([])),j=null,c=s(null);const Le="storage_level";let F=s(null),te=[],W=s(t([])),D=s(!1),S=s(!1),ue=s(""),Ve="",ve=s(!0),le=s(t([])),oe=s(0);const Ye=["Hourly","Daily","Weekly","Monthly"];let pe=s("Hourly"),re,ie,J=s(t([])),ge=s(t([])),B=s(t([])),qe=Q(()=>({type:"line",data:{datasets:e(J),labels:e(B)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Level [${De()}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a=>{ie.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a=>{ie.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}})),Ge=Q(()=>({counter:1,type:"line",data:{datasets:e(ge),labels:e(B)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{type:"linear",stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Flow [${De()}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a=>{re.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a=>{re.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}}));function ze(){l(W,t(e(R))),te=e(I)}async function ke(){if(l(x,null),e(c)===null)return;let a=Math.floor((e(oe)-e(c).detail.system.reference_year)/e(c).detail.system.interval_between_years),r=1;switch(e(pe)){case"Daily":r=24;break;case"Weekly":r=168;break;case"Monthly":r=720;break}let p=await U(e(c).solution_name,$("storage_level"),e(c).scenario_name,a,r);l(x,t(p.data)),j=p.unit;let b=await U(e(c).solution_name,$("flow_storage_charge"),e(c).scenario_name,a,r);l(ce,t(b.data));let i=await U(e(c).solution_name,$("flow_storage_discharge"),e(c).scenario_name,a,r);l(_e,t(i.data));let u=await U(e(c).solution_name,$("flow_storage_spillage"),e(c).scenario_name,a,r);l(q,t(u.data));let _=await U(e(c).solution_name,$("flow_storage_inflow"),e(c).scenario_name,a,r);l(G,t(_.data))}async function Ie(){e(c)!==null&&(l(S,!0),l(oe,t(e(le)[0])),await ke(),Je(),Te(),Ce(),ze(),se(),l(S,!1))}async function fe(){l(S,!0),await ke(),Te(),Ce(),ze(),se(),l(S,!1)}function Ce(){l(R,t(Array.from(new Set(e(x).data.map(a=>a.node))))),l(W,t(e(R)))}function De(){return(j==null?void 0:j.data[0][0])||(j==null?void 0:j.data[0].units)||""}function Je(){if(l(O,t([])),!e(x))return;let a=Array.from(e(x).data.map(r=>r.technology));e(x).data.forEach(r=>{let p=r.technology,b=e(c).detail.reference_carrier[p];!e(O).includes(b)&&a.includes(r.technology)&&e(O).push(b)}),e(O).length>0&&l(F,t(e(O)[0]))}function Te(){let a=Array.from(new Set(e(x).data.map(r=>r.technology)));l(I,t(a.filter(r=>{var p;return((p=e(c))==null?void 0:p.detail.reference_carrier[r])==e(F)}))),te=e(I)}function se(){var b;if(e(W).length==0||te.length==0||e(x)===null||e(ce)===null||e(_e)===null||e(G)===null||e(q)===null){l(J,t([])),l(B,t([])),l(ue,"");return}let a={},r={};if(a.technology=te,r.node=e(W),l(C,t(X(e(x).data,a,r,[],!1,"line","").map(i=>({...i,fill:"origin"})))),l(ee,t(X(e(ce).data,a,r,[],!1,"line","_charge").map(i=>({...i,stepped:!0,fill:"origin"})))),l(ae,t(X(e(_e).data,a,r,[],!1,"line","_discharge").map(i=>{let u={};for(let _ in i.data)u[_]=i.data[_]>0?-i.data[_]:i.data[_];return{data:u,label:i.label,type:i.type,stepped:!0,fill:"origin"}}))),l(Se,t(X(e(q).data,a,r,[],!1,"line","_spillage").map(i=>{let u={};for(let _ in i.data)u[_]=i.data[_]>0?-i.data[_]:i.data[_];return{data:u,label:i.label,type:i.type,stepped:!0,fill:"origin"}}))),l(xe,t(X(e(G).data,a,r,[],!1,"line","_inflow").map(i=>({...i,stepped:!0,fill:"origin"})))),l(J,t(e(C))),l(ge,t(e(ee).concat(e(ae)).concat(e(xe)).concat(e(Se)))),l(B,t(Object.keys(e(C)[0].data))),e(ve))l(J,t(e(C))),l(B,t(Object.keys(e(C)[0].data)));else{let i={};for(const n in e(C)[0].data)i[n]=e(C).map(o=>o.data[n]).reduce((o,d)=>o+d,0);let u={};for(const n in e(ee)[0].data)u[n]=e(ee).map(o=>o.data[n]).reduce((o,d)=>o+d,0);let _={};for(const n in e(ae)[0].data)_[n]=e(ae).map(o=>o.data[n]).reduce((o,d)=>o+d,0);let Z={};for(const n in e(G).data[0])Z[n]=e(G).data.map(o=>o.data[n]).reduce((o,d)=>o+d,0);let E={};for(const n in e(q).data[0])E[n]=e(q).data.map(o=>o.data[n]).reduce((o,d)=>o+d,0);l(J,t([{data:Object.values(i),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}])),l(ge,t([{data:Object.values(u),label:"Flow Storage Charge",type:"line",borderColor:"blue",stepped:!0},{data:Object.values(_),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(Z),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(E),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0}])),l(B,t(Object.keys(i)))}let p=e(c).solution_name.split(".");l(ue,t([p[(p==null?void 0:p.length)-1],(b=e(c))==null?void 0:b.scenario_name,Le,e(F)].join("_")))}var Oe=ja(),me=m(z(Oe),2),je=g(me),Ae=g(je),he=g(Ae),Ne=m(g(he),2),Re=g(Ne),Qe=g(Re);const Ue=Q(()=>!e(S)&&!e(D));pa(Qe,{solution_selected:Ie,get enabled(){return e(Ue)},get selected_solution(){return e(c)},set selected_solution(a){l(c,t(a))},get loading(){return e(D)},set loading(a){l(D,t(a))},get years(){return e(le)},set years(a){l(le,t(a))}}),f(Re),f(Ne),f(he);var Xe=m(he,2);{var $e=a=>{var r=wa(),p=z(r),b=m(g(p),2),i=g(b),u=g(i);{var _=n=>{var o=ba(),d=m(z(o),2);d.__change=fe;var A=g(d);_a(A,17,()=>e(O),ua,(T,K)=>{var w=ha(),N={},ye=g(w,!0);f(w),Be(()=>{N!==(N=e(K))&&(w.value=(w.__value=e(K))==null?"":e(K)),Ze(ye,e(K))}),v(T,w)});var M=m(A);f(d);var P=m(d,4);const y=Q(()=>!e(S)&&!e(D));Pe(P,{get options(){return e(le)},selection_changed:fe,get enabled(){return e(y)},get selected_option(){return e(oe)},set selected_option(T){l(oe,t(T))}});var H=m(P,4);const be=Q(()=>!e(S)&&!e(D));Pe(H,{options:Ye,selection_changed:fe,get enabled(){return e(be)},get selected_option(){return e(pe)},set selected_option(T){l(pe,t(T))}}),Be(()=>{d.disabled=e(S)||e(D),Ze(M,` disabled=${(e(S)||e(D))??""}`)}),ga(d,()=>e(F),T=>l(F,T)),v(n,o)};k(u,n=>{e(O).length>0&&n(_)})}f(i),f(b),f(p);var Z=m(p,2);{var E=n=>{var o=ya(),d=m(g(o),2),A=g(d),M=m(g(A),2);ma(M,{change:se,get value(){return e(ve)},set value(y){l(ve,t(y))}});var P=m(M,4);fa(P,{get elements(){return e(R)},selection_changed:se,get selected_elements(){return e(W)},set selected_elements(y){l(W,t(y))}}),f(A),f(d),f(o),v(n,o)};k(Z,n=>{e(x)&&e(F)&&e(I).length>0&&e(R).length>0&&n(E)})}v(a,r)};k(Xe,a=>{!e(D)&&e(c)&&a($e)})}f(Ae),f(je),f(me);var Fe=m(me,2),ea=g(Fe);{var aa=a=>{var r=xa();v(a,r)},ta=a=>{var r=Y(),p=z(r);{var b=u=>{var _=Sa();v(u,_)},i=u=>{var _=Y(),Z=z(_);{var E=o=>{var d=za();v(o,d)},n=o=>{var d=Y(),A=z(d);{var M=y=>{var H=ka();v(y,H)},P=y=>{var H=Y(),be=z(H);{var T=w=>{var N=Ca();v(w,N)},K=w=>{var N=Y(),ye=z(N);{var la=L=>{var ne=Da();v(L,ne)},oa=L=>{var ne=Y(),ra=z(ne);{var ia=V=>{var de=Ta();v(V,de)},sa=V=>{var de=Oa(),We=z(de);Ee(Me(We,{get config(){return e(qe)},get plot_name(){return e(ue)},zoom:!0}),we=>re=we,()=>re);var na=m(We,2);Ee(Me(na,{get config(){return e(Ge)},get plot_name(){return Ve},zoom:!0}),we=>ie=we,()=>ie),v(V,de)};k(ra,V=>{e(C).length==0?V(ia):V(sa,!1)},!0)}v(L,ne)};k(ye,L=>{e(R).length==0?L(la):L(oa,!1)},!0)}v(w,N)};k(be,w=>{e(C)==null?w(T):w(K,!1)},!0)}v(y,H)};k(A,y=>{e(c)==null?y(M):y(P,!1)},!0)}v(o,d)};k(Z,o=>{e(O).length==0?o(E):o(n,!1)},!0)}v(u,_)};k(p,u=>{e(I).length==0?u(b):u(i,!1)},!0)}v(a,r)};k(ea,a=>{e(D)||e(S)?a(aa):a(ta,!1)})}f(Fe),v(He,Oe),ca()}va(["change"]);export{La as component};
