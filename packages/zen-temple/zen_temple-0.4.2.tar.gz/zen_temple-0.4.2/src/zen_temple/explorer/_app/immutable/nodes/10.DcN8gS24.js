import"../chunks/Bg9kRutz.js";import{p as We,a as p,s as g,f as P,b as Xe,c as f,d as a,g as e,e as E,r as v,h as ae}from"../chunks/AM9C8FsA.js";import{s as ke}from"../chunks/B6F1ZNoe.js";import{p as t,i as A}from"../chunks/D-bC_bvq.js";import{e as Te,i as ze}from"../chunks/C3oA2Kkp.js";import{t as y,a as _,c as ee}from"../chunks/CmMFD2-g.js";import{d as Ze}from"../chunks/DY_kk6CS.js";import{S as $e,d as et,f as tt,c as Ne,B as at}from"../chunks/B0llF2z6.js";import{A as ve}from"../chunks/Rklybz_u.js";import{R as ue}from"../chunks/CrHIdHvl.js";import{g as re}from"../chunks/CqS7hfz2.js";var rt=(oe,W,Y)=>{W(),Y()},ot=y("<option> </option>"),st=y("<h3>Subvariable</h3> <!>",1),lt=(oe,W,Y)=>{W(),Y()},it=y("<option> </option>"),nt=y('<h3>Carrier</h3> <select class="form-select"></select>',1),ct=y('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Variable</h3> <select class="form-select"></select> <!> <!></div></div></div>'),dt=y('<div class="col-6"><h3>Aggregation</h3> <!></div>'),_t=y("<h3>Technology</h3> <!>",1),vt=y("<h3>Node</h3> <!>",1),ut=y('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><div class="row"><!> <div class="col-6"><h3>Normalisation</h3> <!></div></div> <!> <h3>Year</h3> <!></div></div></div>'),pt=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),gt=y("<div></div>"),ft=y("<div></div>"),ht=y('<div class="text-center">No technologies with this selection.</div>'),mt=y('<div class="text-center">No carriers with this selection.</div>'),bt=y('<div class="text-center">No data with this selection.</div>'),xt=y('<h2>Production</h2> <div class="z-1 position-relative"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!> <!></div></div></div> <div class="mt-4"><!></div>',1);function Bt(oe,W){We(W,!0);let Y=null,h=p(t([])),X=p(t([])),se=p(t([])),le=p(t([])),Z=p(t([])),M=t({conversion:["input","output"],storage:["charge","discharge"],transport:[],import_export:["import","export"]});const Oe=["technology","node"];let F=p(t([])),G=null,s=p(null),c=p(null),O=p(null),z=p(t([])),L=p(t([])),q=p(t([])),R=p(null),$=p(t([]));const Ae=["not_normalized","normalized"];let ie=p("not_normalized"),N=p(!1),k=p(!1),pe=p("plot"),H=p("node"),Ye=t([]),je=E(()=>e(c)+" ["+Ce()+"]"),Be=E(()=>({type:"bar",data:{datasets:e(F),labels:Ye},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:e(je)}}}}}));function ne(){Pe().then(()=>{Re(),fe(),Ve(),I()})}function ce(){a($,t(e(Z))),a(q,t(e(X))),a(L,t(e(z)))}function ge(){switch(e(c)){case"conversion":return"flow_conversion_"+e(R);case"storage":return"flow_storage_"+e(R);case"transport":return"flow_transport";case"import_export":return"flow_"+e(R);default:return null}}function Ce(){return(G==null?void 0:G.data[0][0])||(G==null?void 0:G.data[0].units)||""}async function Pe(){var d;a(k,!0),Y=null;let r=ge();if(r===null){a(k,!1);return}r=re(r,(d=e(s))==null?void 0:d.version);let i=await et(e(s).solution_name,r,e(s).scenario_name,e(s).detail.system.reference_year,e(s).detail.system.interval_between_years);i.data!==null&&(Y=i.data,G=i.unit,a(k,!1))}function Re(){var d,b;if(Y==null){a(h,t([]));return}if(e(s)==null){a(h,t([]));return}a(F,t([])),a(O,"");let r=new Set(Y.data.map(o=>o.technology)),i=[...new Set([...r].map(o=>{var l;return(l=e(s))==null?void 0:l.detail.reference_carrier[o]}))];switch(e(c)=="import_export"&&(i=[...new Set(Y.data.map(o=>o.carrier))]),e(c)){case re("import_export",(d=e(s))==null?void 0:d.version):e(R)=="import"?a(h,t(e(s).detail.carriers_import)):a(h,t(e(s).detail.carriers_export));break;case re("conversion",(b=e(s))==null?void 0:b.version):let o=e(s).detail.carriers_output;e(R)=="input"&&(o=e(s).detail.carriers_input),a(h,t([]));for(const l in o)a(h,t([...new Set([...e(h),...o[l]])]));break;default:a(h,t(e(s).detail.system.set_carriers))}a(h,t(e(h).filter(o=>i.includes(o)))),e(h).length==1&&a(O,t(e(h)[0])),ce()}function fe(){var r,i,d;if(a(F,t([])),e(c)!=null&&e(O)!=null){switch(a(z,t(((r=e(s))==null?void 0:r.detail.system.set_technologies.slice())??[])),e(c)){case"conversion":a(z,t([]));let b=e(s).detail.carriers_input;e(R)=="output"&&(b=e(s).detail.carriers_output);for(const o in b)b[o].includes(e(O))&&e(z).push(o);break;case"storage":a(z,t(((i=e(s))==null?void 0:i.detail.system.set_storage_technologies.filter(o=>{var l;return((l=e(s))==null?void 0:l.detail.reference_carrier[o])==e(O)}))??[]));break;case"transport":a(z,t(((d=e(s))==null?void 0:d.detail.system.set_transport_technologies.filter(o=>{var l;return((l=e(s))==null?void 0:l.detail.reference_carrier[o])==e(O)}))??[]));break;case"import_export":a(z,t([]));break}e(z).length==1&&a(L,t([e(z)[0]])),ce()}}function Ve(){a(le,t(e(X))),e(c)=="transport"&&a(le,t(e(se))),ce()}function De(){a(F,t([])),e(c)!=null&&(M[e(c)]!=null&&a(R,t(M[e(c)][0])),e(c)=="import_export"&&a(H,"technology"))}function I(){var j,V;if(e(c)=="import_export"&&a(H,"node"),e(H)=="technology"?a(q,t(e(X))):a(L,t(e(z))),e(q).length==0||e($).length==0||e(L).length==0&&e(c)!="import_export"||!Y){a(F,t([]));return}let r={},i={},d="node";e(c)=="transport"&&(d="edge"),e(c)=="import_export"?(r[d]=e(q),i.carrier=[e(O)]):e(H)=="technology"?(r[d]=e(q),i.technology=e(L)):(r.technology=e(L),i[d]=e(q));let b=e(Z).filter(C=>!e($).includes(C)),o=Y.data.filter(C=>C.carrier===void 0||C.carrier==e(O));a(F,t(tt(o,r,i,b,e(ie)=="normalized")));let l=e(s).solution_name.split(".");a(pe,t([l[(l==null?void 0:l.length)-1],(j=e(s))==null?void 0:j.scenario_name,re(ge(),(V=e(s))==null?void 0:V.version),e(O)].join("_")))}var he=xt(),de=g(P(he),2),me=f(de),be=f(me),_e=f(be),xe=g(f(_e),2),ye=f(xe),Ee=f(ye);const Fe=E(()=>!e(N)&&!e(k));$e(Ee,{solution_selected:ne,get enabled(){return e(Fe)},get carriers(){return e(h)},set carriers(r){a(h,t(r))},get nodes(){return e(X)},set nodes(r){a(X,t(r))},get years(){return e(Z)},set years(r){a(Z,t(r))},get selected_solution(){return e(s)},set selected_solution(r){a(s,t(r))},get edges(){return e(se)},set edges(r){a(se,t(r))},get loading(){return e(N)},set loading(r){a(N,t(r))}}),v(ye),v(xe),v(_e);var we=g(_e,2);{var Le=r=>{var i=ct(),d=g(f(i),2),b=f(d),o=g(f(b),2);o.__change=[rt,De,ne],Te(o,21,()=>Object.entries(M),ze,(w,m)=>{let u=()=>e(m)[0];var S=ot(),T={},B=f(S,!0);v(S),ae(()=>{T!==(T=u())&&(S.value=(S.__value=u())==null?"":u()),ke(B,u())}),_(w,S)}),v(o);var l=g(o,2);{var j=w=>{var m=st(),u=g(P(m),2);const S=E(()=>!e(N)&&!e(k));ue(u,{get options(){return M[e(c)]},selection_changed:T=>ne(),get enabled(){return e(S)},get selected_option(){return e(R)},set selected_option(T){a(R,t(T))}}),_(w,m)};A(l,w=>{M&&e(c)&&M[e(c)]!=null&&w(j)})}var V=g(l,2);{var C=w=>{var m=nt(),u=g(P(m),2);u.__change=[lt,fe,I],Te(u,21,()=>e(h),ze,(S,T)=>{var B=it(),n={},x=f(B,!0);v(B),ae(()=>{n!==(n=e(T))&&(B.value=(B.__value=e(T))==null?"":e(T)),ke(x,e(T))}),_(S,B)}),v(u),ae(()=>u.disabled=e(N)||e(k)),Ne(u,()=>e(O),S=>a(O,S)),_(w,m)};A(V,w=>{e(c)!=null&&e(h).length>0&&w(C)})}v(b),v(d),v(i),ae(()=>o.disabled=e(N)||e(k)),Ne(o,()=>e(c),w=>a(c,w)),_(r,i)};A(we,r=>{!e(N)&&e(s)&&r(Le)})}var qe=g(we,2);{var Ge=r=>{var i=ut(),d=g(f(i),2),b=f(d),o=f(b),l=f(o);{var j=n=>{var x=dt(),J=g(f(x),2);const K=E(()=>!e(N)&&!e(k));ue(J,{options:Oe,selection_changed:D=>I(),get enabled(){return e(K)},get selected_option(){return e(H)},set selected_option(D){a(H,t(D))}}),v(x),_(n,x)};A(l,n=>{e(c)!="import_export"&&n(j)})}var V=g(l,2),C=g(f(V),2);const w=E(()=>!e(N)&&!e(k));ue(C,{options:Ae,selection_changed:n=>I(),get enabled(){return e(w)},get selected_option(){return e(ie)},set selected_option(n){a(ie,t(n))}}),v(V),v(o);var m=g(o,2);{var u=n=>{var x=_t(),J=g(P(x),2);const K=E(()=>!e(N)&&!e(k));ve(J,{get elements(){return e(z)},get enabled(){return e(K)},selection_changed:()=>{I()},get selected_elements(){return e(L)},set selected_elements(D){a(L,t(D))}}),_(n,x)},S=n=>{var x=vt(),J=g(P(x),2);const K=E(()=>!e(N)&&!e(k));ve(J,{get elements(){return e(le)},get enabled(){return e(K)},selection_changed:D=>{I()},get selected_elements(){return e(q)},set selected_elements(D){a(q,t(D))}}),_(n,x)};A(m,n=>{e(H)=="technology"?n(u):n(S,!1)})}var T=g(m,4);const B=E(()=>!e(N)&&!e(k));ve(T,{get elements(){return e(Z)},get enabled(){return e(B)},selection_changed:n=>{I()},get selected_elements(){return e($)},set selected_elements(n){a($,t(n))}}),v(b),v(d),v(i),_(r,i)};A(qe,r=>{!e(k)&&e(O)&&(e(z).length>0||e(c)=="import_export")&&r(Ge)})}v(be),v(me),v(de);var Se=g(de,2),He=f(Se);{var Ie=r=>{var i=pt();_(r,i)},Je=r=>{var i=ee(),d=P(i);{var b=l=>{var j=gt();_(l,j)},o=l=>{var j=ee(),V=P(j);{var C=m=>{var u=ft();_(m,u)},w=m=>{var u=ee(),S=P(u);{var T=n=>{var x=ht();_(n,x)},B=n=>{var x=ee(),J=P(x);{var K=Q=>{var te=mt();_(Q,te)},D=Q=>{var te=ee(),Ke=P(te);{var Me=U=>{var Ue=bt();_(U,Ue)},Qe=U=>{at(U,{get config(){return e(Be)},get plot_name(){return e(pe)}})};A(Ke,U=>{e(F).length==0?U(Me):U(Qe,!1)},!0)}_(Q,te)};A(J,Q=>{e(h).length==0?Q(K):Q(D,!1)},!0)}_(n,x)};A(S,n=>{e(z).length==0&&e(c)!="import_export"?n(T):n(B,!1)},!0)}_(m,u)};A(V,m=>{e(F)==null?m(C):m(w,!1)},!0)}_(l,j)};A(d,l=>{e(s)==null?l(b):l(o,!1)},!0)}_(r,i)};A(He,r=>{e(N)||e(k)?r(Ie):r(Je,!1)})}v(Se),_(oe,he),Xe()}Ze(["change"]);export{Bt as component};
