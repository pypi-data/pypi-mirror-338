import"../chunks/Bg9kRutz.js";import{p as Qe,a as _,s as f,f as P,b as Ue,c as h,d as a,g as e,e as q,r as p,h as te}from"../chunks/AM9C8FsA.js";import{s as Te}from"../chunks/B6F1ZNoe.js";import{p as t,i as A}from"../chunks/D-bC_bvq.js";import{e as ze,i as Ne}from"../chunks/DtXDWrBL.js";import{t as y,a as v,c as $}from"../chunks/CmMFD2-g.js";import{d as We}from"../chunks/DY_kk6CS.js";import{S as Xe,d as Ze,f as $e,c as Oe,B as et}from"../chunks/CKOPQ9yJ.js";import{A as _e}from"../chunks/B6QOD9Jc.js";import{R as ve}from"../chunks/CZs2-MWJ.js";import{g as ae}from"../chunks/CqS7hfz2.js";var tt=(re,W,B)=>{W(),B()},at=y("<option> </option>"),rt=y("<h3>Subvariable</h3> <!>",1),ot=(re,W,B)=>{W(),B()},st=y("<option> </option>"),lt=y('<h3>Carrier</h3> <select class="form-select"></select>',1),it=y('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Variable</h3> <select class="form-select"></select> <!> <!></div></div></div>'),nt=y('<div class="col-6"><h3>Aggregation</h3> <!></div>'),ct=y("<h3>Technology</h3> <!>",1),dt=y("<h3>Node</h3> <!>",1),_t=y('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><div class="row"><!> <div class="col-6"><h3>Normalisation</h3> <!></div></div> <!> <h3>Year</h3> <!></div></div></div>'),vt=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),pt=y("<div></div>"),ut=y("<div></div>"),gt=y('<div class="text-center">No technologies with this selection.</div>'),ft=y('<div class="text-center">No carriers with this selection.</div>'),ht=y('<div class="text-center">No data with this selection.</div>'),mt=y('<h2>Production</h2> <div class="z-1 position-relative"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!> <!></div></div></div> <div class="mt-4"><!></div>',1);function At(re,W){Qe(W,!0);let B=null,m=_(t([])),X=_(t([])),oe=_(t([])),se=_(t([])),Z=_(t([])),K=t({conversion:["input","output"],storage:["charge","discharge"],transport:[],import_export:["import","export"]});const je=["technology","node"];let D=_(t([])),pe=_(t({})),s=_(null),c=_(null),k=_(null),N=_(t([])),F=_(t([])),L=_(t([])),R=_(null),M=_(t([]));const Ae=["not_normalized","normalized"];let le=_("not_normalized"),O=_(!1),T=_(!1),ue=_("plot"),G=_("node"),ge=_(t([])),Be=q(()=>({type:"bar",data:{datasets:e(D),labels:e(ge)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`${e(c)} [${e(k)?e(pe)[e(k)]:""}]`}}}}}));function ie(){Ce().then(()=>{Ee(),he(),Pe(),H()})}function ne(){a(M,t(e(Z))),a(L,t(e(X))),a(F,t(e(N)))}function fe(){switch(e(c)){case"conversion":return"flow_conversion_"+e(R);case"storage":return"flow_storage_"+e(R);case"transport":return"flow_transport";case"import_export":return"flow_"+e(R);default:return null}}async function Ce(){var d,u;a(T,!0),B=null;let r=fe();if(r===null){a(T,!1);return}r=ae(r,(d=e(s))==null?void 0:d.version);let l=await Ze(e(s).solution_name,r,e(s).scenario_name,e(s).detail.system.reference_year,e(s).detail.system.interval_between_years);l.data!==null&&(B=l.data,(u=l.unit)!=null&&u.data&&a(pe,t(Object.fromEntries(l.unit.data.map(o=>[o.carrier,o[0]||o.units])))),a(T,!1))}function Ee(){var d,u;if(B==null){a(m,t([]));return}if(e(s)==null){a(m,t([]));return}a(D,t([])),a(k,"");let r=new Set(B.data.map(o=>o.technology)),l=[...new Set([...r].map(o=>{var i;return(i=e(s))==null?void 0:i.detail.reference_carrier[o]}))];switch(e(c)=="import_export"&&(l=[...new Set(B.data.map(o=>o.carrier))]),e(c)){case ae("import_export",(d=e(s))==null?void 0:d.version):e(R)=="import"?a(m,t(e(s).detail.carriers_import)):a(m,t(e(s).detail.carriers_export));break;case ae("conversion",(u=e(s))==null?void 0:u.version):let o=e(s).detail.carriers_output;e(R)=="input"&&(o=e(s).detail.carriers_input),a(m,t([]));for(const i in o)a(m,t([...new Set([...e(m),...o[i]])]));break;default:a(m,t(e(s).detail.system.set_carriers))}a(m,t(e(m).filter(o=>l.includes(o)))),e(m).length==1&&a(k,t(e(m)[0])),ne()}function he(){var r,l,d;if(a(D,t([])),e(c)!=null&&e(k)!=null){switch(a(N,t(((r=e(s))==null?void 0:r.detail.system.set_technologies.slice())??[])),e(c)){case"conversion":a(N,t([]));let u=e(s).detail.carriers_input;e(R)=="output"&&(u=e(s).detail.carriers_output);for(const o in u)u[o].includes(e(k))&&e(N).push(o);break;case"storage":a(N,t(((l=e(s))==null?void 0:l.detail.system.set_storage_technologies.filter(o=>{var i;return((i=e(s))==null?void 0:i.detail.reference_carrier[o])==e(k)}))??[]));break;case"transport":a(N,t(((d=e(s))==null?void 0:d.detail.system.set_transport_technologies.filter(o=>{var i;return((i=e(s))==null?void 0:i.detail.reference_carrier[o])==e(k)}))??[]));break;case"import_export":a(N,t([]));break}e(N).length==1&&a(F,t([e(N)[0]])),ne()}}function Pe(){a(se,t(e(X))),e(c)=="transport"&&a(se,t(e(oe))),ne()}function Re(){a(D,t([])),e(c)!=null&&(K[e(c)]!=null&&a(R,t(K[e(c)][0])),e(c)=="import_export"&&a(G,"technology"))}function H(){var C,V;if(e(c)=="import_export"&&a(G,"node"),e(G)=="technology"?a(L,t(e(X))):a(F,t(e(N))),e(L).length==0||e(M).length==0||e(F).length==0&&e(c)!="import_export"||!B){a(D,t([]));return}let r={},l={},d="node";e(c)=="transport"&&(d="edge"),e(c)=="import_export"?(r[d]=e(L),l.carrier=[e(k)]):e(G)=="technology"?(r[d]=e(L),l.technology=e(F)):(r.technology=e(F),l[d]=e(L));let u=e(Z).filter(j=>!e(M).includes(j)),o=B.data.filter(j=>j.carrier===void 0||j.carrier==e(k));a(D,t($e(o,r,l,u,e(le)=="normalized"))),a(ge,t(e(M).map(j=>j.toString())));let i=e(s).solution_name.split(".");a(ue,t([i[(i==null?void 0:i.length)-1],(C=e(s))==null?void 0:C.scenario_name,ae(fe(),(V=e(s))==null?void 0:V.version),e(k)].join("_")))}var me=mt(),ce=f(P(me),2),be=h(ce),xe=h(be),de=h(xe),ye=f(h(de),2),we=h(ye),Ve=h(we);const Ye=q(()=>!e(O)&&!e(T));Xe(Ve,{solution_selected:ie,get enabled(){return e(Ye)},get carriers(){return e(m)},set carriers(r){a(m,t(r))},get nodes(){return e(X)},set nodes(r){a(X,t(r))},get years(){return e(Z)},set years(r){a(Z,t(r))},get selected_solution(){return e(s)},set selected_solution(r){a(s,t(r))},get edges(){return e(oe)},set edges(r){a(oe,t(r))},get loading(){return e(O)},set loading(r){a(O,t(r))}}),p(we),p(ye),p(de);var Se=f(de,2);{var De=r=>{var l=it(),d=f(h(l),2),u=h(d),o=f(h(u),2);o.__change=[tt,Re,ie],ze(o,21,()=>Object.entries(K),Ne,(w,b)=>{let g=()=>e(b)[0];var S=at(),z={},E=h(S,!0);p(S),te(()=>{z!==(z=g())&&(S.value=(S.__value=g())==null?"":g()),Te(E,g())}),v(w,S)}),p(o);var i=f(o,2);{var C=w=>{var b=rt(),g=f(P(b),2);const S=q(()=>!e(O)&&!e(T));ve(g,{get options(){return K[e(c)]},selection_changed:z=>ie(),get enabled(){return e(S)},get selected_option(){return e(R)},set selected_option(z){a(R,t(z))}}),v(w,b)};A(i,w=>{K&&e(c)&&K[e(c)]!=null&&w(C)})}var V=f(i,2);{var j=w=>{var b=lt(),g=f(P(b),2);g.__change=[ot,he,H],ze(g,21,()=>e(m),Ne,(S,z)=>{var E=st(),n={},x=h(E,!0);p(E),te(()=>{n!==(n=e(z))&&(E.value=(E.__value=e(z))==null?"":e(z)),Te(x,e(z))}),v(S,E)}),p(g),te(()=>g.disabled=e(O)||e(T)),Oe(g,()=>e(k),S=>a(k,S)),v(w,b)};A(V,w=>{e(c)!=null&&e(m).length>0&&w(j)})}p(u),p(d),p(l),te(()=>o.disabled=e(O)||e(T)),Oe(o,()=>e(c),w=>a(c,w)),v(r,l)};A(Se,r=>{!e(O)&&e(s)&&r(De)})}var Fe=f(Se,2);{var Le=r=>{var l=_t(),d=f(h(l),2),u=h(d),o=h(u),i=h(o);{var C=n=>{var x=nt(),I=f(h(x),2);const J=q(()=>!e(O)&&!e(T));ve(I,{options:je,selection_changed:Y=>H(),get enabled(){return e(J)},get selected_option(){return e(G)},set selected_option(Y){a(G,t(Y))}}),p(x),v(n,x)};A(i,n=>{e(c)!="import_export"&&n(C)})}var V=f(i,2),j=f(h(V),2);const w=q(()=>!e(O)&&!e(T));ve(j,{options:Ae,selection_changed:n=>H(),get enabled(){return e(w)},get selected_option(){return e(le)},set selected_option(n){a(le,t(n))}}),p(V),p(o);var b=f(o,2);{var g=n=>{var x=ct(),I=f(P(x),2);const J=q(()=>!e(O)&&!e(T));_e(I,{get elements(){return e(N)},get enabled(){return e(J)},selection_changed:()=>{H()},get selected_elements(){return e(F)},set selected_elements(Y){a(F,t(Y))}}),v(n,x)},S=n=>{var x=dt(),I=f(P(x),2);const J=q(()=>!e(O)&&!e(T));_e(I,{get elements(){return e(se)},get enabled(){return e(J)},selection_changed:Y=>{H()},get selected_elements(){return e(L)},set selected_elements(Y){a(L,t(Y))}}),v(n,x)};A(b,n=>{e(G)=="technology"?n(g):n(S,!1)})}var z=f(b,4);const E=q(()=>!e(O)&&!e(T));_e(z,{get elements(){return e(Z)},get enabled(){return e(E)},selection_changed:n=>{H()},get selected_elements(){return e(M)},set selected_elements(n){a(M,t(n))}}),p(u),p(d),p(l),v(r,l)};A(Fe,r=>{!e(T)&&e(k)&&(e(N).length>0||e(c)=="import_export")&&r(Le)})}p(xe),p(be),p(ce);var ke=f(ce,2),qe=h(ke);{var Ge=r=>{var l=vt();v(r,l)},He=r=>{var l=$(),d=P(l);{var u=i=>{var C=pt();v(i,C)},o=i=>{var C=$(),V=P(C);{var j=b=>{var g=ut();v(b,g)},w=b=>{var g=$(),S=P(g);{var z=n=>{var x=gt();v(n,x)},E=n=>{var x=$(),I=P(x);{var J=Q=>{var ee=ft();v(Q,ee)},Y=Q=>{var ee=$(),Ie=P(ee);{var Je=U=>{var Me=ht();v(U,Me)},Ke=U=>{et(U,{get config(){return e(Be)},get plot_name(){return e(ue)}})};A(Ie,U=>{e(D).length==0?U(Je):U(Ke,!1)},!0)}v(Q,ee)};A(I,Q=>{e(m).length==0?Q(J):Q(Y,!1)},!0)}v(n,x)};A(S,n=>{e(N).length==0&&e(c)!="import_export"?n(z):n(E,!1)},!0)}v(b,g)};A(V,b=>{e(D)==null?b(j):b(w,!1)},!0)}v(i,C)};A(d,i=>{e(s)==null?i(u):i(o,!1)},!0)}v(r,l)};A(qe,r=>{e(O)||e(T)?r(Ge):r(He,!1)})}p(ke),v(re,me),Ue()}We(["change"]);export{At as component};
