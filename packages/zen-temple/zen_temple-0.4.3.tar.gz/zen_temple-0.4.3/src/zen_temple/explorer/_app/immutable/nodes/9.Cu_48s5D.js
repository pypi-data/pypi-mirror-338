import"../chunks/Bg9kRutz.js";import{p as Ze,a as i,s as l,f as x,b as $e,c as v,d as a,g as e,e as ue,r as u,h as et,t as tt}from"../chunks/AM9C8FsA.js";import{s as at}from"../chunks/B6F1ZNoe.js";import{p as t,i as k}from"../chunks/D-bC_bvq.js";import{t as y,a as f,c as Ee}from"../chunks/CmMFD2-g.js";import{r as ot}from"../chunks/C6Ut6Zxy.js";import{d as rt}from"../chunks/DY_kk6CS.js";import{b as nt,A as ae}from"../chunks/C0g7NPoM.js";import{S as st,d as H,e as it,f as Te,B as lt}from"../chunks/WCHrdp7r.js";import{R as me}from"../chunks/BsIw7lIP.js";import{g as T}from"../chunks/CqS7hfz2.js";var ct=y("<h3>Cumulation</h3> <!>",1),dt=y("<h3>Technology</h3> <!>",1),_t=y("<h3>Carrier</h3> <!>",1),vt=y("<!> <!>",1),ut=y("<h3>Location</h3> <!>",1),mt=y('<div class="row"><div class="col-6"><h3>Aggregation</h3> <!></div> <div class="col-6"><h3>Normalisation</h3> <!></div></div> <!>',1),gt=y('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><!> <h3>Year</h3> <!></div></div></div>'),ft=y('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Subdivision</h3> <input type="checkbox" class="btn-check" id="btn-check-outlined" autocomplete="off"> <label class="btn btn-outline-primary" for="btn-check-outlined"> </label><br> <!></div></div></div> <!>',1),pt=y('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),ht=y('<div class="text-center">No data with this selection.</div>'),bt=y('<h2>Emissions</h2> <div class="z-1 position-relative"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!></div></div></div> <div class="mt-4"><!></div>',1);function Ct(je,ze){Ze(ze,!0);let I,J,j=i(t([])),ge=i(t([])),z=i(t([])),K=i(t([])),oe=t(["Annual","Cumulative"]),o=i(null),M=i(t([]));const Ae=["not_normalized","normalized"];let Q=i("not_normalized"),re=i(t([])),U=i(t([])),ne=i(t({})),h=i(t([])),P=i(null),R=i(null),O=i(!0),A=i(t([])),Y=i(t([])),F=i("technology"),V=i(t([])),C=i(!1),w=i(!1),fe=i("plot"),Ce=ue(()=>({type:"bar",data:{datasets:e(h)},options:{responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Emissions [${e(A).length>0?e(ne)[e(A)[0]]:""}]`}}}}}));function pe(){a(P,null),a(R,null),a(h,t([])),a(A,t([])),a(Y,t([])),e(O)&&(a(R,"technology_carrier"),Be())}function se(){var r,n,d;return e(O)?T("carbon_emissions_carrier",(r=e(o))==null?void 0:r.version):e(P)==oe[0]?T("carbon_emissions_annual",(n=e(o))==null?void 0:n.version):T("carbon_emissions_cumulative",(d=e(o))==null?void 0:d.version)}async function Be(){var s,c,E;if(!e(o))return;a(w,!0);let r=await H(e(o).solution_name,T("carbon_emissions_technology",(s=e(o))==null?void 0:s.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years),n=await H(e(o).solution_name,T("carbon_emissions_carrier",(c=e(o))==null?void 0:c.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years),d=new Set,g=new Set,m=new Set;for(let _ of r.data.data)g.add(_.technology),m.add(_.location);for(let _ of n.data.data){if(d.add(_.carrier),m.add(_.node),Object.hasOwn(_,"node")){let b=Object.getOwnPropertyDescriptor(_,"node");if(b===void 0)continue;Object.defineProperty(_,"location",b)}delete _.node}I=it("technology_carrier",[["carrier",n.data],["technology",r.data]]),a(V,t([...g])),a(j,t([...d])),a(K,t([...m])),(E=n.unit)!=null&&E.data&&a(ne,t(Object.fromEntries(n.unit.data.map(_=>[_.carrier,_[0]||_.units])))),a(w,!1),Pe()}async function Le(){var d,g,m,s;a(w,!0),await tt();let r=se();if(r===null)return;if(r==T("carbon_emissions_annual",(d=e(o))==null?void 0:d.version))J=(await H(e(o).solution_name,T("carbon_emissions_annual_limit",(g=e(o))==null?void 0:g.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years)).data;else{let c=await H(e(o).solution_name,T("carbon_emissions_budget",(m=e(o))==null?void 0:m.version),e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years);if(c.data)for(const E of e(z))c.data.data[0][E]=c.data.data[0][e(z)[0]];J=c.data}const n=await H(e(o).solution_name,r,e(o).scenario_name,e(o).detail.system.reference_year,e(o).detail.system.interval_between_years);I=n.data,(s=n.unit)!=null&&s.data&&a(ne,t(Object.fromEntries(n.unit.data.map(c=>[c.carrier,c[0]||c.units])))),a(w,!1)}function Pe(){a(re,t(["location"])),e(R)&&a(re,t(["location",e(R)])),a(A,t(e(j))),a(Y,t(e(V))),a(U,t(e(K))),a(F,"location"),a(w,!1),B()}function B(){var m;if(!I)return;let r={},n={};e(O)&&(e(F)!="location"?(r.location=e(K),n.technology_carrier=e(Y).concat(e(A))):(r.technology_carrier=e(V).concat(e(j)),n.location=e(U)));let d=e(z).filter(s=>!e(M).includes(s));if(a(h,t(Te(I.data,r,n,d,e(Q)=="normalized"))),e(h).length==0)return;if(e(h).length==1&&!e(O)&&(e(h)[0].label=se()),J){let s=Te(J.data,r,n,d,e(Q)=="normalized");s.length>0&&(s[0].label=e(P)==oe[0]?"Annual Emissions Limit":"Carbon Emissions Budget",s[0].type="line",a(h,t(e(h).concat(s))))}let g=e(o).solution_name.split(".");a(fe,t([g[(g==null?void 0:g.length)-1],(m=e(o))==null?void 0:m.scenario_name,se()].join("_")))}var he=bt(),ie=l(x(he),2),be=v(ie),ye=v(be),le=v(ye),we=l(v(le),2),xe=v(we),De=v(xe);const Ne=ue(()=>!e(C)&&!e(w));st(De,{solution_selected:()=>{pe(),a(M,t(e(z)))},get enabled(){return e(Ne)},get carriers(){return e(j)},set carriers(r){a(j,t(r))},get nodes(){return e(ge)},set nodes(r){a(ge,t(r))},get years(){return e(z)},set years(r){a(z,t(r))},get selected_solution(){return e(o)},set selected_solution(r){a(o,t(r))},get loading(){return e(C)},set loading(r){a(C,t(r))}}),u(xe),u(we),u(le);var Re=l(le,2);{var Ye=r=>{var n=ft(),d=x(n),g=l(v(d),2),m=v(g),s=l(v(m),2);ot(s),s.__change=pe;var c=l(s,2),E=v(c,!0);u(c);var _=l(c,3);{var b=S=>{var D=ct(),W=l(x(D),2);const X=ue(()=>!e(w)&&!e(C));me(W,{get options(){return oe},selection_changed:Le,get enabled(){return e(X)},get selected_option(){return e(P)},set selected_option(Z){a(P,t(Z))}}),f(S,D)};k(_,S=>{e(O)||S(b)})}u(m),u(g),u(d);var ce=l(d,2);{var Ge=S=>{var D=gt(),W=l(v(D),2),X=v(W),Z=v(X);{var He=N=>{var Oe=mt(),de=x(Oe),_e=v(de),Je=l(v(_e),2);me(Je,{get options(){return e(re)},selection_changed:p=>B(),get selected_option(){return e(F)},set selected_option(p){a(F,t(p))}}),u(_e);var Se=l(_e,2),Ke=l(v(Se),2);me(Ke,{options:Ae,selection_changed:p=>B(),get selected_option(){return e(Q)},set selected_option(p){a(Q,t(p))}}),u(Se),u(de);var Me=l(de,2);{var Qe=p=>{var q=vt(),$=x(q);{var ee=L=>{var G=dt(),ve=l(x(G),2);ae(ve,{get elements(){return e(V)},selection_changed:()=>{B()},get selected_elements(){return e(Y)},set selected_elements(te){a(Y,t(te))}}),f(L,G)};k($,L=>{e(V).length>0&&L(ee)})}var We=l($,2);{var Xe=L=>{var G=_t(),ve=l(x(G),2);ae(ve,{get elements(){return e(j)},selection_changed:te=>{B()},get selected_elements(){return e(A)},set selected_elements(te){a(A,t(te))}}),f(L,G)};k(We,L=>{e(j).length>0&&L(Xe)})}f(p,q)},Ue=p=>{var q=ut(),$=l(x(q),2);ae($,{get elements(){return e(K)},selection_changed:ee=>{B()},get selected_elements(){return e(U)},set selected_elements(ee){a(U,t(ee))}}),f(p,q)};k(Me,p=>{e(F)!="location"?p(Qe):p(Ue,!1)})}f(N,Oe)};k(Z,N=>{e(O)&&N(He)})}var Ie=l(Z,4);ae(Ie,{get elements(){return e(z)},selection_changed:N=>{B()},get selected_elements(){return e(M)},set selected_elements(N){a(M,t(N))}}),u(X),u(W),u(D),f(S,D)};k(ce,S=>{!e(w)&&(e(P)||e(R))&&S(Ge)})}et(()=>{s.disabled=e(w)||e(C),at(E,e(O)?"on":"off")}),nt(s,()=>e(O),S=>a(O,S)),f(r,n)};k(Re,r=>{!e(C)&&e(o)&&r(Ye)})}u(ye),u(be),u(ie);var ke=l(ie,2),Fe=v(ke);{var Ve=r=>{var n=pt();f(r,n)},qe=r=>{var n=Ee(),d=x(n);{var g=m=>{var s=Ee(),c=x(s);{var E=b=>{var ce=ht();f(b,ce)},_=b=>{lt(b,{get config(){return e(Ce)},get plot_name(){return e(fe)}})};k(c,b=>{e(h).length==0||e(h)[0].data.length==0?b(E):b(_,!1)})}f(m,s)};k(d,m=>{e(h)!=null&&e(o)!=null&&m(g)},!0)}f(r,n)};k(Fe,r=>{e(C)||e(w)?r(Ve):r(qe,!1)})}u(ke),f(je,he),$e()}rt(["change"]);export{Ct as component};
