import"../chunks/Bg9kRutz.js";import{p as da,a as s,s as m,f as k,b as ca,c as g,d as l,g as e,e as Y,r as f,h as Be}from"../chunks/AM9C8FsA.js";import{s as Ee}from"../chunks/B6F1ZNoe.js";import{p as t,i as C,b as Pe}from"../chunks/D-bC_bvq.js";import{e as _a,i as ua}from"../chunks/Bbpm7MqF.js";import{t as h,a as p,c as q}from"../chunks/CmMFD2-g.js";import{d as va}from"../chunks/DY_kk6CS.js";import{S as pa,b as Q,f as U,c as ga,B as Ze}from"../chunks/WCHrdp7r.js";import{A as fa}from"../chunks/C0g7NPoM.js";import{D as Me}from"../chunks/DMh-KTMq.js";import{g as X}from"../chunks/CqS7hfz2.js";import{T as ma}from"../chunks/_IZlJ5Y-.js";var ha=h("<option> </option>"),ba=h('<h3>Carrier</h3> <select class="form-select"><!> </select> <h3>Year</h3> <!> <h3>Smoothing Window Size</h3> <!>',1),ya=h('<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Data Selection</button></h2> <div id="collapseThree" class="accordion-collapse collapse show"><div class="accordion-body"><h3>Technology Subdivision</h3> <!> <h3>Node</h3> <!></div></div></div>'),wa=h('<div class="accordion-item variable-selction"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Variable Selection</button></h2> <div id="collapseTwo" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!>',1),xa=h('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Sa=h('<div class="text-center">No technologies with this selection.</div>'),za=h('<div class="text-center">No carriers with this selection.</div>'),ka=h('<div class="text-center">No solution selected.</div>'),Ca=h('<div class="text-center">No data with this selection.</div>'),Da=h('<div class="text-center">No locations with this selection.</div>'),Oa=h('<div class="text-center">No data with this selection.</div>'),Ta=h("<!> <!>",1),ja=h('<h2>The Energy Balance Storage</h2> <div class="position-relative z-1"><div class="filters"><div class="accordion" id="accordionExample"><div class="accordion-item solution-selection"><h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Solution Selection</button></h2> <div id="collapseOne" class="accordion-collapse collapse show"><div class="accordion-body"><!></div></div></div> <!></div></div></div> <div class="mt-4"><!></div>',1);function La(He,Ke){da(Ke,!0);let x=s(null),de=s(null),ce=s(null),G=s(null),I=s(null),D=s(null),$=s(null),ee=s(null),we=s(null),xe=s(null),A=s(t([])),W=s(t([])),N=s(t([])),Se=s(t({})),c=s(null);const Le="storage_level";let B=s(null),ae=[],E=s(t([])),O=s(!1),S=s(!1),_e=s(""),Ve="",ue=s(!0),te=s(t([])),le=s(0);const Ye=["Hourly","Daily","Weekly","Monthly"];let ve=s("Hourly"),oe,re,J=s(t([])),pe=s(t([])),P=s(t([])),ze=Y(()=>e(N).length>0?e(Se)[e(N)[0]]:""),qe=Y(()=>({type:"line",data:{datasets:e(J),labels:e(P)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Level [${e(ze)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a=>{re.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a=>{re.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}})),Ge=Y(()=>({counter:1,type:"line",data:{datasets:e(pe),labels:e(P)},options:{animation:!1,normalized:!0,elements:{point:{radius:0}},responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Time"}},y:{type:"linear",stacked:!0,beginAtZero:!0,title:{display:!0,text:`Storage Flow [${e(ze)}]`}}},borderWidth:1,plugins:{zoom:{pan:{enabled:!0,modifierKey:"ctrl",mode:"x",onPanComplete:a=>{oe.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},zoom:{drag:{enabled:!0},wheel:{enabled:!0},mode:"x",onZoomComplete:a=>{oe.zoom_rect(a.chart.scales.x.min,a.chart.scales.x.max)}},limits:{x:{minRange:10}}}}}}));function ke(){l(E,t(e(W))),ae=e(N)}async function Ce(){var T;if(l(x,null),e(c)===null)return;let a=Math.floor((e(le)-e(c).detail.system.reference_year)/e(c).detail.system.interval_between_years),r=1;switch(e(ve)){case"Daily":r=24;break;case"Weekly":r=168;break;case"Monthly":r=720;break}const[u,b,i,v,_]=await Promise.all([Q(e(c).solution_name,X("storage_level"),e(c).scenario_name,a,r),Q(e(c).solution_name,X("flow_storage_charge"),e(c).scenario_name,a,r),Q(e(c).solution_name,X("flow_storage_discharge"),e(c).scenario_name,a,r),Q(e(c).solution_name,X("flow_storage_spillage"),e(c).scenario_name,a,r),Q(e(c).solution_name,X("flow_storage_inflow"),e(c).scenario_name,a,r)]);l(x,t(u.data)),(T=u.unit)!=null&&T.data&&l(Se,t(Object.fromEntries(u.unit.data.map(z=>[z.technology,z[0]||z.units])))),l(de,t(b.data)),l(ce,t(i.data)),l(G,t(v.data)),l(I,t(_.data))}async function Ie(){e(c)!==null&&(l(S,!0),l(le,t(e(te)[0])),await Ce(),Je(),Oe(),De(),ke(),ie(),l(S,!1))}async function ge(){l(S,!0),await Ce(),Oe(),De(),ke(),ie(),l(S,!1)}function De(){l(W,t(Array.from(new Set(e(x).data.map(a=>a.node))))),l(E,t(e(W)))}function Je(){if(l(A,t([])),!e(x))return;let a=Array.from(e(x).data.map(r=>r.technology));e(x).data.forEach(r=>{let u=r.technology,b=e(c).detail.reference_carrier[u];!e(A).includes(b)&&a.includes(r.technology)&&e(A).push(b)}),e(A).length>0&&l(B,t(e(A)[0]))}function Oe(){let a=Array.from(new Set(e(x).data.map(r=>r.technology)));l(N,t(a.filter(r=>{var u;return((u=e(c))==null?void 0:u.detail.reference_carrier[r])==e(B)}))),ae=e(N)}function ie(){var b;if(e(E).length==0||ae.length==0||e(x)===null||e(de)===null||e(ce)===null||e(I)===null||e(G)===null){l(J,t([])),l(P,t([])),l(_e,"");return}let a={},r={};if(a.technology=ae,r.node=e(E),l(D,t(U(e(x).data,a,r,[],!1,"line","").map(i=>({...i,fill:"origin"})))),l($,t(U(e(de).data,a,r,[],!1,"line","_charge").map(i=>({...i,stepped:!0,fill:"origin"})))),l(ee,t(U(e(ce).data,a,r,[],!1,"line","_discharge").map(i=>{let v={};for(let _ in i.data)v[_]=i.data[_]>0?-i.data[_]:i.data[_];return{data:v,label:i.label,type:i.type,stepped:!0,fill:"origin"}}))),l(xe,t(U(e(G).data,a,r,[],!1,"line","_spillage").map(i=>{let v={};for(let _ in i.data)v[_]=i.data[_]>0?-i.data[_]:i.data[_];return{data:v,label:i.label,type:i.type,stepped:!0,fill:"origin"}}))),l(we,t(U(e(I).data,a,r,[],!1,"line","_inflow").map(i=>({...i,stepped:!0,fill:"origin"})))),l(J,t(e(D))),l(pe,t(e($).concat(e(ee)).concat(e(we)).concat(e(xe)))),l(P,t(Object.keys(e(D)[0].data))),e(ue))l(J,t(e(D))),l(P,t(Object.keys(e(D)[0].data)));else{let i={};for(const n in e(D)[0].data)i[n]=e(D).map(o=>o.data[n]).reduce((o,d)=>o+d,0);let v={};for(const n in e($)[0].data)v[n]=e($).map(o=>o.data[n]).reduce((o,d)=>o+d,0);let _={};for(const n in e(ee)[0].data)_[n]=e(ee).map(o=>o.data[n]).reduce((o,d)=>o+d,0);let T={};for(const n in e(I).data[0])T[n]=e(I).data.map(o=>o.data[n]).reduce((o,d)=>o+d,0);let z={};for(const n in e(G).data[0])z[n]=e(G).data.map(o=>o.data[n]).reduce((o,d)=>o+d,0);l(J,t([{data:Object.values(i),label:"Storage level",type:"line",borderColor:"black",fill:"origin",stepped:!0}])),l(pe,t([{data:Object.values(v),label:"Flow Storage Charge",type:"line",borderColor:"blue",stepped:!0},{data:Object.values(_),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(T),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0},{data:Object.values(z),label:"Flow Storage Discharge",type:"line",borderColor:"red",stepped:!0}])),l(P,t(Object.keys(i)))}let u=e(c).solution_name.split(".");l(_e,t([u[(u==null?void 0:u.length)-1],(b=e(c))==null?void 0:b.scenario_name,Le,e(B)].join("_")))}var Te=ja(),fe=m(k(Te),2),je=g(fe),Ae=g(je),me=g(Ae),Ne=m(g(me),2),Re=g(Ne),Qe=g(Re);const Ue=Y(()=>!e(S)&&!e(O));pa(Qe,{solution_selected:Ie,get enabled(){return e(Ue)},get selected_solution(){return e(c)},set selected_solution(a){l(c,t(a))},get loading(){return e(O)},set loading(a){l(O,t(a))},get years(){return e(te)},set years(a){l(te,t(a))}}),f(Re),f(Ne),f(me);var Xe=m(me,2);{var $e=a=>{var r=wa(),u=k(r),b=m(g(u),2),i=g(b),v=g(i);{var _=n=>{var o=ba(),d=m(k(o),2);d.__change=ge;var R=g(d);_a(R,17,()=>e(A),ua,(j,K)=>{var w=ha(),F={},be=g(w,!0);f(w),Be(()=>{F!==(F=e(K))&&(w.value=(w.__value=e(K))==null?"":e(K)),Ee(be,e(K))}),p(j,w)});var Z=m(R);f(d);var M=m(d,4);const y=Y(()=>!e(S)&&!e(O));Me(M,{get options(){return e(te)},selection_changed:ge,get enabled(){return e(y)},get selected_option(){return e(le)},set selected_option(j){l(le,t(j))}});var H=m(M,4);const he=Y(()=>!e(S)&&!e(O));Me(H,{options:Ye,selection_changed:ge,get enabled(){return e(he)},get selected_option(){return e(ve)},set selected_option(j){l(ve,t(j))}}),Be(()=>{d.disabled=e(S)||e(O),Ee(Z,` disabled=${(e(S)||e(O))??""}`)}),ga(d,()=>e(B),j=>l(B,j)),p(n,o)};C(v,n=>{e(A).length>0&&n(_)})}f(i),f(b),f(u);var T=m(u,2);{var z=n=>{var o=ya(),d=m(g(o),2),R=g(d),Z=m(g(R),2);ma(Z,{change:ie,get value(){return e(ue)},set value(y){l(ue,t(y))}});var M=m(Z,4);fa(M,{get elements(){return e(W)},selection_changed:ie,get selected_elements(){return e(E)},set selected_elements(y){l(E,t(y))}}),f(R),f(d),f(o),p(n,o)};C(T,n=>{e(x)&&e(B)&&e(N).length>0&&e(W).length>0&&n(z)})}p(a,r)};C(Xe,a=>{!e(O)&&e(c)&&a($e)})}f(Ae),f(je),f(fe);var Fe=m(fe,2),ea=g(Fe);{var aa=a=>{var r=xa();p(a,r)},ta=a=>{var r=q(),u=k(r);{var b=v=>{var _=Sa();p(v,_)},i=v=>{var _=q(),T=k(_);{var z=o=>{var d=za();p(o,d)},n=o=>{var d=q(),R=k(d);{var Z=y=>{var H=ka();p(y,H)},M=y=>{var H=q(),he=k(H);{var j=w=>{var F=Ca();p(w,F)},K=w=>{var F=q(),be=k(F);{var la=L=>{var se=Da();p(L,se)},oa=L=>{var se=q(),ra=k(se);{var ia=V=>{var ne=Oa();p(V,ne)},sa=V=>{var ne=Ta(),We=k(ne);Pe(Ze(We,{get config(){return e(qe)},get plot_name(){return e(_e)},zoom:!0}),ye=>oe=ye,()=>oe);var na=m(We,2);Pe(Ze(na,{get config(){return e(Ge)},get plot_name(){return Ve},zoom:!0}),ye=>re=ye,()=>re),p(V,ne)};C(ra,V=>{e(D).length==0?V(ia):V(sa,!1)},!0)}p(L,se)};C(be,L=>{e(W).length==0?L(la):L(oa,!1)},!0)}p(w,F)};C(he,w=>{e(D)==null?w(j):w(K,!1)},!0)}p(y,H)};C(R,y=>{e(c)==null?y(Z):y(M,!1)},!0)}p(o,d)};C(T,o=>{e(A).length==0?o(z):o(n,!1)},!0)}p(v,_)};C(u,v=>{e(N).length==0?v(b):v(i,!1)},!0)}p(a,r)};C(ea,a=>{e(O)||e(S)?a(aa):a(ta,!1)})}f(Fe),p(He,Te),ca()}va(["change"]);export{La as component};
