# This file was generated by hydroflows version {{ version }}

cwlVersion: v1.2
class: CommandLineTool

requirements:
    InlineJavascriptRequirement: {}
    InitialWorkDirRequirement:
        listing:
        {% for key, value in rule.input.items()%}
        {% if "File" is in value.type or "Directory" is in value.type %}
        - $(inputs.{{key}})
        {% endif %}
        {% endfor %}

baseCommand: ["hydroflows", "method", "{{rule.method_name}}"]

inputs:
    {% for key,value in rule.input.items() %}
    {{key}}:
        type: {{value.type}}
        {%if "folderpath" not in value%}
        inputBinding:
            prefix: {{key}}=
            separate: false
            {% if value.separator %}
            itemSeparator: {{value.separator}}
            {% endif %}
            {% if value.valueFrom %}
            valueFrom: {{value.valueFrom}}
            {% endif %}
        {%endif%}
    {% endfor %}
    {% if rule.input_wildcards %}
    {% for wc in rule.input_wildcards%}
    {{wc}}:
        type: string
    {% endfor %}
    {% endif %}
    dryrun:
        type: boolean
        inputBinding:
            prefix: --dryrun
            position: 1
        default: false
    touch_output:
        type: boolean
        inputBinding:
            prefix: --touch-output
            position: 2
        default: false

outputs:
    {% for key,info in rule.output.items()%}
    {{key}}:
        type: {{info.type}}
        outputBinding:
            glob:
            {% for item in info.value%}
            - "{{item}}"
            {% endfor %}
            outputEval: |
                ${
                    {% for item in info.eval%}
                    self[{{loop.index0}}].basename = "{{item.replace("$(","\"+").replace(")", "+\"")}}";
                    {% endfor %}
                    return self
                }
    {% endfor %}
