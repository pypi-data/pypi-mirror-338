(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4383],{19326:(e,t,r)=>{"use strict";r.d(t,{Ui:()=>i,vw:()=>s});var n=r(97283),o=r(7282);const s=(0,n.y)(((e,t)=>({cells:new Map,source:"",outputsCount:0,adapter:void 0,areAllKernelSessionsReady:!1,isAnyCellExecuting:!1,setCells:t=>e((e=>({cells:t}))),setSource:(r,n)=>{const o=t().cells,s=o.get(r);s?s.source=n:o.set(r,{source:n}),e((e=>({cells:o})))},setOutputsCount:(r,n)=>{const o=t().cells,s=o.get(r);s?s.outputsCount=n:o.set(r,{outputsCount:n}),e((e=>({cells:o})))},setKernelSessionAvailable:(r,n)=>{const o=t().cells,s=o.get(r);s?s.isKernelSessionAvailable=n:o.set(r,{isKernelSessionAvailable:n});const i=(e=>{for(const t of e.values())if(!t.isKernelSessionAvailable)return!1;return!0})(o);e((e=>({cells:o,areAllKernelSessionsReady:i})))},setAdapter:(r,n)=>{const o=t().cells,s=o.get(r);s?s.adapter=n:o.set(r,{adapter:n}),e((e=>({cells:o})))},getAdapter:e=>t().cells.get(e)?.adapter,getSource:e=>t().cells.get(e)?.source,getOutputsCount:e=>t().cells.get(e)?.outputsCount,isKernelSessionAvailable:e=>t().cells.get(e)?.isKernelSessionAvailable,execute:e=>{const r=t().cells.get(e);r?r.adapter?.execute():t().cells.forEach((e=>e.adapter?.execute()))},setIsExecuting:(r,n)=>{const o=t().cells,s=o.get(r);s?s.isExecuting=n:(t().cells.forEach((e=>e.adapter?.execute())),o.set(r,{isExecuting:n}));const i=(e=>{for(const t of e.values())if(t.isExecuting)return!0;return!1})(o);e((e=>({cells:o,isAnyCellExecuting:i})))}})));function i(e){return(0,o.Pj)(s,e)}},55388:(e,t,r)=>{"use strict";r.d(t,{A4:()=>s,LC:()=>i});var n=r(97283),o=r(7282);const s=(0,n.y)(((e,t)=>({outputs:new Map,getAdapter:e=>t().outputs.get(e)?.adapter,getInput:e=>t().outputs.get(e)?.input,getModel:e=>t().outputs.get(e)?.model,getDataset:e=>t().outputs.get(e)?.dataset,getExecuteRequest:e=>t().outputs.get(e)?.code,getGradeSuccess:e=>t().outputs.get(e)?.gradeSuccess,setOutputs:(t,r)=>e((e=>({outputs:r}))),setAdapter:(r,n)=>{const o=t().outputs,s=o.get(r);s?s.adapter=n:o.set(r,{adapter:n}),e((e=>({outputs:o})))},setDataset:(r,n)=>{const o=t().outputs,s=o.get(r);s?s.dataset=n:o.set(r,{dataset:n}),e((e=>({outputs:o})))},setExecuteRequest:(r,n)=>{const o=t().outputs,s=o.get(r);s?s.code=n:o.set(r,{code:n}),e((e=>({outputs:o})))},setModel:(r,n)=>{const o=t().outputs,s=o.get(r);s?s.model=n:o.set(r,{model:n}),e((e=>({outputs:o})))},setInput:(r,n)=>{const o=t().outputs,s=o.get(r);s?s.input=n:o.set(r,{input:n}),e((e=>({outputs:o})))},setGradeSuccess:(r,n)=>{const o=t().outputs,s=o.get(r);s?s.gradeSuccess=n:o.set(r,{gradeSuccess:n}),e((e=>({outputs:o})))}})));function i(e){return(0,o.Pj)(s,e)}},5907:(e,t,r)=>{"use strict";r.d(t,{PD:()=>c,V9:()=>u,kA:()=>l}),r(18683);var n=r(9387),o=r(97789),s=r(5941),i=r(78343);const a=(0,n.createContext)(void 0),c=(a.Consumer,a.Provider,e=>{const t=(0,n.useContext)(a);if(t)return t;const{jupyterConfig:r,kernel:o,kernelIsLoading:i,serviceManager:c}=(0,s.zV)(e??{});return{defaultKernel:o,jupyterServerUrl:r.jupyterServerUrl,kernel:o,kernelIsLoading:i,kernelManager:c?.kernels,lite:e?.lite,serverless:e?.serverless??!1,serverSettings:c?.serverSettings,serviceManager:c}}),l=async e=>{try{return await(0,i.q)(e,"api",""),!0}catch(e){return console.log("The Jupyter Server API has failed with reason",e),!1}},u=(e,t)=>o.ServerConnection.makeSettings({baseUrl:e,wsUrl:e.replace(/^http/,"ws"),token:t,appendToken:!0,init:{mode:"cors",credentials:"include",cache:"no-store"}})},78343:(e,t,r)=>{"use strict";r.d(t,{q:()=>a});var n=r(63711),o=r(97789);class s extends Error{}const i=s;async function a(e,t="api",r="",s={}){const a=n.URLExt.join(e.baseUrl,t,r);let c;try{if(c=await o.ServerConnection.makeRequest(a,s,e),403===c.status)throw new i}catch(e){throw new o.ServerConnection.NetworkError(e)}let l=await c.text();if(l.length>0)try{l=JSON.parse(l)}catch(e){console.warn("Not a JSON response body.",c)}if(!c.ok)throw new o.ServerConnection.ResponseError(c,l.message||l);return l}},5941:(e,t,r)=>{"use strict";r.d(t,{uJ:()=>A,zV:()=>j});var n=r(9387),o=r(97283),s=r(7282),i=r(97789);const a="python";var c=r(98820),l=r(72490),u=r(18565),h=r(58264);class p{constructor(e){this._isDisposed=!1,this._serverSettings=e.serverSettings,this._stream=new l.Stream(this)}async emit({data:e,schema_id:t}){this._stream.emit({...e,schema_id:t})}dispose(){this.isDisposed||(this._isDisposed=!0,l.Signal.clearData(this),this._stream.stop())}get isDisposed(){return this._isDisposed}get stream(){return this._stream}get serverSettings(){return this._serverSettings}}class d extends c.l{constructor(e){var t;super(e),this.name="JupyterLite Server",this.namespace=this.name,this.version="unknown",this._router=new h.I;const r={...i.ServerConnection.makeSettings(),WebSocket:u.WebSocket,fetch:null!==(t=this.fetch.bind(this))&&void 0!==t?t:void 0};this._serviceManager=new i.ServiceManager({standby:"never",serverSettings:r,events:new p({serverSettings:r})})}get router(){return this._router}get serviceManager(){return this._serviceManager}async fetch(e,t){if(!(e instanceof Request))throw Error("Request info is not a Request");return this._router.route(e)}attachShell(e){}evtResize(e){}registerPluginModule(e){let t=e.default;Object.prototype.hasOwnProperty.call(e,"__esModule")||(t=e),Array.isArray(t)||(t=[t]),t.forEach((e=>{try{this.registerPlugin(e)}catch(e){console.error(e)}}))}registerPluginModules(e){e.forEach((e=>{this.registerPluginModule(e)}))}}var f=r(63711);const g=(e=!0)=>async function(){const e=[],t=await Promise.all([r.e(2252),r.e(4883),r.e(1570)]).then(r.bind(r,61570));for(const r of function*(e){let t;t=e.hasOwnProperty("__esModule")?e.default:e;const r=Array.isArray(t)?t:[t];for(const e of r)f.PageConfig.Extension.isDisabled(e.id)?console.info(`JupyterLite plugin '${e.id}' has been disabled.`):yield e}(t))e.push(r);const n=new d({});return n.registerPluginModules(e),await n.start(),n}().then((async t=>{const n="boolean"==typeof e?await Promise.all([r.e(2252),r.e(7952)]).then(r.bind(r,10382)):await e;let o=n.default;Object.prototype.hasOwnProperty.call(n,"__esModule")||(o=n),Array.isArray(o)||(o=[o]);const s=o.map((e=>{try{return t.registerPlugin(e),e.id}catch(e){return console.error(e),null}}));await Promise.all(s.filter((e=>e)).map((e=>t.activatePlugin(e))));const i=t.serviceManager;return i.__NAME__="LiteServiceManager",console.log("Lite Service Manager is created",i),i}));var v=r(5907);let y,m=!1;const S=e=>{if(!y)throw new Error("Jupyter React Config must be loaded first.");f.PageConfig.setOption("baseUrl",e),f.PageConfig.setOption("wsUrl",e.replace(/^http/,"ws")),y.jupyterServerUrl=e},w=()=>{if(!y)throw new Error("Jupyter React Config must be loaded first.");return y.jupyterServerUrl},E=e=>{if(!y)throw new Error("Jupyter React Config must be loaded first.");f.PageConfig.setOption("token",e),y.jupyterServerToken=e},b=(e={})=>{const{collaborative:t,jupyterServerToken:r,jupyterServerUrl:n,lite:o,terminals:s}=e;if(y)return console.log("Returning existing Jupyter React config",y),y;if(y={jupyterServerUrl:n??"https://oss.datalayer.run/api/jupyter-server",jupyterServerToken:r??"60c1661cc408f978c309d04157af55c9588ff9557c9380e4fb50785750703da6",insideJupyterLab:!1,insideJupyterHub:!1},function(){if(!m){const e=document.getElementById("datalayer-config-data");if(e?.textContent){console.log("Found Datalayer config data in page",e);try{y={...y,...JSON.parse(e.textContent)},m=!0}catch(e){console.error("Failed to parse the Datalayer configuration.",e)}}else console.log("No Datalayer config data found in page")}}(),m)S(n||y.jupyterServerUrl),E(r||y.jupyterServerToken);else{const e=document.getElementById("jupyter-config-data");if(e){const t=JSON.parse(e.textContent||"");S(n??t.jupyterServerUrl??location.protocol+"//"+location.host+t.baseUrl),E(r??t.token??""),y.insideJupyterLab="JupyterLab"===t.appName,y.insideJupyterHub=""!==f.PageConfig.getOption("hubHost")}else S(n??y.jupyterServerUrl??location.protocol+"//"+location.host+"/api/jupyter-server"),E(r??y.jupyterServerToken??"")}return o&&S(location.protocol+"//"+location.host),y.insideJupyterLab||(f.PageConfig.setOption("baseUrl",w()),f.PageConfig.setOption("wsUrl",w().replace(/^http/,"ws")),f.PageConfig.setOption("token",(()=>{if(!y)throw new Error("Jupyter React Config must be loaded first.");return y.jupyterServerToken})()),f.PageConfig.setOption("collaborative",String(t)),f.PageConfig.setOption("disableRTC",String(!t)),f.PageConfig.setOption("terminalsAvailable",String(s)),f.PageConfig.setOption("mathjaxUrl","https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"),f.PageConfig.setOption("mathjaxConfig","TeX-AMS_CHTML-full,Safe")),console.log("Created config for Jupyter React",y),y};var k=r(42389),_=r(38921),C=r(98238),M=r(34417),O=r(36848);class x{_clientId;_connectionStatus;_id;_info;_kernelConnection;_kernelManager;_kernelName;_kernelSpecManager;_kernelSpecName;_kernelType;_path;_ready;_session;_sessionId;_sessionManager;constructor(e){const{kernelManager:t,kernelName:r,kernelType:n,kernelspecsManager:o,kernelSpecName:s,kernelModel:i,path:a,sessionManager:c}=e;this._kernelSpecManager=o,this._kernelManager=t,this._kernelName=r,this._kernelType=n??"notebook",this._kernelSpecName=s,this._sessionManager=c,this._ready=new C.PromiseDelegate,this.requestKernel(i,a)}async requestKernel(e,t){if(await this._kernelManager.ready,await this._sessionManager.ready,e){await this._kernelManager.refreshRunning();const t=Array.from(this.kernelManager.running()),r=(0,_.I6)(t,(t=>e.id===t.id));if(!r)return void console.log("Something is wrong... can not find an existing model for",e);{console.log("Creating a session to an existing Jupyter Kernel model.",r);const t="kernel-"+e.id;this._path=t,this._session=await this._sessionManager.startNew({name:r.name,path:t,type:"notebook",kernel:r},{kernelConnectionOptions:{handleComms:!0}})}}else{let e=t??(0,M.Ri)(this.cookieName);e||(e="path-"+(0,M.YG)(),document.cookie=this.cookieName+"="+e),this._path=e,this._session=await this._sessionManager.startNew({name:this._kernelName,path:this._path,type:this._kernelType,kernel:{name:this._kernelSpecName}},{kernelConnectionOptions:{handleComms:!0}})}this._kernelConnection=this._session.kernel;const r=()=>{"connected"===this._connectionStatus&&(this._clientId=this._session.kernel.clientId,this._id=this._session.kernel.id,this._ready.resolve())};this._kernelConnection&&(this._sessionId=this._session.id,this._connectionStatus=this._kernelConnection.connectionStatus,r(),this._kernelConnection.connectionStatusChanged.connect(((e,t)=>{this._connectionStatus=t,r()})),this._kernelConnection.info.then((e=>{this._info=e,console.log("Kernel Information.",e),console.log("Kernel Session.",this._session),console.log("Kernel Details.",this.toJSON())})))}get clientId(){return this._clientId}get connection(){return this._kernelConnection}get cookieName(){return"jupyter-react-kernel-path_"+this._kernelSpecName}get id(){return this._id}get info(){return this._info}get kernelManager(){return this._kernelManager}get kernelSpecManager(){return this._kernelSpecManager}get path(){return this._path}get ready(){return this._ready.promise}get sessionId(){return this._sessionId}get session(){return this._session}get sessionManager(){return this._sessionManager}execute(e,{model:t,iopubMessageHooks:r=[],shellMessageHooks:n=[],silent:o,stopOnError:s,storeHistory:i,allowStdin:a,suppressCodeExecutionErrors:c=!1,onExecutionPhaseChanged:l}={}){if(this._kernelConnection){const u=new O.A({connection:this._kernelConnection,model:t,onExecutionPhaseChanged:l});return u.execute(e,{iopubMessageHooks:r,shellMessageHooks:n,silent:o,stopOnError:s,storeHistory:i,allowStdin:a,suppressCodeExecutionErrors:c}),u}}interrupt(){return this._kernelConnection?.interrupt()??Promise.resolve()}restart(){return this._kernelConnection?.restart()??Promise.resolve()}async shutdown(){await(this._session.kernel?.shutdown()),this.connection?.dispose()}toJSON(){return{path:this._path,id:this.id,clientId:this.clientId,sessionId:this.sessionId,kernelInfo:this.info}}toString(){return`id:${this.id} - client_id:${this.clientId} - session_id:${this.sessionId} - path:${this._path}`}}var R=r(19326);const P=(0,o.y)(((e,t)=>({outputs:0,adapter:void 0,execute:()=>{},setOutputs:t=>e((e=>({outputs:t}))),setAdapter:t=>e((e=>({adapter:t})))})));var N=r(16476),L=r(55388);const I=(0,o.y)(((e,t)=>({dark:!1,adapter:void 0,setDark:t=>e((e=>({dark:t}))),setAdapter:t=>e((e=>({adapter:t})))})));let T;try{const e=document.getElementById("datalayer-config-data");e?.innerText&&(T=JSON.parse(e?.innerText))}catch(e){console.debug("Issue with page configuration.",e)}const A=(0,o.y)(((e,t)=>({collaborative:!1,datalayerConfig:T,version:"",jupyterConfig:void 0,kernelIsLoading:!0,kernel:void 0,serviceManager:void 0,serverSettings:void 0,cellsStore:R.vw.getState(),consoleStore:P.getState(),notebookStore:N.Fg.getState(),outputStore:L.A4.getState(),terminalStore:I.getState(),setDatalayerConfig:t=>{e((e=>({datalayerConfig:t})))},setJupyterConfig:t=>{e((e=>({jupyterConfig:t})))},setServiceManager:t=>{e((e=>({serviceManager:t})))},setVersion:r=>{r&&!t().version&&e((e=>({version:r})))}})));function j(e){const{defaultKernelName:t=a,initCode:r="",jupyterServerToken:o=e.serviceManager?.serverSettings.token??"",jupyterServerUrl:c=e.serviceManager?.serverSettings.baseUrl??"",lite:l=!1,serverless:u,serviceManager:h,startDefaultKernel:p=!1,terminals:d=!1,useRunningKernelId:f=e.useRunningKernelId,useRunningKernelIndex:y=e.useRunningKernelIndex||-1}=e,m=(0,n.useMemo)((()=>{const e=b({lite:l,jupyterServerUrl:c,jupyterServerToken:o,terminals:d});return A.getState().setJupyterConfig(e),e}),[]),[S,E]=(0,n.useState)(h),[_,C]=(0,n.useState)(),[M,O]=(0,n.useState)(p||y>-1);return(0,n.useEffect)((()=>{h&&(console.log("Setting Service Manager from props",h),E(h),A.getState().setServiceManager(h))}),[h]),(0,n.useEffect)((()=>{if(u){const e=new k.Od;return E(e),void A.getState().setServiceManager(e)}if(!S){if(l)return void g(l).then((e=>{E(e),A.getState().setServiceManager(e)}));const e=(0,v.V9)(m.jupyterServerUrl,m.jupyterServerToken);(0,v.kA)(e).then((t=>{if(!t){const e=w()+"/login?next="+window.location;console.warn("You need to authenticate on the Jupyter Server URL",e)}if(f&&y>-1)throw new Error("You can not ask for useRunningKernelId and useRunningKernelIndex at the same time.");if(p&&(f||y>-1))throw new Error("You can not ask for startDefaultKernel and (useRunningKernelId or useRunningKernelIndex) at the same time.");const r=new i.ServiceManager({serverSettings:e});E(r),A.getState().setServiceManager(r)}))}}),[l,u,c]),(0,n.useEffect)((()=>{console.log("Checking kernels for the new Service Manager:",S),S?.kernels.ready.then((async()=>{const e=S.kernels;if(console.log("Jupyter Kernel Manager is ready",e),y>-1){await S.sessions.refreshRunning();const t=Array.from(e.running())[y],n=new x({kernelManager:e,kernelName:t.name,kernelSpecName:t.name,kernelModel:t,kernelspecsManager:S.kernelspecs,sessionManager:S.sessions});if(r)try{await(n.execute(r)?.done)}catch(e){console.error("Failed to execute the initial code",e)}C(n),A.getState().kernel=n,O(!1),A.getState().kernelIsLoading=!1}else if(p){console.log("Starting a Jupyter Kernel:",t);const n=new x({kernelManager:e,kernelName:t,kernelSpecName:t,kernelspecsManager:S.kernelspecs,sessionManager:S.sessions});n.ready.then((async()=>{if(r)try{await(n.execute(r)?.done)}catch(e){console.error("Failed to execute the initial code",e)}console.log("Jupyter Kernel is ready",n),C(n),A.getState().kernel=n,O(!1),A.getState().kernelIsLoading=!1}))}}))}),[S]),(0,s.Pj)(A)}},58264:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});class n{constructor(){this._routes=[]}get(e,t){this._add("GET",e,t)}put(e,t){this._add("PUT",e,t)}post(e,t){this._add("POST",e,t)}patch(e,t){this._add("PATCH",e,t)}delete(e,t){this._add("DELETE",e,t)}async route(e){const t=new URL(e.url),{method:r}=e,{pathname:n}=t;for(const o of this._routes){if(o.method!==r)continue;const s=n.match(o.pattern);if(!s)continue;const i=s.slice(1);let a;if("PATCH"===o.method||"PUT"===o.method||"POST"===o.method)try{a=JSON.parse(await e.text())}catch{a=void 0}return o.callback.call(null,{pathname:n,body:a,query:Object.fromEntries(t.searchParams)},...i)}throw new Error("Cannot route "+e.method+" "+e.url)}_add(e,t,r){"string"==typeof t&&(t=new RegExp(t)),this._routes.push({method:e,pattern:t,callback:r})}}},98820:(e,t,r)=>{"use strict";r.d(t,{l:()=>u});var n,o,s,i,a=r(16950),c=r(98238),l=r(14809);!function(e){function t(e,t,r=0,n=-1){let o,s=e.length;if(0===s)return-1;r=r<0?Math.max(0,r+s):Math.min(r,s-1),o=(n=n<0?Math.max(0,n+s):Math.min(n,s-1))<r?n+1+(s-r):n-r+1;for(let n=0;n<o;++n){let o=(r+n)%s;if(e[o]===t)return o}return-1}function r(e,t,r=-1,n=0){let o,s=e.length;if(0===s)return-1;o=(r=r<0?Math.max(0,r+s):Math.min(r,s-1))<(n=n<0?Math.max(0,n+s):Math.min(n,s-1))?r+1+(s-n):r-n+1;for(let n=0;n<o;++n){let o=(r-n+s)%s;if(e[o]===t)return o}return-1}function n(e,t,r=0,n=-1){let o,s=e.length;if(0===s)return-1;r=r<0?Math.max(0,r+s):Math.min(r,s-1),o=(n=n<0?Math.max(0,n+s):Math.min(n,s-1))<r?n+1+(s-r):n-r+1;for(let n=0;n<o;++n){let o=(r+n)%s;if(t(e[o],o))return o}return-1}function o(e,t,r=-1,n=0){let o,s=e.length;if(0===s)return-1;o=(r=r<0?Math.max(0,r+s):Math.min(r,s-1))<(n=n<0?Math.max(0,n+s):Math.min(n,s-1))?r+1+(s-n):r-n+1;for(let n=0;n<o;++n){let o=(r-n+s)%s;if(t(e[o],o))return o}return-1}function s(e,t=0,r=-1){let n=e.length;if(!(n<=1))for(t=t<0?Math.max(0,t+n):Math.min(t,n-1),r=r<0?Math.max(0,r+n):Math.min(r,n-1);t<r;){let n=e[t],o=e[r];e[t++]=o,e[r--]=n}}function i(e,t){let r=e.length;if(t<0&&(t+=r),t<0||t>=r)return;let n=e[t];for(let n=t+1;n<r;++n)e[n-1]=e[n];return e.length=r-1,n}e.firstIndexOf=t,e.lastIndexOf=r,e.findFirstIndex=n,e.findLastIndex=o,e.findFirstValue=function(e,t,r=0,o=-1){let s=n(e,t,r,o);return-1!==s?e[s]:void 0},e.findLastValue=function(e,t,r=-1,n=0){let s=o(e,t,r,n);return-1!==s?e[s]:void 0},e.lowerBound=function(e,t,r,n=0,o=-1){let s=e.length;if(0===s)return 0;let i=n=n<0?Math.max(0,n+s):Math.min(n,s-1),a=(o=o<0?Math.max(0,o+s):Math.min(o,s-1))-n+1;for(;a>0;){let n=a>>1,o=i+n;r(e[o],t)<0?(i=o+1,a-=n+1):a=n}return i},e.upperBound=function(e,t,r,n=0,o=-1){let s=e.length;if(0===s)return 0;let i=n=n<0?Math.max(0,n+s):Math.min(n,s-1),a=(o=o<0?Math.max(0,o+s):Math.min(o,s-1))-n+1;for(;a>0;){let n=a>>1,o=i+n;r(e[o],t)>0?a=n:(i=o+1,a-=n+1)}return i},e.shallowEqual=function(e,t,r){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0,o=e.length;n<o;++n)if(r?!r(e[n],t[n]):e[n]!==t[n])return!1;return!0},e.slice=function(e,t={}){let{start:r,stop:n,step:o}=t;if(void 0===o&&(o=1),0===o)throw new Error("Slice `step` cannot be zero.");let s,i=e.length;void 0===r?r=o<0?i-1:0:r<0?r=Math.max(r+i,o<0?-1:0):r>=i&&(r=o<0?i-1:i),void 0===n?n=o<0?-1:i:n<0?n=Math.max(n+i,o<0?-1:0):n>=i&&(n=o<0?i-1:i),s=o<0&&n>=r||o>0&&r>=n?0:o<0?Math.floor((n-r+1)/o+1):Math.floor((n-r-1)/o+1);let a=[];for(let t=0;t<s;++t)a[t]=e[r+t*o];return a},e.move=function(e,t,r){let n=e.length;if(n<=1)return;if((t=t<0?Math.max(0,t+n):Math.min(t,n-1))===(r=r<0?Math.max(0,r+n):Math.min(r,n-1)))return;let o=e[t],s=t<r?1:-1;for(let n=t;n!==r;n+=s)e[n]=e[n+s];e[r]=o},e.reverse=s,e.rotate=function(e,t,r=0,n=-1){let o=e.length;if(o<=1)return;if((r=r<0?Math.max(0,r+o):Math.min(r,o-1))>=(n=n<0?Math.max(0,n+o):Math.min(n,o-1)))return;let i=n-r+1;if(t>0?t%=i:t<0&&(t=(t%i+i)%i),0===t)return;let a=r+t;s(e,r,a-1),s(e,a,n),s(e,r,n)},e.fill=function(e,t,r=0,n=-1){let o,s=e.length;if(0!==s){r=r<0?Math.max(0,r+s):Math.min(r,s-1),o=(n=n<0?Math.max(0,n+s):Math.min(n,s-1))<r?n+1+(s-r):n-r+1;for(let n=0;n<o;++n)e[(r+n)%s]=t}},e.insert=function(e,t,r){let n=e.length;t=t<0?Math.max(0,t+n):Math.min(t,n);for(let r=n;r>t;--r)e[r]=e[r-1];e[t]=r},e.removeAt=i,e.removeFirstOf=function(e,r,n=0,o=-1){let s=t(e,r,n,o);return-1!==s&&i(e,s),s},e.removeLastOf=function(e,t,n=-1,o=0){let s=r(e,t,n,o);return-1!==s&&i(e,s),s},e.removeAllOf=function(e,t,r=0,n=-1){let o=e.length;if(0===o)return 0;r=r<0?Math.max(0,r+o):Math.min(r,o-1),n=n<0?Math.max(0,n+o):Math.min(n,o-1);let s=0;for(let i=0;i<o;++i)r<=n&&i>=r&&i<=n&&e[i]===t||n<r&&(i<=n||i>=r)&&e[i]===t?s++:s>0&&(e[i-s]=e[i]);return s>0&&(e.length=o-s),s},e.removeFirstWhere=function(e,t,r=0,o=-1){let s,a=n(e,t,r,o);return-1!==a&&(s=i(e,a)),{index:a,value:s}},e.removeLastWhere=function(e,t,r=-1,n=0){let s,a=o(e,t,r,n);return-1!==a&&(s=i(e,a)),{index:a,value:s}},e.removeAllWhere=function(e,t,r=0,n=-1){let o=e.length;if(0===o)return 0;r=r<0?Math.max(0,r+o):Math.min(r,o-1),n=n<0?Math.max(0,n+o):Math.min(n,o-1);let s=0;for(let i=0;i<o;++i)r<=n&&i>=r&&i<=n&&t(e[i],i)||n<r&&(i<=n||i>=r)&&t(e[i],i)?s++:s>0&&(e[i-s]=e[i]);return s>0&&(e.length=o-s),s}}(n||(n={})),function(e){e.rangeLength=function(e,t,r){return 0===r?1/0:e>t&&r>0||e<t&&r<0?0:Math.ceil((t-e)/r)}}(o||(o={})),function(e){function t(e,t,r=0){let n=new Array(t.length);for(let o=0,s=r,i=t.length;o<i;++o,++s){if(s=e.indexOf(t[o],s),-1===s)return null;n[o]=s}return n}e.findIndices=t,e.matchSumOfSquares=function(e,r,n=0){let o=t(e,r,n);if(!o)return null;let s=0;for(let e=0,t=o.length;e<t;++e){let t=o[e]-n;s+=t*t}return{score:s,indices:o}},e.matchSumOfDeltas=function(e,r,n=0){let o=t(e,r,n);if(!o)return null;let s=0,i=n-1;for(let e=0,t=o.length;e<t;++e){let t=o[e];s+=t-i-1,i=t}return{score:s,indices:o}},e.highlight=function(e,t,r){let n=[],o=0,s=0,i=t.length;for(;o<i;){let a=t[o],c=t[o];for(;++o<i&&t[o]===c+1;)c++;s<a&&n.push(e.slice(s,a)),a<c+1&&n.push(r(e.slice(a,c+1))),s=c+1}return s<e.length&&n.push(e.slice(s)),n},e.cmp=function(e,t){return e<t?-1:e>t?1:0}}(s||(s={}));class u{constructor(e){this._delegate=new c.PromiseDelegate,this._plugins=new Map,this._services=new Map,this._started=!1,this.commands=new a.J,this.contextMenu=new l.tz({commands:this.commands,renderer:e.contextMenuRenderer}),this.shell=e.shell}get started(){return this._delegate.promise}getPluginDescription(e){var t,r;return null!==(r=null===(t=this._plugins.get(e))||void 0===t?void 0:t.description)&&void 0!==r?r:""}hasPlugin(e){return this._plugins.has(e)}isPluginActivated(e){var t,r;return null!==(r=null===(t=this._plugins.get(e))||void 0===t?void 0:t.activated)&&void 0!==r&&r}listPlugins(){return Array.from(this._plugins.keys())}registerPlugin(e){if(this._plugins.has(e.id))throw new TypeError(`Plugin '${e.id}' is already registered.`);const t=i.createPluginData(e);i.ensureNoCycle(t,this._plugins,this._services),t.provides&&this._services.set(t.provides,t.id),this._plugins.set(t.id,t)}registerPlugins(e){for(const t of e)this.registerPlugin(t)}deregisterPlugin(e,t){const r=this._plugins.get(e);if(r){if(r.activated&&!t)throw new Error(`Plugin '${e}' is still active.`);this._plugins.delete(e)}}async activatePlugin(e){const t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(t.activated)return;if(t.promise)return t.promise;const r=t.requires.map((e=>this.resolveRequiredService(e))),n=t.optional.map((e=>this.resolveOptionalService(e)));return t.promise=Promise.all([...r,...n]).then((e=>t.activate.apply(void 0,[this,...e]))).then((e=>{t.service=e,t.activated=!0,t.promise=null})).catch((e=>{throw t.promise=null,e})),t.promise}async deactivatePlugin(e){const t=this._plugins.get(e);if(!t)throw new ReferenceError(`Plugin '${e}' is not registered.`);if(!t.activated)return[];if(!t.deactivate)throw new TypeError(`Plugin '${e}'#deactivate() method missing`);const r=i.findDependents(e,this._plugins,this._services),n=r.map((e=>this._plugins.get(e)));for(const t of n)if(!t.deactivate)throw new TypeError(`Plugin ${t.id}#deactivate() method missing (depends on ${e})`);for(const e of n){const t=[...e.requires,...e.optional].map((e=>{const t=this._services.get(e);return t?this._plugins.get(t).service:null}));await e.deactivate(this,...t),e.service=null,e.activated=!1}return r.pop(),r}async resolveRequiredService(e){const t=this._services.get(e);if(!t)throw new TypeError(`No provider for: ${e.name}.`);const r=this._plugins.get(t);return r.activated||await this.activatePlugin(t),r.service}async resolveOptionalService(e){const t=this._services.get(e);if(!t)return null;const r=this._plugins.get(t);if(!r.activated)try{await this.activatePlugin(t)}catch(e){return console.error(e),null}return r.service}start(e={}){if(this._started)return this._delegate.promise;this._started=!0;const t=e.hostID||"",r=i.collectStartupPlugins(this._plugins,e).map((e=>this.activatePlugin(e).catch((t=>{console.error(`Plugin '${e}' failed to activate.`),console.error(t)}))));return Promise.all(r).then((()=>{this.attachShell(t),this.addEventListeners(),this._delegate.resolve()})),this._delegate.promise}get deferredPlugins(){return Array.from(this._plugins).filter((([e,t])=>"defer"===t.autoStart)).map((([e,t])=>e))}async activateDeferredPlugins(){const e=this.deferredPlugins.filter((e=>this._plugins.get(e).autoStart)).map((e=>this.activatePlugin(e)));await Promise.all(e)}handleEvent(e){switch(e.type){case"resize":this.evtResize(e);break;case"keydown":this.evtKeydown(e);break;case"contextmenu":this.evtContextMenu(e)}}attachShell(e){l.x0.attach(this.shell,e&&document.getElementById(e)||document.body)}addEventListeners(){document.addEventListener("contextmenu",this),document.addEventListener("keydown",this,!0),window.addEventListener("resize",this)}evtKeydown(e){this.commands.processKeydownEvent(e)}evtContextMenu(e){e.shiftKey||this.contextMenu.open(e)&&(e.preventDefault(),e.stopPropagation())}evtResize(e){this.shell.update()}}!function(e){e.createPluginData=function(e){var t,r,n,o;return{id:e.id,description:null!==(t=e.description)&&void 0!==t?t:"",service:null,promise:null,activated:!1,activate:e.activate,deactivate:null!==(r=e.deactivate)&&void 0!==r?r:null,provides:null!==(n=e.provides)&&void 0!==n?n:null,autoStart:null!==(o=e.autoStart)&&void 0!==o&&o,requires:e.requires?e.requires.slice():[],optional:e.optional?e.optional.slice():[]}},e.ensureNoCycle=function(e,t,r){const n=[...e.requires,...e.optional],o=n=>{if(n===e.provides)return!0;const i=r.get(n);if(!i)return!1;const a=t.get(i),c=[...a.requires,...a.optional];return 0!==c.length&&(s.push(i),!!c.some(o)||(s.pop(),!1))};if(!e.provides||0===n.length)return;const s=[e.id];if(n.some(o))throw new ReferenceError(`Cycle detected: ${s.join(" -> ")}.`)},e.findDependents=function(e,t,r){const n=new Array,o=e=>{const o=t.get(e),s=[...o.requires,...o.optional];n.push(...s.reduce(((t,n)=>{const o=r.get(n);return o&&t.push([e,o]),t}),[]))};for(const e of t.keys())o(e);const s=n.filter((t=>t[1]===e));let i=0;for(;s.length>i;){const e=s.length,t=new Set(s.map((e=>e[0])));for(const e of t)n.filter((t=>t[1]===e)).forEach((e=>{s.includes(e)||s.push(e)}));i=e}const a=function(e){let t=[],r=new Set,n=new Map;for(const t of e)o(t);for(const[e]of n)s(e);return t;function o(e){let[t,r]=e,o=n.get(r);o?o.push(t):n.set(r,[t])}function s(e){if(r.has(e))return;r.add(e);let o=n.get(e);if(o)for(const e of o)s(e);t.push(e)}}(s),c=a.findIndex((t=>t===e));return-1===c?[e]:a.slice(0,c+1)},e.collectStartupPlugins=function(e,t){const r=new Set;for(const t of e.keys())!0===e.get(t).autoStart&&r.add(t);if(t.startPlugins)for(const e of t.startPlugins)r.add(e);if(t.ignorePlugins)for(const e of t.ignorePlugins)r.delete(e);return Array.from(r)}}(i||(i={}))},18565:function(e,t,r){var n=r(42165);!function(e){"use strict";var t="undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},o=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},s=Object.prototype.hasOwnProperty;function i(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function a(e){try{return encodeURIComponent(e)}catch(e){return null}}var c={stringify:function(e,t){t=t||"";var r,n,o=[];for(n in"string"!=typeof t&&(t="?"),e)if(s.call(e,n)){if((r=e[n])||null!=r&&!isNaN(r)||(r=""),n=a(n),r=a(r),null===n||null===r)continue;o.push(n+"="+r)}return o.length?t+o.join("&"):""},parse:function(e){for(var t,r=/([^=?#&]+)=?([^&]*)/g,n={};t=r.exec(e);){var o=i(t[1]),s=i(t[2]);null===o||null===s||o in n||(n[o]=s)}return n}},l=/[\n\r\t]/g,u=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,p=/^[a-zA-Z]:/,d=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/;function f(e){return(e||"").toString().replace(d,"")}var g=[["#","hash"],["?","query"],function(e,t){return m(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],v={hash:1,query:1};function y(e){var r,n=("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}).location||{},o={},s=typeof(e=e||n);if("blob:"===e.protocol)o=new w(unescape(e.pathname),{});else if("string"===s)for(r in o=new w(e,{}),v)delete o[r];else if("object"===s){for(r in e)r in v||(o[r]=e[r]);void 0===o.slashes&&(o.slashes=u.test(e.href))}return o}function m(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function S(e,t){e=(e=f(e)).replace(l,""),t=t||{};var r,n=h.exec(e),o=n[1]?n[1].toLowerCase():"",s=!!n[2],i=!!n[3],a=0;return s?i?(r=n[2]+n[3]+n[4],a=n[2].length+n[3].length):(r=n[2]+n[4],a=n[2].length):i?(r=n[3]+n[4],a=n[3].length):r=n[4],"file:"===o?a>=2&&(r=r.slice(2)):m(o)?r=n[4]:o?s&&(r=r.slice(2)):a>=2&&m(t.protocol)&&(r=n[4]),{protocol:o,slashes:s||m(o),slashesCount:a,rest:r}}function w(e,t,r){if(e=(e=f(e)).replace(l,""),!(this instanceof w))return new w(e,t,r);var n,s,i,a,u,h,d=g.slice(),v=typeof t,E=this,b=0;for("object"!==v&&"string"!==v&&(r=t,t=null),r&&"function"!=typeof r&&(r=c.parse),n=!(s=S(e||"",t=y(t))).protocol&&!s.slashes,E.slashes=s.slashes||n&&t.slashes,E.protocol=s.protocol||t.protocol||"",e=s.rest,("file:"===s.protocol&&(2!==s.slashesCount||p.test(e))||!s.slashes&&(s.protocol||s.slashesCount<2||!m(E.protocol)))&&(d[3]=[/(.*)/,"pathname"]);b<d.length;b++)"function"!=typeof(a=d[b])?(i=a[0],h=a[1],i!=i?E[h]=e:"string"==typeof i?~(u="@"===i?e.lastIndexOf(i):e.indexOf(i))&&("number"==typeof a[2]?(E[h]=e.slice(0,u),e=e.slice(u+a[2])):(E[h]=e.slice(u),e=e.slice(0,u))):(u=i.exec(e))&&(E[h]=u[1],e=e.slice(0,u.index)),E[h]=E[h]||n&&a[3]&&t[h]||"",a[4]&&(E[h]=E[h].toLowerCase())):e=a(e,E);r&&(E.query=r(E.query)),n&&t.slashes&&"/"!==E.pathname.charAt(0)&&(""!==E.pathname||""!==t.pathname)&&(E.pathname=function(e,t){if(""===e)return t;for(var r=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=r.length,o=r[n-1],s=!1,i=0;n--;)"."===r[n]?r.splice(n,1):".."===r[n]?(r.splice(n,1),i++):i&&(0===n&&(s=!0),r.splice(n,1),i--);return s&&r.unshift(""),"."!==o&&".."!==o||r.push(""),r.join("/")}(E.pathname,t.pathname)),"/"!==E.pathname.charAt(0)&&m(E.protocol)&&(E.pathname="/"+E.pathname),o(E.port,E.protocol)||(E.host=E.hostname,E.port=""),E.username=E.password="",E.auth&&(~(u=E.auth.indexOf(":"))?(E.username=E.auth.slice(0,u),E.username=encodeURIComponent(decodeURIComponent(E.username)),E.password=E.auth.slice(u+1),E.password=encodeURIComponent(decodeURIComponent(E.password))):E.username=encodeURIComponent(decodeURIComponent(E.auth)),E.auth=E.password?E.username+":"+E.password:E.username),E.origin="file:"!==E.protocol&&m(E.protocol)&&E.host?E.protocol+"//"+E.host:"null",E.href=E.toString()}w.prototype={set:function(e,t,r){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(r||c.parse)(t)),n[e]=t;break;case"port":n[e]=t,o(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,/:\d+$/.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";n[e]=t.charAt(0)!==s?s+t:t}else n[e]=t;break;case"username":case"password":n[e]=encodeURIComponent(t);break;case"auth":var i=t.indexOf(":");~i?(n.username=t.slice(0,i),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=t.slice(i+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(t))}for(var a=0;a<g.length;a++){var l=g[a];l[4]&&(n[l[1]]=n[l[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin="file:"!==n.protocol&&m(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(e){e&&"function"==typeof e||(e=c.stringify);var t,r=this,n=r.host,o=r.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var s=o+(r.protocol&&r.slashes||m(r.protocol)?"//":"");return r.username?(s+=r.username,r.password&&(s+=":"+r.password),s+="@"):r.password?(s+=":"+r.password,s+="@"):"file:"!==r.protocol&&m(r.protocol)&&!n&&"/"!==r.pathname&&(s+="@"),":"===n[n.length-1]&&(n+=":"),s+=n+r.pathname,(t="object"==typeof r.query?e(r.query):r.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),r.hash&&(s+=r.hash),s}},w.extractProtocol=S,w.location=y,w.trimLeft=f,w.qs=c;var E=w;function b(e,t){setTimeout((function(t){return e.call(t)}),4,t)}function k(e,t){void 0!==n&&console[e].call(null,t)}function _(e,t){void 0===e&&(e=[]);var r=[];return e.forEach((function(e){t(e)||r.push(e)})),r}var C=function(){this.listeners={}};function M(e){var t=e.indexOf("?");return t>=0?e.slice(0,t):e}C.prototype.addEventListener=function(e,t){"function"==typeof t&&(Array.isArray(this.listeners[e])||(this.listeners[e]=[]),0===function(e,t){void 0===e&&(e=[]);var r=[];return e.forEach((function(e){t(e)&&r.push(e)})),r}(this.listeners[e],(function(e){return e===t})).length&&this.listeners[e].push(t))},C.prototype.removeEventListener=function(e,t){var r=this.listeners[e];this.listeners[e]=_(r,(function(e){return e===t}))},C.prototype.dispatchEvent=function(e){for(var t=this,r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];var o=e.type,s=this.listeners[o];return!!Array.isArray(s)&&(s.forEach((function(n){r.length>0?n.apply(t,r):n.call(t,e)})),!0)};var O=function(){this.urlMap={}};O.prototype.attachWebSocket=function(e,t){var r=M(t),n=this.urlMap[r];if(n&&n.server&&-1===n.websockets.indexOf(e))return n.websockets.push(e),n.server},O.prototype.addMembershipToRoom=function(e,t){var r=this.urlMap[M(e.url)];r&&r.server&&-1!==r.websockets.indexOf(e)&&(r.roomMemberships[t]||(r.roomMemberships[t]=[]),r.roomMemberships[t].push(e))},O.prototype.attachServer=function(e,t){var r=M(t);if(!this.urlMap[r])return this.urlMap[r]={server:e,websockets:[],roomMemberships:{}},e},O.prototype.serverLookup=function(e){var t=M(e),r=this.urlMap[t];if(r)return r.server},O.prototype.websocketsLookup=function(e,t,r){var n,o=M(e),s=this.urlMap[o];return n=s?s.websockets:[],t&&(n=s.roomMemberships[t]||[]),r?n.filter((function(e){return e!==r})):n},O.prototype.removeServer=function(e){delete this.urlMap[M(e)]},O.prototype.removeWebSocket=function(e,t){var r=M(t),n=this.urlMap[r];n&&(n.websockets=_(n.websockets,(function(t){return t===e})))},O.prototype.removeMembershipFromRoom=function(e,t){var r=this.urlMap[M(e.url)],n=r.roomMemberships[t];r&&null!==n&&(r.roomMemberships[t]=_(n,(function(t){return t===e})))};var x=new O,R=1e3,P=1005,N=1006,L={CONSTRUCTOR_ERROR:"Failed to construct 'WebSocket':",CLOSE_ERROR:"Failed to execute 'close' on 'WebSocket':",EVENT:{CONSTRUCT:"Failed to construct 'Event':",MESSAGE:"Failed to construct 'MessageEvent':",CLOSE:"Failed to construct 'CloseEvent':"}},I=function(){};I.prototype.stopPropagation=function(){},I.prototype.stopImmediatePropagation=function(){},I.prototype.initEvent=function(e,t,r){void 0===e&&(e="undefined"),void 0===t&&(t=!1),void 0===r&&(r=!1),this.type=""+e,this.bubbles=Boolean(t),this.cancelable=Boolean(r)};var T=function(e){function t(t,r){if(void 0===r&&(r={}),e.call(this),!t)throw new TypeError(L.EVENT_ERROR+" 1 argument required, but only 0 present.");if("object"!=typeof r)throw new TypeError(L.EVENT_ERROR+" parameter 2 ('eventInitDict') is not an object.");var n=r.bubbles,o=r.cancelable;this.type=""+t,this.timeStamp=Date.now(),this.target=null,this.srcElement=null,this.returnValue=!0,this.isTrusted=!1,this.eventPhase=0,this.defaultPrevented=!1,this.currentTarget=null,this.cancelable=!!o&&Boolean(o),this.cancelBubble=!1,this.bubbles=!!n&&Boolean(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(I),A=function(e){function t(t,r){if(void 0===r&&(r={}),e.call(this),!t)throw new TypeError(L.EVENT.MESSAGE+" 1 argument required, but only 0 present.");if("object"!=typeof r)throw new TypeError(L.EVENT.MESSAGE+" parameter 2 ('eventInitDict') is not an object");var n=r.bubbles,o=r.cancelable,s=r.data,i=r.origin,a=r.lastEventId,c=r.ports;this.type=""+t,this.timeStamp=Date.now(),this.target=null,this.srcElement=null,this.returnValue=!0,this.isTrusted=!1,this.eventPhase=0,this.defaultPrevented=!1,this.currentTarget=null,this.cancelable=!!o&&Boolean(o),this.canncelBubble=!1,this.bubbles=!!n&&Boolean(n),this.origin=""+i,this.ports=void 0===c?null:c,this.data=void 0===s?null:s,this.lastEventId=""+(a||"")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(I),j=function(e){function t(t,r){if(void 0===r&&(r={}),e.call(this),!t)throw new TypeError(L.EVENT.CLOSE+" 1 argument required, but only 0 present.");if("object"!=typeof r)throw new TypeError(L.EVENT.CLOSE+" parameter 2 ('eventInitDict') is not an object");var n=r.bubbles,o=r.cancelable,s=r.code,i=r.reason,a=r.wasClean;this.type=""+t,this.timeStamp=Date.now(),this.target=null,this.srcElement=null,this.returnValue=!0,this.isTrusted=!1,this.eventPhase=0,this.defaultPrevented=!1,this.currentTarget=null,this.cancelable=!!o&&Boolean(o),this.cancelBubble=!1,this.bubbles=!!n&&Boolean(n),this.code="number"==typeof s?parseInt(s,10):0,this.reason=""+(i||""),this.wasClean=!!a&&Boolean(a)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(I);function U(e){var t=e.type,r=e.target,n=new T(t);return r&&(n.target=r,n.srcElement=r,n.currentTarget=r),n}function D(e){var t=e.type,r=e.origin,n=e.data,o=e.target,s=new A(t,{data:n,origin:r});return o&&(s.target=o,s.srcElement=o,s.currentTarget=o),s}function q(e){var t=e.code,r=e.reason,n=e.type,o=e.target,s=e.wasClean;s||(s=t===R||t===P);var i=new j(n,{code:t,reason:r,wasClean:s});return o&&(i.target=o,i.srcElement=o,i.currentTarget=o),i}function W(e,t,r){e.readyState=B.CLOSING;var n=x.serverLookup(e.url),o=q({type:"close",target:e.target,code:t,reason:r});b((function(){x.removeWebSocket(e,e.url),e.readyState=B.CLOSED,e.dispatchEvent(o),n&&n.dispatchEvent(o,n)}),e)}function J(e){return"[object Blob]"===Object.prototype.toString.call(e)||e instanceof ArrayBuffer||(e=String(e)),e}var K=new WeakMap;function G(e){if(K.has(e))return K.get(e);var t=new Proxy(e,{get:function(r,n){if("close"===n)return function(e){void 0===e&&(e={});var r=e.code||R,n=e.reason||"";W(t,r,n)};if("send"===n)return function(t){t=J(t),e.dispatchEvent(D({type:"message",data:t,origin:this.url,target:e}))};var o=function(e){return"message"===e?"server::"+e:e};return"on"===n?function(t,r){e.addEventListener(o(t),r)}:"off"===n?function(t,r){e.removeEventListener(o(t),r)}:"target"===n?e:r[n]}});return K.set(e,t),t}var B=function(e){function t(r,n){e.call(this),this._onopen=null,this._onmessage=null,this._onerror=null,this._onclose=null,this.url=function(e){var t=new E(e),r=t.pathname,n=t.protocol,o=t.hash;if(!e)throw new TypeError(L.CONSTRUCTOR_ERROR+" 1 argument required, but only 0 present.");if(r||(t.pathname="/"),""===n)throw new SyntaxError(L.CONSTRUCTOR_ERROR+" The URL '"+t.toString()+"' is invalid.");if("ws:"!==n&&"wss:"!==n)throw new SyntaxError(L.CONSTRUCTOR_ERROR+" The URL's scheme must be either 'ws' or 'wss'. '"+n+"' is not allowed.");if(""!==o)throw new SyntaxError(L.CONSTRUCTOR_ERROR+" The URL contains a fragment identifier ('"+o+"'). Fragment identifiers are not allowed in WebSocket URLs.");return t.toString()}(r),n=function(e){if(void 0===e&&(e=[]),!Array.isArray(e)&&"string"!=typeof e)throw new SyntaxError(L.CONSTRUCTOR_ERROR+" The subprotocol '"+e.toString()+"' is invalid.");"string"==typeof e&&(e=[e]);var t=e.map((function(e){return{count:1,protocol:e}})).reduce((function(e,t){return e[t.protocol]=(e[t.protocol]||0)+t.count,e}),{}),r=Object.keys(t).filter((function(e){return t[e]>1}));if(r.length>0)throw new SyntaxError(L.CONSTRUCTOR_ERROR+" The subprotocol '"+r[0]+"' is duplicated.");return e}(n),this.protocol=n[0]||"",this.binaryType="blob",this.readyState=t.CONNECTING;var o=G(this),s=x.attachWebSocket(o,this.url);b((function(){if(this.readyState===t.CONNECTING)if(s)if(s.options.verifyClient&&"function"==typeof s.options.verifyClient&&!s.options.verifyClient())this.readyState=t.CLOSED,k("error","WebSocket connection to '"+this.url+"' failed: HTTP Authentication failed; no valid credentials available"),x.removeWebSocket(o,this.url),this.dispatchEvent(U({type:"error",target:this})),this.dispatchEvent(q({type:"close",target:this,code:R}));else{if(s.options.selectProtocol&&"function"==typeof s.options.selectProtocol){var e=s.options.selectProtocol(n),r=""!==e,i=-1!==n.indexOf(e);if(r&&!i)return this.readyState=t.CLOSED,k("error","WebSocket connection to '"+this.url+"' failed: Invalid Sub-Protocol"),x.removeWebSocket(o,this.url),this.dispatchEvent(U({type:"error",target:this})),void this.dispatchEvent(q({type:"close",target:this,code:R}));this.protocol=e}this.readyState=t.OPEN,this.dispatchEvent(U({type:"open",target:this})),s.dispatchEvent(U({type:"connection"}),o)}else this.readyState=t.CLOSED,this.dispatchEvent(U({type:"error",target:this})),this.dispatchEvent(q({type:"close",target:this,code:R})),k("error","WebSocket connection to '"+this.url+"' failed")}),this)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={onopen:{},onmessage:{},onclose:{},onerror:{}};return r.onopen.get=function(){return this._onopen},r.onmessage.get=function(){return this._onmessage},r.onclose.get=function(){return this._onclose},r.onerror.get=function(){return this._onerror},r.onopen.set=function(e){this.removeEventListener("open",this._onopen),this._onopen=e,this.addEventListener("open",e)},r.onmessage.set=function(e){this.removeEventListener("message",this._onmessage),this._onmessage=e,this.addEventListener("message",e)},r.onclose.set=function(e){this.removeEventListener("close",this._onclose),this._onclose=e,this.addEventListener("close",e)},r.onerror.set=function(e){this.removeEventListener("error",this._onerror),this._onerror=e,this.addEventListener("error",e)},t.prototype.send=function(e){var r=this;if(this.readyState===t.CONNECTING)throw new Error("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state");var n=D({type:"server::message",origin:this.url,data:J(e)}),o=x.serverLookup(this.url);o&&b((function(){r.dispatchEvent(n,e)}),o)},t.prototype.close=function(e,r){if(void 0!==e&&("number"!=typeof e||1e3!==e&&(e<3e3||e>4999)))throw new TypeError(L.CLOSE_ERROR+" The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(void 0!==r&&(n=r,o=encodeURIComponent(n).match(/%[89ABab]/g),n.length+(o?o.length:0)>123))throw new SyntaxError(L.CLOSE_ERROR+" The message must not be greater than 123 bytes.");var n,o;if(this.readyState!==t.CLOSING&&this.readyState!==t.CLOSED){var s=G(this);this.readyState===t.CONNECTING?function(e,t,r){e.readyState=B.CLOSING;var n=x.serverLookup(e.url),o=q({type:"close",target:e.target,code:t,reason:r,wasClean:!1}),s=U({type:"error",target:e.target});b((function(){x.removeWebSocket(e,e.url),e.readyState=B.CLOSED,e.dispatchEvent(s),e.dispatchEvent(o),n&&n.dispatchEvent(o,n)}),e)}(s,e||N,r):W(s,e||P,r)}},Object.defineProperties(t.prototype,r),t}(C);B.CONNECTING=0,B.prototype.CONNECTING=B.CONNECTING,B.OPEN=1,B.prototype.OPEN=B.OPEN,B.CLOSING=2,B.prototype.CLOSING=B.CLOSING,B.CLOSED=3,B.prototype.CLOSED=B.CLOSED;var F=function(e){function t(r,n){var o=this;void 0===r&&(r="socket.io"),void 0===n&&(n=""),e.call(this),this.binaryType="blob";var s=new E(r);s.pathname||(s.pathname="/"),this.url=s.toString(),this.readyState=t.CONNECTING,this.protocol="",this.target=this,"string"==typeof n||"object"==typeof n&&null!==n?this.protocol=n:Array.isArray(n)&&n.length>0&&(this.protocol=n[0]);var i=x.attachWebSocket(this,this.url);b((function(){i?(this.readyState=t.OPEN,i.dispatchEvent(U({type:"connection"}),i,this),i.dispatchEvent(U({type:"connect"}),i,this),this.dispatchEvent(U({type:"connect",target:this}))):(this.readyState=t.CLOSED,this.dispatchEvent(U({type:"error",target:this})),this.dispatchEvent(q({type:"close",target:this,code:R})),k("error","Socket.io connection to '"+this.url+"' failed"))}),this),this.addEventListener("close",(function(e){o.dispatchEvent(q({type:"disconnect",target:e.target,code:e.code}))}))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={broadcast:{}};return t.prototype.close=function(){if(this.readyState===t.OPEN){var e=x.serverLookup(this.url);return x.removeWebSocket(this,this.url),this.readyState=t.CLOSED,this.dispatchEvent(q({type:"close",target:this,code:R})),e&&e.dispatchEvent(q({type:"disconnect",target:this,code:R}),e),this}},t.prototype.disconnect=function(){return this.close()},t.prototype.emit=function(e){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];if(this.readyState!==t.OPEN)throw new Error("SocketIO is already in CLOSING or CLOSED state");var o=D({type:e,origin:this.url,data:r}),s=x.serverLookup(this.url);return s&&s.dispatchEvent.apply(s,[o].concat(r)),this},t.prototype.send=function(e){return this.emit("message",e),this},r.broadcast.get=function(){if(this.readyState!==t.OPEN)throw new Error("SocketIO is already in CLOSING or CLOSED state");var e=this,r=x.serverLookup(this.url);if(!r)throw new Error("SocketIO can not find a server at the specified URL ("+this.url+")");return{emit:function(t,n){return r.emit(t,n,{websockets:x.websocketsLookup(e.url,null,e)}),e},to:function(t){return r.to(t,e)},in:function(t){return r.in(t,e)}}},t.prototype.on=function(e,t){return this.addEventListener(e,t),this},t.prototype.off=function(e,t){this.removeEventListener(e,t)},t.prototype.hasListeners=function(e){var t=this.listeners[e];return!!Array.isArray(t)&&!!t.length},t.prototype.join=function(e){x.addMembershipToRoom(this,e)},t.prototype.leave=function(e){x.removeMembershipFromRoom(this,e)},t.prototype.to=function(e){return this.broadcast.to(e)},t.prototype.in=function(){return this.to.apply(null,arguments)},t.prototype.dispatchEvent=function(e){for(var t=this,r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];var o=e.type,s=this.listeners[o];if(!Array.isArray(s))return!1;s.forEach((function(n){r.length>0?n.apply(t,r):n.call(t,e.data?e.data:e)}))},Object.defineProperties(t.prototype,r),t}(C);F.CONNECTING=0,F.OPEN=1,F.CLOSING=2,F.CLOSED=3;var V=function(e,t){return new F(e,t)};V.connect=function(e,t){return V(e,t)};function $(){return"undefined"!=typeof window?window:"object"==typeof n&&"object"==typeof r.g?r.g:this}var z={mock:!0,verifyClient:null,selectProtocol:null},H=function(e){function t(t,r){void 0===r&&(r=z),e.call(this);var n=new E(t);if(n.pathname||(n.pathname="/"),this.url=n.toString(),this.originalWebSocket=null,!x.attachServer(this,this.url))throw this.dispatchEvent(U({type:"error"})),new Error("A mock server is already listening on this url");this.options=Object.assign({},z,r),this.options.mock&&this.mockWebsocket()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.mockWebsocket=function(){var e=$();this.originalWebSocket=e.WebSocket,e.WebSocket=B},t.prototype.restoreWebsocket=function(){var e=$();null!==this.originalWebSocket&&(e.WebSocket=this.originalWebSocket),this.originalWebSocket=null},t.prototype.stop=function(e){void 0===e&&(e=function(){}),this.options.mock&&this.restoreWebsocket(),x.removeServer(this.url),"function"==typeof e&&e()},t.prototype.on=function(e,t){this.addEventListener(e,t)},t.prototype.off=function(e,t){this.removeEventListener(e,t)},t.prototype.close=function(e){void 0===e&&(e={});var t=e.code,r=e.reason,n=e.wasClean,o=x.websocketsLookup(this.url);x.removeServer(this.url),o.forEach((function(e){e.readyState=B.CLOSED,e.dispatchEvent(q({type:"close",target:e.target,code:t||R,reason:r||"",wasClean:n}))})),this.dispatchEvent(q({type:"close"}),this)},t.prototype.emit=function(e,t,r){var n=this;void 0===r&&(r={});var o,s=r.websockets;s||(s=x.websocketsLookup(this.url)),"object"!=typeof r||arguments.length>3?(t=Array.prototype.slice.call(arguments,1,arguments.length),o=t.map((function(e){return J(e)}))):o=J(t),s.forEach((function(r){var s=r instanceof F?t:o;Array.isArray(s)?r.dispatchEvent.apply(r,[D({type:e,data:s,origin:n.url,target:r.target})].concat(s)):r.dispatchEvent(D({type:e,data:s,origin:n.url,target:r.target}))}))},t.prototype.clients=function(){return x.websocketsLookup(this.url)},t.prototype.to=function(e,t,r){var n=this;void 0===r&&(r=[]);var o=this,s=r.concat(x.websocketsLookup(this.url,e,t)).reduce((function(e,t){return e.indexOf(t)>-1?e:e.concat(t)}),[]);return{to:function(e,t){return n.to.call(n,e,t,s)},emit:function(e,t){o.emit(e,t,{websockets:s})}}},t.prototype.in=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return this.to.apply(null,e)},t.prototype.simulate=function(e){var t=x.websocketsLookup(this.url);"error"===e&&t.forEach((function(e){e.readyState=B.CLOSED,e.dispatchEvent(U({type:"error",target:e.target}))}))},t}(C);H.of=function(e){return new H(e)};var Y=H,Z=B,X=V;e.Server=Y,e.WebSocket=Z,e.SocketIO=X,Object.defineProperty(e,"__esModule",{value:!0})}(t)}}]);