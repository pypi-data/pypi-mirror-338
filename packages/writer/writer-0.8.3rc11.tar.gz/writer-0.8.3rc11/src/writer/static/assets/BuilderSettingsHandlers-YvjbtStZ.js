import{d as j,i as g,a as b,c,o as m,e as _,E,f as a,n as f,M as l,a9 as S,P as L,_ as N,aP as G,q as H,x as z,t as K,y as V,z as F,b as J,Q}from"./index-DRQkzaGL.js";import{u as U,W as O,a as P}from"./BuilderApp-CnvDpafG.js";import{a as X}from"./useWorkflowRun-D2zjppUo.js";import{_ as Y}from"./WdsLoaderDots.vue_vue_type_script_setup_true_lang-BjkJSKWK.js";import"./BaseTransitionSlideFade-BBIsMEkV.js";import"./marked.esm-273vDTCT.js";const Z={class:"BuilderWorkflowState"},ee=j({__name:"BuilderWorkflowState",props:{workflowId:{type:String,required:!0}},setup(v){const i=v,d=g(b.core),n=g(b.builderManager),w=c(()=>d.getComponents(i.workflowId)),B=c(()=>w.value.map(r=>r.id)),u=c(()=>{var W,C,I;const o=(W=n.getLogEntries().filter(h=>h.workflowExecution?h.workflowExecution.summary.some($=>B.value.includes($.componentId)):!1).at(0))==null?void 0:W.workflowExecution.summary.at(-1);if(!o)return;if(o.outcome==="in_progress")return"in_progress";const p=d.getComponentById(o.componentId);return((I=(C=d.getComponentDefinition(p.type).outs)==null?void 0:C[o.outcome])==null?void 0:I.style)??"success"});return(r,o)=>(m(),_("div",Z,[u.value?u.value==="success"?E(r.$slots,"success",{key:1},()=>[o[0]||(o[0]=a("span",{class:"BuilderWorkflowState__status BuilderWorkflowState__status--success material-symbols-outlined"},"check",-1))],!0):u.value==="error"?E(r.$slots,"error",{key:2},()=>[o[1]||(o[1]=a("span",{class:"BuilderWorkflowState__status BuilderWorkflowState__status--error material-symbols-outlined"},"error",-1))],!0):u.value==="in_progress"?E(r.$slots,"running",{key:3},()=>[f(Y,{class:"BuilderWorkflowState__status",color:l(S).Gray5},null,8,["color"])],!0):L("",!0):E(r.$slots,"unknown",{key:0},void 0,!0)]))}}),te=N(ee,[["__scopeId","data-v-eb30171b"]]),oe=["aria-busy"],ne={class:"BuilderSettingsHandlersWorkflow__title"},se=["data-writer-tooltip"],re={class:"BuilderSettingsHandlersWorkflow__list"},le={class:"BuilderSettingsHandlersWorkflow__list__item"},ie={class:"BuilderSettingsHandlersWorkflow__list__item"},ae=j({__name:"BuilderSettingsHandlersWorkflow",props:{component:{type:Object,required:!0},eventType:{type:String,required:!0},eventDescription:{type:String,required:!1,default:void 0}},setup(v){const i=g(b.core),d=g(b.builderManager),n=v,{createAndInsertComponent:w,removeComponentsSubtree:B}=Q(i,d),u=c(()=>n.eventType.replace(/^wf-/,"").replaceAll("-"," ")),{workflows:r,triggers:o}=G(i,c(()=>n.component.id),c(()=>n.eventType)),{run:p,isRunning:k}=X(i,c(()=>o.value.map(e=>({workflowId:e.parentId,branchId:e.id})))),{pushToast:W}=U();function C(){const e=r.value.map(t=>{const s=(t.content.key??"0").match(/\d+/);return s?Number(s[0]):0});return e.length===0?1:Math.max(...e)+1}async function I(){var A;const{type:e}=n.component,{name:t,events:s}=i.getComponentDefinition(e),T=`${t} - ${n.eventType}`,D=`${e}@${n.eventType.replace(/^wf-/,"")}_${C()}`;let y=(A=s==null?void 0:s[n.eventType])==null?void 0:A.eventPayloadExample;typeof y=="object"&&y!==null&&(y=JSON.stringify(y));const q=w("workflows_workflow","workflows_root",void 0,{content:{key:D}},x=>{w("workflows_uieventtrigger",x,void 0,{content:{alias:T,refComponentId:n.component.id,refEventType:n.eventType,defaultResult:y?String(y):void 0},x:96,y:96})});W({type:"success",message:`${T} added`,action:{label:"Go to workflow",func:()=>{var x;return M(q,(x=h(q))==null?void 0:x.id)},icon:"linked_services"}})}function h(e){return i.getComponents(e).find(t=>t.type==="workflows_uieventtrigger"&&t.content.refComponentId===n.component.id&&t.content.refEventType===n.eventType)}function R(e){const t=[e.id];i.getComponents(e.parentId).length===1&&t.push(e.parentId),B(...t)}function $(e){var t,s;return((s=(t=i.getComponentById(e.parentId))==null?void 0:t.content)==null?void 0:s.key)||"Workflow"}function M(e,t){i.setActivePageId(e),d.setMode("workflows"),d.setSelection(t??e,void 0,"click")}return(e,t)=>(m(),_("div",{class:"BuilderSettingsHandlersWorkflow","aria-busy":l(k)},[a("div",ne,[f(z,{class:"BuilderSettingsHandlersWorkflow__title__btn",variant:"special",size:"icon","aria-label":"Run the attached workflows",disabled:l(k),loading:l(k),onClick:l(p)},{default:H(()=>t[0]||(t[0]=[a("i",{class:"material-symbols-outlined"},"play_arrow",-1)])),_:1},8,["disabled","loading","onClick"]),a("p",null,K(u.value),1),v.eventDescription?(m(),_("span",{key:0,"data-writer-tooltip":v.eventDescription,class:"material-symbols-outlined"},"help",8,se)):L("",!0)]),a("div",re,[(m(!0),_(V,null,F(l(o),(s,T)=>(m(),J(P,{key:s.id,color:l(S).Blue6,"color-last":l(o).length===T+1?l(S).Blue2:l(S).Blue6},{default:H(()=>[a("div",le,[f(O,{variant:"secondary",disabled:l(k),text:$(s),"data-writer-tooltip":$(s),"data-writer-tooltip-strategy":"overflow",onClick:D=>M(s.parentId,s.id)},null,8,["disabled","text","data-writer-tooltip","onClick"]),f(te,{"workflow-id":s.parentId},null,8,["workflow-id"]),f(z,{variant:"neutral",size:"smallIcon","custom-size":"18px","aria-label":"Unlink blueprint","data-writer-tooltip":"This will remove the trigger but will not delete the workflow",disabled:l(k),onClick:D=>R(s)},{default:H(()=>t[1]||(t[1]=[a("i",{class:"material-symbols-outlined"},"link_off",-1)])),_:2},1032,["disabled","onClick"])])]),_:2},1032,["color","color-last"]))),128)),f(P,{"is-last":"",color:l(S).Blue2},{default:H(()=>[a("div",ie,[f(O,{variant:"primary",weight:"semibold",disabled:l(k),"left-icon":"add",text:"Create blueprint",onClick:I},null,8,["disabled"])])]),_:1},8,["color"])])],8,oe))}}),de=N(ae,[["__scopeId","data-v-9a1867fa"]]),ce={key:0,class:"BuilderSettingsHandlers"},ue={class:"BuilderSettingsHandlers__list"},pe=j({__name:"BuilderSettingsHandlers",setup(v){const i=g(b.core),d=g(b.builderManager),n=c(()=>i.getComponentById(d.firstSelectedId.value)),w=c(()=>{const{type:u}=n.value,{events:r}=i.getComponentDefinition(u),o={...r};return Object.keys({...n.value.handlers}).forEach(p=>{o[p]||(o[p]={desc:"Custom event"})}),o}),B=c(()=>d.isSingleSelectionActive.value?Object.keys(w.value).length>0:!1);return(u,r)=>B.value?(m(),_("div",ce,[r[0]||(r[0]=a("div",{class:"BuilderSettingsHandlers__title"},[a("i",{class:"material-symbols-outlined"},"linked_services"),a("h3",null,"Blueprints")],-1)),a("div",ue,[(m(!0),_(V,null,F(w.value,(o,p)=>(m(),_("div",{key:p},[f(de,{component:n.value,"event-type":p,"event-description":o.desc},null,8,["component","event-type","event-description"])]))),128))])])):L("",!0)}}),ye=N(pe,[["__scopeId","data-v-20e47a12"]]);export{ye as default};
