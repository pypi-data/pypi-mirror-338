import{d as P,aw as ce,ax as pe,c as g,o as p,e as v,f as d,n as M,ac as me,E as J,_ as R,i as x,a as L,r as F,aI as fe,aJ as G,w as Q,b as D,q as I,y as k,z as U,t as z,aK as ge,aL as ve,ai as Z,H as N,P as $,M as C,Q as ee,u as he,x as X,s as Y}from"./index-DRQkzaGL.js";import{T as ye}from"./BuilderApp-CnvDpafG.js";import{u as Ce}from"./useComponentDescription-Bqruml_0.js";import"./BaseTransitionSlideFade-BBIsMEkV.js";import"./marked.esm-273vDTCT.js";const _e={class:"BuilderSidebarPanel"},be={class:"BuilderSidebarPanel__inputContainer"},we={class:"BuilderSidebarPanel__main"},Be={class:"BuilderSidebarPanel__footer"},ke=P({__name:"BuilderSidebarPanel",props:ce({placeholder:{type:String,required:!0},searchCount:{type:Number,required:!1,default:void 0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const r=pe(s,"modelValue"),e=s,n=g(()=>{if(e.searchCount!==void 0)return`${e.searchCount} result${e.searchCount===1?"":"s"}`});return(t,l)=>(p(),v("div",_e,[d("div",be,[M(me,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=u=>r.value=u),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:s.placeholder,"right-text":n.value,"enable-clear-button":""},null,8,["modelValue","placeholder","right-text"])]),d("div",we,[J(t.$slots,"default",{},void 0,!0)]),d("div",Be,[J(t.$slots,"footer",{},void 0,!0)])]))}}),te=R(ke,[["__scopeId","data-v-99679ce7"]]),Ie={class:"header"},Se={class:"tools"},Te=["data-writer-tooltip","data-component-type","onDragstart"],$e={class:"name"},De=P({__name:"BuilderSidebarToolkit",setup(s){const r=x(L.core),e=x(L.builderManager),{removeInsertionCandidacy:n}=Z(r),t=F(""),l=["Layout","Content","Input","Embed","Writer","Logic","Triggers","Other"],u=g(()=>e.getMode()=="workflows"?"workflows":"core"),S=g(()=>{const m=l.map(c=>[c,y(c)]).filter(([c,_])=>_.length>0);return Object.fromEntries(m)}),V=g(()=>{if(t.value)return Object.values(S.value).reduce((m,c)=>m+c.length,0)}),h=g(()=>u.value=="core"?"Core toolkit":u.value=="workflows"?"Blueprints toolkit":"Toolkit");function y(m){const _=fe().filter(f=>{const b=G(f);return!(b.category!=m||!b.toolkit&&u.value!=="core"||b.toolkit&&b.toolkit!==u.value||b.deprecated)}).map(f=>{const{name:b,description:j,category:O}=G(f);return{type:f,name:b,description:j,category:O??"Other"}}),B=t.value.toLocaleLowerCase();return _.filter(f=>!B||f.name.toLocaleLowerCase().includes(B))}function q(m,c){e.setSelection(null),m.dataTransfer.setData(`application/json;writer=${c},`,"{}")}function A(m){n(m)}function E(m){return[`/components/${m.type}.svg`,`/components/${u.value=="workflows"?"workflows_":""}category_${m.category}.svg`].map(c=>ve(c))}return Q(u,()=>{t.value=""}),(m,c)=>(p(),D(te,{modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=_=>t.value=_),class:"BuilderSidebarToolkit",placeholder:h.value,"search-count":V.value},{default:I(()=>[(p(!0),v(k,null,U(S.value,(_,B)=>(p(),v("div",{key:B,class:"category"},[d("div",Ie,z(B),1),d("div",Se,[(p(!0),v(k,null,U(_,i=>(p(),v("div",{key:i.type,class:"tool","data-writer-tooltip":i.description,"data-writer-tooltip-placement":"right","data-writer-tooltip-gap":"8",draggable:"true","data-component-type":i.type,onDragend:c[0]||(c[0]=f=>A(f)),onDragstart:f=>q(f,i.type)},[M(ge,{alt:`(Icon for ${i.name})`,draggable:"false",urls:E(i)},null,8,["alt","urls"]),d("div",$e,z(i.name),1)],40,Te))),128))])]))),128))]),_:1},8,["modelValue","placeholder","search-count"]))}}),xe=R(De,[["__scopeId","data-v-be3d3864"]]);function oe(s,r){function e(n){if(!r.value)return!0;const t=s.getComponentDefinition(n.type);return!!(t!=null&&t.name.toLocaleLowerCase().includes(r.value)||Object.values(n.content).filter(u=>u.toLocaleLowerCase().includes(r.value)).length>0)}return{isComponentMatchingQuery:e}}function Le(s,r,e){const{isComponentMatchingQuery:n}=oe(s,r);return{searchResultCount:g(()=>{if(!r.value)return;let l=0;for(const u of s.getComponentsNested(e.value))n(u)&&l++;return l})}}function Ve(s,r,e){const{isComponentMatchingQuery:n}=oe(s,r),t=g(()=>!r.value||n(e.value));return{hasMatchingChildren:g(()=>{if(!r.value)return!0;for(const u of s.getComponentsNested(e.value.id))if(n(u))return!0;return!1}),matched:t}}const qe={class:"BuilderSidebarComponentTreeBranch__nameRight"},Me={class:"previewText"},Pe=P({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch"],setup(s,{emit:r}){const e=s,n=F(),t=x(L.core),l=x(L.builderManager),u=F(!1),S=g(()=>l.isComponentIdSelected(e.componentId)),{createAndInsertComponent:V,moveComponent:h,goToComponentParentPage:y,isDraggingAllowed:q}=ee(t,l),{getComponentInfoFromDrag:A,removeInsertionCandidacy:E,isParentSuitable:m}=Z(t),{isComponentVisible:c}=he(t),_=r,B=g(()=>{var a;return((a=e.query)==null?void 0:a.toLocaleLowerCase())??""}),i=g(()=>t.getComponentById(e.componentId)),{hasMatchingChildren:f,matched:b}=Ve(t,B,i);Q(f,a=>{var o;return(o=n.value)==null?void 0:o.toggleCollapse(!a)},{immediate:!0});const j=g(()=>t.getComponents(e.componentId,{sortedByPosition:!0})),{name:O,previewText:K}=Ce(t,i);async function ae(a){y(e.componentId),await N(),l.handleSelectionFromEvent(a,e.componentId,void 0,"tree"),W()}function W(){n.value&&(n.value.expand(),u.value=!1,_("expandBranch"))}function re(){var H;const a=(H=n.value)==null?void 0:H.$el;if(!a)return;const o=a.closest(".BuilderSidebarComponentTree"),w=o.getBoundingClientRect(),T=n.value.$el.offsetTop-w.height/2,ue=n.value.$el.offsetLeft-w.left-16;o.scrollTo({top:T,left:Math.max(0,ue),behavior:"smooth"})}function se(a){l.setSelection(null),a.dataTransfer.setData(`application/json;writer=${i.value.type},${i.value.id}`,"{}")}function le(a){E(a)}function ie(a){const o=A(a);if(!o)return;const{draggedType:w,draggedId:T}=o;m(e.componentId,T,w)&&a.preventDefault()}function de(a){const o=A(a);if(!o)return;const{draggedType:w,draggedId:T}=o;T?h(T,i.value.id):V(w,i.value.id),E(a)}return Q(l.firstSelectedItem,async a=>{a&&a.componentId===e.componentId&&a.source!="tree"&&(W(),await N(),re())},{immediate:!0}),(a,o)=>(p(),D(ye,{ref_key:"treeBranch",ref:n,class:"BuilderSidebarComponentTreeBranch","component-id":s.componentId,name:C(O),query:s.query,"has-children":j.value.length>0,"data-automation-key":i.value.type,draggable:C(q)(s.componentId),matched:C(b),selected:S.value,onSelect:ae,onDragover:ie,onDragstart:se,onDragend:le,onDrop:de},{nameRight:I(()=>[d("span",qe,[Object.keys(i.value.handlers??{}).length>0?(p(),v(k,{key:0},[o[0]||(o[0]=d("span",{class:"middot"},null,-1)),o[1]||(o[1]=d("i",{class:"material-symbols-outlined"},"bolt",-1))],64)):$("",!0),C(c)(i.value.id)?$("",!0):(p(),v(k,{key:1},[o[2]||(o[2]=d("span",{class:"middot"},null,-1)),o[3]||(o[3]=d("i",{class:"material-symbols-outlined"},"visibility_off",-1))],64)),i.value.isCodeManaged?(p(),v(k,{key:2},[o[4]||(o[4]=d("span",{class:"middot"},null,-1)),o[5]||(o[5]=d("i",{class:"material-symbols-outlined"},"terminal",-1))],64)):$("",!0),C(K)?(p(),v(k,{key:3},[o[6]||(o[6]=d("span",{class:"middot"},null,-1)),d("span",Me,z(C(K)),1)],64)):$("",!0)])]),children:I(()=>[(p(!0),v(k,null,U(j.value,w=>(p(),D(ne,{key:w.id,"component-id":w.id,query:s.query,onExpandBranch:W},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected"]))}}),ne=R(Pe,[["__scopeId","data-v-fa7f2523"]]),Re={class:"add"},Ae=P({__name:"BuilderSidebarComponentTree",setup(s){const r=x(L.core),e=x(L.builderManager),n=F(""),{createAndInsertComponent:t}=ee(r,e),l=e.activeRootId,{searchResultCount:u}=Le(r,n,l);async function S(){const h=t("page","root");r.setActivePageId(h),await N(),e.setSelection(h)}async function V(){const h=t("workflows_workflow","workflows_root");r.setActivePageId(h),await N(),e.setSelection(h)}return(h,y)=>(p(),D(te,{modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=q=>n.value=q),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":C(u)},{footer:I(()=>[d("div",Re,[C(l)=="root"?(p(),D(X,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:S},{default:I(()=>y[1]||(y[1]=[d("i",{class:"material-symbols-outlined"}," add ",-1),Y(" Add page")])),_:1})):$("",!0),C(l)=="workflows_root"?(p(),D(X,{key:1,variant:"special",size:"small","data-automation-action":"add-workflow",onClick:V},{default:I(()=>y[2]||(y[2]=[d("i",{class:"material-symbols-outlined"}," add ",-1),Y(" Add blueprint")])),_:1})):$("",!0)])]),default:I(()=>[d("div",null,[M(ne,{class:"rootBranch","component-id":C(l),query:n.value},null,8,["component-id","query"])])]),_:1},8,["modelValue","search-count"]))}}),Ee=R(Ae,[["__scopeId","data-v-1b58d296"]]),je={class:"BuilderSidebar"},Fe=P({__name:"BuilderSidebar",setup(s){return(r,e)=>(p(),v("div",je,[M(xe),M(Ee)]))}}),ze=R(Fe,[["__scopeId","data-v-c1777f55"]]);export{ze as default};
