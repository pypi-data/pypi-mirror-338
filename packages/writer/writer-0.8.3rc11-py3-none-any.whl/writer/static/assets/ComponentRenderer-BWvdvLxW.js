import{d as O,i as k,a as m,c as f,o as T,b as U,B as pe,e as L,f as v,t as R,W as ve,g as fe,r as x,p as M,w as H,F as me,h as B,u as Z,_ as X,j as ge,k as ye,l as ee,m as J,v as N,n as te,q as _e,s as he,x as Ce,y as be,z as Se,A as oe,C as we,D as Ie,E as Pe,G as Ee,H as Me,I as Te,J as ke,K as $e,L as Q}from"./index-DRQkzaGL.js";import{f as De}from"./instancePath-BsbOTTI8.js";const Ae=10,Be=O({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(b){const n=k(m.core),c=b,p=(h,r)=>{const I=h.map(d=>n.getComponentDefinition(d)).map(d=>d==null?void 0:d.name);return`${I.slice(0,-1).join(", ")} ${I.length>1?r:""} ${I.at(-1)}`},a=f(()=>{const h=n.getContainableTypes(c.componentId);let r;return h.length<=Ae&&(r=`You can add ${p(h,"and")} components`),r});return(h,r)=>(T(),U(pe,{class:"ChildlessPlaceholder","component-id":b.componentId,message:a.value},null,8,["component-id","message"]))}}),Re=["draggable"],xe={class:"title"},Ve={class:"message"},Le=O({__name:"RenderError",props:{componentType:{type:String,required:!0},message:{type:String,required:!0},draggable:{type:Boolean,required:!1}},setup(b){const n=k(m.core),c=k(m.componentId),p=f(()=>n.getComponentById(c)),a=f(()=>{var r;return n.getComponentById((r=p.value)==null?void 0:r.parentId)}),h=f(()=>{var r;return((r=a.value)==null?void 0:r.type)==="workflows_workflow"});return(r,g)=>h.value?(T(),U(ve,{key:0,draggable:!1})):(T(),L("div",{key:1,class:"RenderError",draggable:b.draggable},[v("div",xe,[v("h2",null,"Error rendering "+R(b.componentType),1)]),v("div",Ve,R(b.message),1)],8,Re))}}),We={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(b){const n=k(m.core),c=k(m.builderManager),p=b.componentId,a=f(()=>n.getComponentById(p)),h=fe(a.value.type),r=b.instancePath,g=b.instanceData,{getEvaluatedFields:I,isComponentVisible:y}=Z(n),d=I(r),E=f(()=>n.getComponents(p,{sortedByPosition:!0})),P=f(()=>!!c&&c.getMode()!="preview"),j=f(()=>{var t;return P.value&&!a.value.isCodeManaged&&a.value.type!=="root"&&a.value.type!=="workflows_root"&&((t=A.value)==null?void 0:t.toolkit)!=="workflows"}),W=(t,l)=>(t?n.getContainableTypes(t):["root","workflows_root"]).includes(l),V=x(!1),z=()=>{if(!(E.value.length>0))return B(Be,{componentId:a.value.id})},e=(t,l=0,i)=>B(ne,{componentId:t,key:`${t}:${l}`,instancePath:[...r,{componentId:t,instanceNumber:l}],instanceData:[...g,x(null)],...i??{}}),o=t=>l=>{if(!W(p,l.type)&&t==="default")return!0;const _=n.getComponentDefinition(l.type).slot??"default";return _==="*"||_===t},s=(t=0,l="default",i=()=>!0,_=!1)=>{const S=C=>!P.value||_?[]:[B("div",{"data-writer-slot-of-id":p,"data-writer-position":C})],w=E.value.filter(o(l)).filter(i),D=w.filter(C=>!C.isCodeManaged).map(C=>e(C.id,t,{contextSlot:l})),q=w.filter(C=>C.isCodeManaged).map(C=>e(C.id,t,{contextSlot:l}));return[...S(0),...D.map((C,F)=>[C,S(F+1)]).flat(),...q]},u=De(r);M(m.evaluatedFields,d),M(m.componentId,p),M(m.isBeingEdited,P),M(m.isDisabled,V),M(m.instancePath,r),M(m.instanceData,g),M(m.renderProxiedComponent,e),M(m.getChildrenVNodes,s),M(m.flattenedInstancePath,u);const $={"data-writer-id":p,"data-writer-instance-path":u},A=f(()=>n.getComponentDefinition(a.value.type)),K=f(()=>{var t;return(t=A.value)==null?void 0:t.fields}),G=x(!1);H(()=>c==null?void 0:c.isComponentIdSelected(p),t=>{G.value=t});const se=f(()=>Object.entries(K.value??{}).filter(([,t])=>t.category===me.Style).reduce((t,[l])=>(t[l]=d[l].value,t),{}));H(se,()=>G.value=!1);const Y=f(()=>E.value.length==0),ae=f(()=>y(p,r)),re=(t,l)=>{if((!t||!(t!=null&&t.startsWith("$goToPage_")))&&!l)return _=>{n.forwardEvent(_,r,!0)};if(t!=null&&t.startsWith("$goToPage_")){const _=t.substring(10);return S=>n.setActivePageFromKey(_)}return null},le=f(()=>{const t={};return Object.keys(A.value.events??{}).forEach(i=>{var w;const _=`on${i.charAt(0).toUpperCase()}${i.slice(1)}`,S=i===((w=a.value.binding)==null?void 0:w.eventType);t[_]=D=>{var C,F;S&&n.forwardEvent(D,r,!0);const q=((C=a.value.handlers)==null?void 0:C[i])??null;(F=re(q,S))==null||F(D)}}),t}),ie=f(()=>{const t=K.value;if(!t)return;const l={};return Object.keys(t).forEach(i=>{t[i].applyStyleVariable&&d[i]&&(l[`--${i}`]=d[i].value)}),l}),ce=f(()=>{const t="cssClasses",l=K.value;if(!l||!l[t]||!d[t])return;const i=String(d[t].value),_=i==null?void 0:i.split(" ").map(w=>w.trim()),S={};return _.forEach(w=>{S[w]=!0}),S}),de=function(){return{class:{[`wf-type-${a.value.type}`]:!0,component:!0,childless:Y.value,selected:G.value,disabled:V.value,beingEdited:P.value,...ce.value},style:{...ie.value,...ae.value?{}:{display:"none"}},...$,...V.value?[]:le.value,draggable:j.value}},ue=(t,l)=>P.value?B(Le,{...t,componentType:a.value.type,message:l}):B("div");return()=>{const t=P.value?z():void 0,l=({instanceNumber:_=0,slotName:S="default",componentFilter:w=()=>!0,positionlessSlot:D=!1})=>Y.value?D?void 0:t:s(_,S,w,D),i=de();return W(a.value.parentId,a.value.type)?B(h,i,{default:l}):ue(i,"Parent is not suitable for this component")}}},ne=X(We,[["__scopeId","data-v-5d7c306f"]]),qe={class:"counter"},Fe={class:"main"},He={class:"clearContainer"},Oe={class:"content"},je={class:"title"},ze={class:"time"},Ke={class:"message"},Ge=100,Ue=O({__name:"RendererNotifications",setup(b){const n=k(m.core),c=x(!1),p=ge("balloon"),a=ye([]),h=I=>{const{type:y,title:d,message:E,code:P}=I;a.unshift({type:y,title:d,message:E,code:P,timestampReceived:new Date}),a.splice(Ge),p.value.classList.remove("alert"),p.value.offsetWidth,p.value.classList.add("alert")};ee(()=>{n.addMailSubscription("notification",h)});const r=()=>{a.length!=0&&(c.value=!c.value)},g=()=>{a.splice(0),c.value=!1};return(I,y)=>J((T(),L("div",{class:"RendererNotifications colorTransformer",onClick:r},[v("div",{ref_key:"balloon",ref:p,class:"balloon",title:"Toggle notifications"},[y[0]||(y[0]=v("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),v("div",qe,R(a.length),1)],512),y[3]||(y[3]=v("div",{class:"balloonFlash"},null,-1)),J(v("div",Fe,[v("div",He,[te(Ce,{onClick:g},{default:_e(()=>y[1]||(y[1]=[v("i",{class:"material-symbols-outlined"}," clear_all ",-1),he(" Clear all ")])),_:1})]),(T(!0),L(be,null,Se(a,(d,E)=>(T(),L("div",{key:E,class:"notification"},[v("div",{class:oe(["icon",d.type])},y[2]||(y[2]=[v("i",{class:"material-symbols-outlined"}," exclamation ",-1)]),2),v("div",Oe,[v("header",null,[v("strong",je,R(d.title),1),v("span",ze,R(d.timestampReceived.toLocaleTimeString()),1)]),v("div",Ke,R(d.message),1)])]))),128))],512),[[N,c.value]])],512)),[[N,a.length>0]])}}),Xe=X(Ue,[["__scopeId","data-v-0ffb1f63"]]),Ye={class:"rootComponentArea"},Je=O({__name:"ComponentRenderer",setup(b){const n=k(m.core),c=k(m.builderManager),p=Z(n),a={},h=x({}),r=f(()=>(c==null?void 0:c.activeRootId.value)??"root");H(r,(e,o)=>{var u;h.value[o]=n.activePageId;const s=(u=h.value)==null?void 0:u[e];s&&n.setActivePageId(s)});const g=p.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),I=f(()=>{var e,o,s,u,$,A;return{...we,"--accentColor":(e=g.accentColor)==null?void 0:e.value,"--emptinessColor":(o=g.emptinessColor)==null?void 0:o.value,"--containerBackgroundColor":(s=g.parentIdBackgroundColor)==null?void 0:s.value,"--primaryTextColor":(u=g.primaryTextColor)==null?void 0:u.value,"--secondaryTextColor":($=g.secondaryTextColor)==null?void 0:$.value,"--separatorColor":(A=g.separatorColor)==null?void 0:A.value}}),y=f(()=>n.frontendMessageMap.value.size>0);H(()=>{var e;return(e=g.appName)==null?void 0:e.value},e=>{e!=""&&d(e)},{immediate:!0});function d(e){const o=n.mode.value;let s;e&&o=="edit"?s=`${e} | Writer | Builder`:!e&&o=="edit"?s="Writer | Builder":e&&o=="run"?s=`${e}`:!e&&o=="run"&&(s="Writer"),document.title=s}async function E(e,o){const s=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);s==null||s.remove();const u=document.createElement("link");u.dataset.writerStylesheetKey=e,u.setAttribute("href",o),u.setAttribute("rel","stylesheet"),document.head.appendChild(u)}async function P(e,o){const s=document.querySelector(`[data-writer-script-key="${e}"]`);s==null||s.remove();const u=document.createElement("script");u.dataset.writerScriptKey=e,u.src=o,u.setAttribute("rel","modulepreload"),document.head.appendChild(u)}async function j(e,o){a[e]=o,await Q(()=>import(o),[],import.meta.url)}async function W(e,o,s){const u=a[e],$=await Q(()=>import(u),[],import.meta.url);if(!$){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}$[o](...s)}function V(){n.addMailSubscription("fileDownload",e=>{const o=document.createElement("a");o.href=e.data,o.download=e.fileName,o.click()}),n.addMailSubscription("openUrl",e=>{const o=document.createElement("a");o.href=e,o.target="_blank",o.rel="noopener noreferrer",o.click()}),n.addMailSubscription("pageChange",async e=>{(c==null?void 0:c.getMode())==="workflows"&&c.setMode("ui"),await Me(),Te(e),n.setActivePageFromKey(e)}),n.addMailSubscription("routeVarsChange",e=>{ke(e)}),n.addMailSubscription("importStylesheet",({stylesheetKey:e,path:o})=>{E(e,o)}),n.addMailSubscription("importScript",({scriptKey:e,path:o})=>{P(e,o)}),n.addMailSubscription("importModule",({moduleKey:e,specifier:o})=>{j(e,o)}),n.addMailSubscription("functionCall",({moduleKey:e,functionName:o,args:s})=>{W(e,o,s)})}function z(){const e=$e(),o=new CustomEvent("wf-app-open",{detail:{payload:e}}),s={componentId:"root",instanceNumber:0};n.forwardEvent(o,[s],!0)}return Ie(()=>{V()}),ee(()=>{z()}),(e,o)=>(T(),L("main",{class:oe(["ComponentRenderer",{loadingActive:y.value}]),tabindex:"-1",style:Ee(I.value)},[te(Xe,{class:"notifications"}),o[0]||(o[0]=v("div",{class:"loadingBar"},null,-1)),v("div",Ye,[(T(),U(ne,{key:r.value,"component-id":r.value,"instance-path":[{componentId:r.value,instanceNumber:0}],"instance-data":[x(null)]},null,8,["component-id","instance-path","instance-data"])),Pe(e.$slots,"default",{},void 0,!0)])],6))}}),Ze=X(Je,[["__scopeId","data-v-a89144a8"]]);export{Ze as default};
