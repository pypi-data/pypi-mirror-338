{"version":3,"file":"4376.acf6c7546aa1ebca.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-form/ha-form-optional_actions.ts"],"sourcesContent":["import type { PropertyValues, TemplateResult } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { stopPropagation } from \"../../common/dom/stop_propagation\";\nimport type { LocalizeFunc } from \"../../common/translations/localize\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"./ha-form\";\nimport type {\n  HaFormOptionalActionsSchema,\n  HaFormDataContainer,\n  HaFormElement,\n  HaFormSchema,\n} from \"./types\";\n\nconst NO_ACTIONS = [];\n\n@customElement(\"ha-form-optional_actions\")\nexport class HaFormOptionalActions extends LitElement implements HaFormElement {\n  @property({ attribute: false }) public localize?: LocalizeFunc;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public data!: HaFormDataContainer;\n\n  @property({ attribute: false }) public schema!: HaFormOptionalActionsSchema;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ attribute: false }) public computeLabel?: (\n    schema: HaFormSchema,\n    data?: HaFormDataContainer\n  ) => string;\n\n  @property({ attribute: false }) public computeHelper?: (\n    schema: HaFormSchema\n  ) => string;\n\n  @property({ attribute: false }) public localizeValue?: (\n    key: string\n  ) => string;\n\n  @state() private _displayActions?: string[];\n\n  public async focus() {\n    await this.updateComplete;\n    this.renderRoot.querySelector(\"ha-form\")?.focus();\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (changedProps.has(\"data\")) {\n      const displayActions = this._displayActions ?? NO_ACTIONS;\n      const hiddenActions = this._hiddenActions(\n        this.schema.schema,\n        displayActions\n      );\n      this._displayActions = [\n        ...displayActions,\n        ...hiddenActions.filter((name) => name in this.data),\n      ];\n    }\n  }\n\n  private _hiddenActions = memoizeOne(\n    (schema: readonly HaFormSchema[], displayActions: string[]): string[] =>\n      schema\n        .map((item) => item.name)\n        .filter((name) => !displayActions.includes(name))\n  );\n\n  private _displaySchema = memoizeOne(\n    (\n      schema: readonly HaFormSchema[],\n      displayActions: string[]\n    ): HaFormSchema[] =>\n      schema.filter((item) => displayActions.includes(item.name))\n  );\n\n  public render(): TemplateResult {\n    const displayActions = this._displayActions ?? NO_ACTIONS;\n\n    const schema = this._displaySchema(\n      this.schema.schema,\n      this._displayActions ?? []\n    );\n\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      displayActions\n    );\n\n    const schemaMap = new Map<string, HaFormSchema>(\n      this.computeLabel\n        ? this.schema.schema.map((item) => [item.name, item])\n        : []\n    );\n\n    return html`\n      ${schema.length > 0\n        ? html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${this.data}\n              .schema=${schema}\n              .disabled=${this.disabled}\n              .computeLabel=${this.computeLabel}\n              .computeHelper=${this.computeHelper}\n              .localizeValue=${this.localizeValue}\n            ></ha-form>\n          `\n        : nothing}\n      ${hiddenActions.length > 0\n        ? html`\n            <ha-button-menu\n              @action=${this._handleAddAction}\n              fixed\n              @closed=${stopPropagation}\n            >\n              <ha-button slot=\"trigger\">\n                ${this.localize?.(\"ui.components.form-optional-actions.add\") ||\n                \"Add interaction\"}\n              </ha-button>\n              ${hiddenActions.map((action) => {\n                const actionSchema = schemaMap.get(action);\n                return html`\n                  <ha-list-item>\n                    ${this.computeLabel && actionSchema\n                      ? this.computeLabel(actionSchema)\n                      : action}\n                  </ha-list-item>\n                `;\n              })}\n            </ha-button-menu>\n          `\n        : nothing}\n    `;\n  }\n\n  private _handleAddAction(ev: CustomEvent) {\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      this._displayActions ?? NO_ACTIONS\n    );\n    const index = ev.detail.index;\n    const action = hiddenActions[index];\n    this._displayActions = [...(this._displayActions ?? []), action];\n  }\n\n  static styles = css`\n    :host {\n      display: flex !important;\n      flex-direction: column;\n      gap: 24px;\n    }\n    :host ha-form {\n      display: block;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-form-optional_actions\": HaFormOptionalActions;\n  }\n}\n"],"names":["NO_ACTIONS","HaFormOptionalActions","_decorate","customElement","_initialize","_LitElement","constructor","args","F","d","kind","decorators","property","attribute","key","value","type","Boolean","state","_this$renderRoot$quer","this","updateComplete","renderRoot","querySelector","focus","changedProps","_superPropGet","has","_this$_displayActions","displayActions","_displayActions","hiddenActions","_hiddenActions","schema","filter","name","data","memoizeOne","map","item","includes","_this$_displayActions2","_this$_displayActions3","_this$localize","_displaySchema","schemaMap","Map","computeLabel","html","_t","_","length","_t2","hass","disabled","computeHelper","localizeValue","nothing","_t3","_handleAddAction","stopPropagation","localize","call","action","actionSchema","get","_t4","ev","_this$_displayActions4","_this$_displayActions5","detail","index","static","css","_t5","LitElement"],"mappings":"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"}