{"version":3,"file":"6942.84e438fba260a15c.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/entity/ha-entity-attribute-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-attribute.ts"],"sourcesContent":["import type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { PropertyValues } from \"lit\";\nimport { LitElement, html, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { computeAttributeNameDisplay } from \"../../common/entity/compute_attribute_display\";\nimport type { HomeAssistant, ValueChangedEvent } from \"../../types\";\nimport \"../ha-combo-box\";\nimport type { HaComboBox } from \"../ha-combo-box\";\n\nexport type HaEntityPickerEntityFilterFunc = (entityId: HassEntity) => boolean;\n\n@customElement(\"ha-entity-attribute-picker\")\nclass HaEntityAttributePicker extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public entityId?: string;\n\n  /**\n   * List of attributes to be hidden.\n   * @type {Array}\n   * @attr hide-attributes\n   */\n  @property({ type: Array, attribute: \"hide-attributes\" })\n  public hideAttributes?: string[];\n\n  // eslint-disable-next-line lit/no-native-attributes\n  @property({ type: Boolean }) public autofocus = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property({ type: Boolean, attribute: \"allow-custom-value\" })\n  public allowCustomValue;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @state() private _opened = false;\n\n  @query(\"ha-combo-box\", true) private _comboBox!: HaComboBox;\n\n  protected shouldUpdate(changedProps: PropertyValues) {\n    return !(!changedProps.has(\"_opened\") && this._opened);\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    if (changedProps.has(\"_opened\") && this._opened) {\n      const entityState = this.entityId\n        ? this.hass.states[this.entityId]\n        : undefined;\n      (this._comboBox as any).items = entityState\n        ? Object.keys(entityState.attributes)\n            .filter((key) => !this.hideAttributes?.includes(key))\n            .map((key) => ({\n              value: key,\n              label: computeAttributeNameDisplay(\n                this.hass.localize,\n                entityState,\n                this.hass.entities,\n                key\n              ),\n            }))\n        : [];\n    }\n  }\n\n  protected render() {\n    if (!this.hass) {\n      return nothing;\n    }\n\n    return html`\n      <ha-combo-box\n        .hass=${this.hass}\n        .value=${this.value\n          ? computeAttributeNameDisplay(\n              this.hass.localize,\n              this.hass.states[this.entityId!],\n              this.hass.entities,\n              this.value\n            )\n          : \"\"}\n        .autofocus=${this.autofocus}\n        .label=${this.label ??\n        this.hass.localize(\n          \"ui.components.entity.entity-attribute-picker.attribute\"\n        )}\n        .disabled=${this.disabled || !this.entityId}\n        .required=${this.required}\n        .helper=${this.helper}\n        .allowCustomValue=${this.allowCustomValue}\n        item-value-path=\"value\"\n        item-label-path=\"label\"\n        @opened-changed=${this._openedChanged}\n        @value-changed=${this._valueChanged}\n      >\n      </ha-combo-box>\n    `;\n  }\n\n  private _openedChanged(ev: ValueChangedEvent<boolean>) {\n    this._opened = ev.detail.value;\n  }\n\n  private _valueChanged(ev: ValueChangedEvent<string>) {\n    this.value = ev.detail.value;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-entity-attribute-picker\": HaEntityAttributePicker;\n  }\n}\n","import type { PropertyValues } from \"lit\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport { fireEvent } from \"../../common/dom/fire_event\";\nimport type { AttributeSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../entity/ha-entity-attribute-picker\";\n\n@customElement(\"ha-selector-attribute\")\nexport class HaSelectorAttribute extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: AttributeSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @property({ attribute: false }) public context?: {\n    filter_entity?: string;\n  };\n\n  protected render() {\n    return html`\n      <ha-entity-attribute-picker\n        .hass=${this.hass}\n        .entityId=${this.selector.attribute?.entity_id ||\n        this.context?.filter_entity}\n        .hideAttributes=${this.selector.attribute?.hide_attributes}\n        .value=${this.value}\n        .label=${this.label}\n        .helper=${this.helper}\n        .disabled=${this.disabled}\n        .required=${this.required}\n        allow-custom-value\n      ></ha-entity-attribute-picker>\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (\n      // No need to filter value if no value\n      !this.value ||\n      // Only adjust value if we used the context\n      this.selector.attribute?.entity_id ||\n      // Only check if context has changed\n      !changedProps.has(\"context\")\n    ) {\n      return;\n    }\n\n    const oldContext = changedProps.get(\"context\") as this[\"context\"];\n\n    if (\n      !this.context ||\n      !oldContext ||\n      oldContext.filter_entity === this.context.filter_entity\n    ) {\n      return;\n    }\n\n    // Validate that that the attribute is still valid for this entity, else unselect.\n    let invalid = false;\n    if (this.context.filter_entity) {\n      const stateObj = this.hass.states[this.context.filter_entity];\n\n      if (!(stateObj && this.value in stateObj.attributes)) {\n        invalid = true;\n      }\n    } else {\n      invalid = this.value !== undefined;\n    }\n\n    if (invalid) {\n      fireEvent(this, \"value-changed\", {\n        value: undefined,\n      });\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-attribute\": HaSelectorAttribute;\n  }\n}\n"],"names":["_decorate","customElement","_initialize","_LitElement","F","constructor","args","d","kind","decorators","property","attribute","key","value","type","Array","Boolean","state","query","changedProps","has","this","_opened","entityState","entityId","hass","states","undefined","_comboBox","items","Object","keys","attributes","filter","_this$hideAttributes","hideAttributes","includes","map","label","computeAttributeNameDisplay","localize","entities","_this$label","html","_t","_","autofocus","disabled","required","helper","allowCustomValue","_openedChanged","_valueChanged","nothing","ev","detail","LitElement","HaSelectorAttribute","_this$selector$attrib","_this$context","_this$selector$attrib2","selector","entity_id","context","filter_entity","hide_attributes","_this$selector$attrib3","_superPropGet","oldContext","get","invalid","stateObj","fireEvent"],"mappings":"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"}