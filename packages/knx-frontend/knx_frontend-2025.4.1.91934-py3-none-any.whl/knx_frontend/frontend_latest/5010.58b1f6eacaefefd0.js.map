{"version":3,"file":"5010.58b1f6eacaefefd0.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/common/entity/compute_state_name.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-stt-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-stt.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/stt.ts"],"sourcesContent":["import type { HassEntity } from \"home-assistant-js-websocket\";\nimport { computeObjectId } from \"./compute_object_id\";\n\nexport const computeStateNameFromEntityAttributes = (\n  entityId: string,\n  attributes: Record<string, any>\n): string =>\n  attributes.friendly_name === undefined\n    ? computeObjectId(entityId).replace(/_/g, \" \")\n    : (attributes.friendly_name ?? \"\").toString();\n\nexport const computeStateName = (stateObj: HassEntity): string =>\n  computeStateNameFromEntityAttributes(stateObj.entity_id, stateObj.attributes);\n","import type { PropertyValues } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { computeStateName } from \"../common/entity/compute_state_name\";\nimport { debounce } from \"../common/util/debounce\";\nimport type { STTEngine } from \"../data/stt\";\nimport { listSTTEngines } from \"../data/stt\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-list-item\";\nimport \"./ha-select\";\nimport type { HaSelect } from \"./ha-select\";\nimport { computeDomain } from \"../common/entity/compute_domain\";\n\nconst NONE = \"__NONE_OPTION__\";\n\n@customElement(\"ha-stt-picker\")\nexport class HaSTTPicker extends LitElement {\n  @property() public value?: string;\n\n  @property() public label?: string;\n\n  @property() public language?: string;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean, reflect: true }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @state() _engines?: STTEngine[];\n\n  protected render() {\n    if (!this._engines) {\n      return nothing;\n    }\n\n    let value = this.value;\n    if (!value && this.required) {\n      for (const entity of Object.values(this.hass.entities)) {\n        if (\n          entity.platform === \"cloud\" &&\n          computeDomain(entity.entity_id) === \"stt\"\n        ) {\n          value = entity.entity_id;\n          break;\n        }\n      }\n\n      if (!value) {\n        for (const sttEngine of this._engines) {\n          if (sttEngine?.supported_languages?.length !== 0) {\n            value = sttEngine.engine_id;\n            break;\n          }\n        }\n      }\n    }\n    if (!value) {\n      value = NONE;\n    }\n\n    return html`\n      <ha-select\n        .label=${this.label ||\n        this.hass!.localize(\"ui.components.stt-picker.stt\")}\n        .value=${value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        @selected=${this._changed}\n        @closed=${stopPropagation}\n        fixedMenuPosition\n        naturalMenuWidth\n      >\n        ${!this.required\n          ? html`<ha-list-item .value=${NONE}>\n              ${this.hass!.localize(\"ui.components.stt-picker.none\")}\n            </ha-list-item>`\n          : nothing}\n        ${this._engines.map((engine) => {\n          if (engine.deprecated && engine.engine_id !== value) {\n            return nothing;\n          }\n          let label: string;\n          if (engine.engine_id.includes(\".\")) {\n            const stateObj = this.hass!.states[engine.engine_id];\n            label = stateObj ? computeStateName(stateObj) : engine.engine_id;\n          } else {\n            label = engine.name || engine.engine_id;\n          }\n          return html`<ha-list-item\n            .value=${engine.engine_id}\n            .disabled=${engine.supported_languages?.length === 0}\n          >\n            ${label}\n          </ha-list-item>`;\n        })}\n      </ha-select>\n    `;\n  }\n\n  protected willUpdate(changedProperties: PropertyValues<this>): void {\n    super.willUpdate(changedProperties);\n    if (!this.hasUpdated) {\n      this._updateEngines();\n    } else if (changedProperties.has(\"language\")) {\n      this._debouncedUpdateEngines();\n    }\n  }\n\n  private _debouncedUpdateEngines = debounce(() => this._updateEngines(), 500);\n\n  private async _updateEngines() {\n    this._engines = (\n      await listSTTEngines(\n        this.hass,\n        this.language,\n        this.hass.config.country || undefined\n      )\n    ).providers;\n\n    if (!this.value) {\n      return;\n    }\n\n    const selectedEngine = this._engines.find(\n      (engine) => engine.engine_id === this.value\n    );\n\n    fireEvent(this, \"supported-languages-changed\", {\n      value: selectedEngine?.supported_languages,\n    });\n\n    if (!selectedEngine || selectedEngine.supported_languages?.length === 0) {\n      this.value = undefined;\n      fireEvent(this, \"value-changed\", { value: this.value });\n    }\n  }\n\n  static styles = css`\n    ha-select {\n      width: 100%;\n    }\n  `;\n\n  private _changed(ev): void {\n    const target = ev.target as HaSelect;\n    if (\n      !this.hass ||\n      target.value === \"\" ||\n      target.value === this.value ||\n      (this.value === undefined && target.value === NONE)\n    ) {\n      return;\n    }\n    this.value = target.value === NONE ? undefined : target.value;\n    fireEvent(this, \"value-changed\", { value: this.value });\n    fireEvent(this, \"supported-languages-changed\", {\n      value: this._engines!.find((engine) => engine.engine_id === this.value)\n        ?.supported_languages,\n    });\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-stt-picker\": HaSTTPicker;\n  }\n}\n","import { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport type { STTSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-stt-picker\";\n\n@customElement(\"ha-selector-stt\")\nexport class HaSTTSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: STTSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  @property({ attribute: false }) public context?: {\n    language?: string;\n  };\n\n  protected render() {\n    return html`<ha-stt-picker\n      .hass=${this.hass}\n      .value=${this.value}\n      .label=${this.label}\n      .helper=${this.helper}\n      .language=${this.selector.stt?.language || this.context?.language}\n      .disabled=${this.disabled}\n      .required=${this.required}\n    ></ha-stt-picker>`;\n  }\n\n  static styles = css`\n    ha-stt-picker {\n      width: 100%;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-stt\": HaSTTSelector;\n  }\n}\n","import type { HomeAssistant } from \"../types\";\n\nexport interface SpeechMetadata {\n  language: string;\n  format: \"wav\" | \"ogg\";\n  codec: \"pcm\" | \"opus\";\n  bit_rate: 8 | 16 | 24 | 32;\n  sample_rate:\n    | 8000\n    | 11000\n    | 16000\n    | 18900\n    | 22000\n    | 32000\n    | 37800\n    | 44100\n    | 48000;\n  channel: 1 | 2;\n}\n\nexport interface STTEngine {\n  engine_id: string;\n  supported_languages?: string[];\n  name?: string;\n  deprecated: boolean;\n}\n\nexport const listSTTEngines = (\n  hass: HomeAssistant,\n  language?: string,\n  country?: string\n): Promise<{ providers: STTEngine[] }> =>\n  hass.callWS({\n    type: \"stt/engine/list\",\n    language,\n    country,\n  });\n"],"names":["computeStateName","stateObj","computeStateNameFromEntityAttributes","entityId","entity_id","undefined","attributes","friendly_name","computeObjectId","replace","toString","NONE","_decorate","customElement","_initialize","_LitElement","HaSTTPicker","constructor","args","F","d","kind","decorators","property","key","value","attribute","type","Boolean","reflect","state","this","_engines","nothing","required","entity","Object","values","hass","entities","platform","computeDomain","sttEngine","supported_languages","length","engine_id","html","label","localize","disabled","_changed","stopPropagation","map","engine","deprecated","includes","states","name","changedProperties","_superPropGet","hasUpdated","has","_debouncedUpdateEngines","_updateEngines","debounce","listSTTEngines","language","config","country","providers","selectedEngine","find","fireEvent","static","css","ev","target","LitElement","HaSTTSelector","helper","selector","stt","context","callWS"],"mappings":"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"}