{"version":3,"file":"3289.c4a373276416be22.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/common/datetime/seconds_to_duration.ts","webpack://knx-frontend/./homeassistant-frontend/src/data/timer.ts","webpack://knx-frontend/./homeassistant-frontend/src/common/datetime/duration_to_seconds.ts","webpack://knx-frontend/./homeassistant-frontend/src/state-display/ha-timer-remaining-time.ts"],"sourcesContent":["const leftPad = (num: number) => (num < 10 ? `0${num}` : num);\n\nexport default function secondsToDuration(d: number) {\n  const h = Math.floor(d / 3600);\n  const m = Math.floor((d % 3600) / 60);\n  const s = Math.floor((d % 3600) % 60);\n\n  if (h > 0) {\n    return `${h}:${leftPad(m)}:${leftPad(s)}`;\n  }\n  if (m > 0) {\n    return `${m}:${leftPad(s)}`;\n  }\n  if (s > 0) {\n    return \"\" + s;\n  }\n  return null;\n}\n","import type {\n  HassEntity,\n  HassEntityAttributeBase,\n  HassEntityBase,\n} from \"home-assistant-js-websocket\";\nimport durationToSeconds from \"../common/datetime/duration_to_seconds\";\nimport secondsToDuration from \"../common/datetime/seconds_to_duration\";\nimport type { HomeAssistant } from \"../types\";\n\nexport type TimerEntity = HassEntityBase & {\n  attributes: HassEntityAttributeBase & {\n    duration: string;\n    remaining: string;\n    restore: boolean;\n  };\n};\n\nexport interface DurationDict {\n  hours?: number | string;\n  minutes?: number | string;\n  seconds?: number | string;\n}\n\nexport interface Timer {\n  id: string;\n  name: string;\n  icon?: string;\n  duration?: string | number | DurationDict;\n  restore?: boolean;\n}\n\nexport interface TimerMutableParams {\n  name: string;\n  icon: string;\n  duration: string | number | DurationDict;\n  restore: boolean;\n}\n\nexport const fetchTimer = (hass: HomeAssistant) =>\n  hass.callWS<Timer[]>({ type: \"timer/list\" });\n\nexport const createTimer = (hass: HomeAssistant, values: TimerMutableParams) =>\n  hass.callWS<Timer>({\n    type: \"timer/create\",\n    ...values,\n  });\n\nexport const updateTimer = (\n  hass: HomeAssistant,\n  id: string,\n  updates: Partial<TimerMutableParams>\n) =>\n  hass.callWS<Timer>({\n    type: \"timer/update\",\n    timer_id: id,\n    ...updates,\n  });\n\nexport const deleteTimer = (hass: HomeAssistant, id: string) =>\n  hass.callWS({\n    type: \"timer/delete\",\n    timer_id: id,\n  });\n\nexport const timerTimeRemaining = (\n  stateObj: HassEntity\n): undefined | number => {\n  if (!stateObj.attributes.remaining) {\n    return undefined;\n  }\n  let timeRemaining = durationToSeconds(stateObj.attributes.remaining);\n\n  if (stateObj.state === \"active\") {\n    const now = new Date().getTime();\n    const finishes = new Date(stateObj.attributes.finishes_at).getTime();\n    timeRemaining = Math.max((finishes - now) / 1000, 0);\n  }\n\n  return timeRemaining;\n};\n\nexport const computeDisplayTimer = (\n  hass: HomeAssistant,\n  stateObj: HassEntity,\n  timeRemaining?: number\n): string | null => {\n  if (!stateObj) {\n    return null;\n  }\n\n  if (stateObj.state === \"idle\" || timeRemaining === 0) {\n    return hass.formatEntityState(stateObj);\n  }\n\n  let display = secondsToDuration(timeRemaining || 0) || \"0\";\n\n  if (stateObj.state === \"paused\") {\n    display = `${display} (${hass.formatEntityState(stateObj)})`;\n  }\n\n  return display;\n};\n","export default function durationToSeconds(duration: string): number {\n  const parts = duration.split(\":\").map(Number);\n  return parts[0] * 3600 + parts[1] * 60 + parts[2];\n}\n","import type { HassEntity } from \"home-assistant-js-websocket\";\nimport type { PropertyValues } from \"lit\";\nimport { ReactiveElement } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { computeDisplayTimer, timerTimeRemaining } from \"../data/timer\";\nimport type { HomeAssistant } from \"../types\";\n\n@customElement(\"ha-timer-remaining-time\")\nclass HaTimerRemainingTime extends ReactiveElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public stateObj!: HassEntity;\n\n  @state() private timeRemaining?: number;\n\n  private _updateRemaining: any;\n\n  protected createRenderRoot() {\n    return this;\n  }\n\n  protected update(changedProps: PropertyValues) {\n    super.update(changedProps);\n    this.innerHTML =\n      computeDisplayTimer(this.hass, this.stateObj, this.timeRemaining) ?? \"-\";\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    if (this.stateObj) {\n      this._startInterval(this.stateObj);\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._clearInterval();\n  }\n\n  protected willUpdate(changedProp: PropertyValues): void {\n    super.willUpdate(changedProp);\n    if (changedProp.has(\"stateObj\")) {\n      this._startInterval(this.stateObj);\n    }\n  }\n\n  private _clearInterval() {\n    if (this._updateRemaining) {\n      clearInterval(this._updateRemaining);\n      this._updateRemaining = null;\n    }\n  }\n\n  private _startInterval(stateObj: HassEntity) {\n    this._clearInterval();\n    this._calculateRemaining(stateObj);\n\n    if (stateObj.state === \"active\") {\n      this._updateRemaining = setInterval(\n        () => this._calculateRemaining(this.stateObj),\n        1000\n      );\n    }\n  }\n\n  private _calculateRemaining(stateObj: HassEntity) {\n    this.timeRemaining = timerTimeRemaining(stateObj);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-timer-remaining-time\": HaTimerRemainingTime;\n  }\n}\n"],"names":["leftPad","num","secondsToDuration","d","h","Math","floor","m","s","createTimer","hass","values","callWS","type","timerTimeRemaining","stateObj","attributes","remaining","timeRemaining","duration","parts","split","map","Number","durationToSeconds","state","now","Date","getTime","finishes","finishes_at","max","computeDisplayTimer","formatEntityState","display","_decorate","customElement","_initialize","_ReactiveElement","HaTimerRemainingTime","constructor","args","F","kind","decorators","property","attribute","key","value","this","changedProps","_superPropGet","innerHTML","_startInterval","_clearInterval","changedProp","has","_updateRemaining","clearInterval","_calculateRemaining","setInterval","ReactiveElement"],"mappings":"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"}