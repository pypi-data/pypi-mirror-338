{"version":3,"file":"4376.d0786b9b3f2e1040.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/components/ha-form/ha-form-optional_actions.ts"],"sourcesContent":["import type { PropertyValues, TemplateResult } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { stopPropagation } from \"../../common/dom/stop_propagation\";\nimport type { LocalizeFunc } from \"../../common/translations/localize\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"./ha-form\";\nimport type {\n  HaFormOptionalActionsSchema,\n  HaFormDataContainer,\n  HaFormElement,\n  HaFormSchema,\n} from \"./types\";\n\nconst NO_ACTIONS = [];\n\n@customElement(\"ha-form-optional_actions\")\nexport class HaFormOptionalActions extends LitElement implements HaFormElement {\n  @property({ attribute: false }) public localize?: LocalizeFunc;\n\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public data!: HaFormDataContainer;\n\n  @property({ attribute: false }) public schema!: HaFormOptionalActionsSchema;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ attribute: false }) public computeLabel?: (\n    schema: HaFormSchema,\n    data?: HaFormDataContainer\n  ) => string;\n\n  @property({ attribute: false }) public computeHelper?: (\n    schema: HaFormSchema\n  ) => string;\n\n  @property({ attribute: false }) public localizeValue?: (\n    key: string\n  ) => string;\n\n  @state() private _displayActions?: string[];\n\n  public async focus() {\n    await this.updateComplete;\n    this.renderRoot.querySelector(\"ha-form\")?.focus();\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (changedProps.has(\"data\")) {\n      const displayActions = this._displayActions ?? NO_ACTIONS;\n      const hiddenActions = this._hiddenActions(\n        this.schema.schema,\n        displayActions\n      );\n      this._displayActions = [\n        ...displayActions,\n        ...hiddenActions.filter((name) => name in this.data),\n      ];\n    }\n  }\n\n  private _hiddenActions = memoizeOne(\n    (schema: readonly HaFormSchema[], displayActions: string[]): string[] =>\n      schema\n        .map((item) => item.name)\n        .filter((name) => !displayActions.includes(name))\n  );\n\n  private _displaySchema = memoizeOne(\n    (\n      schema: readonly HaFormSchema[],\n      displayActions: string[]\n    ): HaFormSchema[] =>\n      schema.filter((item) => displayActions.includes(item.name))\n  );\n\n  public render(): TemplateResult {\n    const displayActions = this._displayActions ?? NO_ACTIONS;\n\n    const schema = this._displaySchema(\n      this.schema.schema,\n      this._displayActions ?? []\n    );\n\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      displayActions\n    );\n\n    const schemaMap = new Map<string, HaFormSchema>(\n      this.computeLabel\n        ? this.schema.schema.map((item) => [item.name, item])\n        : []\n    );\n\n    return html`\n      ${schema.length > 0\n        ? html`\n            <ha-form\n              .hass=${this.hass}\n              .data=${this.data}\n              .schema=${schema}\n              .disabled=${this.disabled}\n              .computeLabel=${this.computeLabel}\n              .computeHelper=${this.computeHelper}\n              .localizeValue=${this.localizeValue}\n            ></ha-form>\n          `\n        : nothing}\n      ${hiddenActions.length > 0\n        ? html`\n            <ha-button-menu\n              @action=${this._handleAddAction}\n              fixed\n              @closed=${stopPropagation}\n            >\n              <ha-button slot=\"trigger\">\n                ${this.localize?.(\"ui.components.form-optional-actions.add\") ||\n                \"Add interaction\"}\n              </ha-button>\n              ${hiddenActions.map((action) => {\n                const actionSchema = schemaMap.get(action);\n                return html`\n                  <ha-list-item>\n                    ${this.computeLabel && actionSchema\n                      ? this.computeLabel(actionSchema)\n                      : action}\n                  </ha-list-item>\n                `;\n              })}\n            </ha-button-menu>\n          `\n        : nothing}\n    `;\n  }\n\n  private _handleAddAction(ev: CustomEvent) {\n    const hiddenActions = this._hiddenActions(\n      this.schema.schema,\n      this._displayActions ?? NO_ACTIONS\n    );\n    const index = ev.detail.index;\n    const action = hiddenActions[index];\n    this._displayActions = [...(this._displayActions ?? []), action];\n  }\n\n  static styles = css`\n    :host {\n      display: flex !important;\n      flex-direction: column;\n      gap: 24px;\n    }\n    :host ha-form {\n      display: block;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-form-optional_actions\": HaFormOptionalActions;\n  }\n}\n"],"names":["NO_ACTIONS","HaFormOptionalActions","_decorate","customElement","_initialize","_LitElement","constructor","args","F","d","kind","decorators","property","attribute","key","value","type","Boolean","state","this","updateComplete","renderRoot","querySelector","focus","changedProps","_superPropGet","has","displayActions","_displayActions","hiddenActions","_hiddenActions","schema","filter","name","data","memoizeOne","map","item","includes","_displaySchema","schemaMap","Map","computeLabel","html","length","hass","disabled","computeHelper","localizeValue","nothing","_handleAddAction","stopPropagation","localize","action","actionSchema","get","ev","detail","index","static","css","LitElement"],"mappings":"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"}