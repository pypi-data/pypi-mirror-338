{"version":3,"file":"592.e64296c5d8800151.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/data/supervisor/mounts.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-mount-picker.ts","webpack://knx-frontend/./homeassistant-frontend/src/components/ha-selector/ha-selector-backup-location.ts"],"sourcesContent":["import type { HomeAssistant } from \"../../types\";\n\nexport enum SupervisorMountType {\n  BIND = \"bind\",\n  CIFS = \"cifs\",\n  NFS = \"nfs\",\n}\n\nexport enum SupervisorMountUsage {\n  BACKUP = \"backup\",\n  MEDIA = \"media\",\n  SHARE = \"share\",\n}\n\nexport enum SupervisorMountState {\n  ACTIVE = \"active\",\n  FAILED = \"failed\",\n  UNKNOWN = \"unknown\",\n}\n\ninterface MountOptions {\n  default_backup_mount?: string | null;\n}\n\nexport type CIFSVersion = \"auto\" | \"1.0\" | \"2.0\";\n\ninterface SupervisorMountBase {\n  name: string;\n  usage: SupervisorMountUsage;\n  type: SupervisorMountType;\n  server: string;\n  port: number;\n}\n\nexport interface SupervisorMountResponse extends SupervisorMountBase {\n  state: SupervisorMountState | null;\n}\n\nexport interface SupervisorNFSMount extends SupervisorMountResponse {\n  type: SupervisorMountType.NFS;\n  path: string;\n}\n\nexport interface SupervisorCIFSMount extends SupervisorMountResponse {\n  type: SupervisorMountType.CIFS;\n  share: string;\n  version?: CIFSVersion;\n}\n\nexport type SupervisorMount = SupervisorNFSMount | SupervisorCIFSMount;\n\nexport type SupervisorNFSMountRequestParams = SupervisorNFSMount;\n\nexport interface SupervisorCIFSMountRequestParams extends SupervisorCIFSMount {\n  username?: string;\n  password?: string;\n  version?: CIFSVersion;\n}\n\nexport type SupervisorMountRequestParams =\n  | SupervisorNFSMountRequestParams\n  | SupervisorCIFSMountRequestParams;\n\nexport interface SupervisorMounts {\n  default_backup_mount: string | null;\n  mounts: SupervisorMount[];\n}\n\nexport const fetchSupervisorMounts = async (\n  hass: HomeAssistant\n): Promise<SupervisorMounts> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts`,\n    method: \"get\",\n    timeout: null,\n  });\n\nexport const createSupervisorMount = async (\n  hass: HomeAssistant,\n  data: SupervisorMountRequestParams\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts`,\n    method: \"post\",\n    timeout: null,\n    data,\n  });\n\nexport const updateSupervisorMount = async (\n  hass: HomeAssistant,\n  data: Partial<SupervisorMountRequestParams>\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/${data.name}`,\n    method: \"put\",\n    timeout: null,\n    data,\n  });\n\nexport const removeSupervisorMount = async (\n  hass: HomeAssistant,\n  name: string\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/${name}`,\n    method: \"delete\",\n    timeout: null,\n  });\n\nexport const reloadSupervisorMount = async (\n  hass: HomeAssistant,\n  data: SupervisorMount\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/${data.name}/reload`,\n    method: \"post\",\n    timeout: null,\n  });\n\nexport const changeMountOptions = async (\n  hass: HomeAssistant,\n  data: MountOptions\n): Promise<void> =>\n  hass.callWS({\n    type: \"supervisor/api\",\n    endpoint: `/mounts/options`,\n    method: \"post\",\n    timeout: null,\n    data,\n  });\n","import { mdiBackupRestore, mdiFolder, mdiHarddisk, mdiPlayBox } from \"@mdi/js\";\nimport type { CSSResultGroup } from \"lit\";\nimport { css, html, LitElement, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { isComponentLoaded } from \"../common/config/is_component_loaded\";\nimport { fireEvent } from \"../common/dom/fire_event\";\nimport { stopPropagation } from \"../common/dom/stop_propagation\";\nimport { caseInsensitiveStringCompare } from \"../common/string/compare\";\nimport type { SupervisorMounts } from \"../data/supervisor/mounts\";\nimport {\n  fetchSupervisorMounts,\n  SupervisorMountType,\n  SupervisorMountUsage,\n} from \"../data/supervisor/mounts\";\nimport type { HomeAssistant } from \"../types\";\nimport \"./ha-alert\";\nimport \"./ha-list-item\";\nimport \"./ha-select\";\nimport type { HaSelect } from \"./ha-select\";\n\nconst _BACKUP_DATA_DISK_ = \"/backup\";\n\n@customElement(\"ha-mount-picker\")\nclass HaMountPicker extends LitElement {\n  public hass!: HomeAssistant;\n\n  @property() public label?: string;\n\n  @property() public value?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = false;\n\n  @property() public usage?: SupervisorMountUsage;\n\n  @state() private _mounts?: SupervisorMounts;\n\n  @state() private _error?: string;\n\n  protected firstUpdated() {\n    this._getMounts();\n  }\n\n  protected render() {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    if (!this._mounts) {\n      return nothing;\n    }\n    const dataDiskOption = html`<ha-list-item\n      graphic=\"icon\"\n      .value=${_BACKUP_DATA_DISK_}\n    >\n      <span>\n        ${this.hass.localize(\"ui.components.mount-picker.use_datadisk\") ||\n        \"Use data disk for backup\"}\n      </span>\n      <ha-svg-icon slot=\"graphic\" .path=${mdiHarddisk}></ha-svg-icon>\n    </ha-list-item>`;\n    return html`\n      <ha-select\n        .label=${this.label === undefined && this.hass\n          ? this.hass.localize(\"ui.components.mount-picker.mount\")\n          : this.label}\n        .value=${this._value}\n        .required=${this.required}\n        .disabled=${this.disabled}\n        .helper=${this.helper}\n        @selected=${this._mountChanged}\n        @closed=${stopPropagation}\n        fixedMenuPosition\n        naturalMenuWidth\n      >\n        ${this.usage === SupervisorMountUsage.BACKUP &&\n        (!this._mounts.default_backup_mount ||\n          this._mounts.default_backup_mount === _BACKUP_DATA_DISK_)\n          ? dataDiskOption\n          : nothing}\n        ${this._filterMounts(this._mounts, this.usage).map(\n          (mount) =>\n            html`<ha-list-item twoline graphic=\"icon\" .value=${mount.name}>\n              <span>${mount.name}</span>\n              <span slot=\"secondary\"\n                >${mount.server}${mount.port\n                  ? `:${mount.port}`\n                  : nothing}${mount.type === SupervisorMountType.NFS\n                  ? mount.path\n                  : `:${mount.share}`}</span\n              >\n              <ha-svg-icon\n                slot=\"graphic\"\n                .path=${mount.usage === SupervisorMountUsage.MEDIA\n                  ? mdiPlayBox\n                  : mount.usage === SupervisorMountUsage.SHARE\n                    ? mdiFolder\n                    : mdiBackupRestore}\n              ></ha-svg-icon>\n            </ha-list-item>`\n        )}\n        ${this.usage === SupervisorMountUsage.BACKUP &&\n        this._mounts.default_backup_mount\n          ? dataDiskOption\n          : nothing}\n      </ha-select>\n    `;\n  }\n\n  private _filterMounts = memoizeOne(\n    (mounts: SupervisorMounts, usage: this[\"usage\"]) => {\n      let filteredMounts = mounts.mounts.filter((mount) =>\n        [SupervisorMountType.CIFS, SupervisorMountType.NFS].includes(mount.type)\n      );\n      if (usage) {\n        filteredMounts = mounts.mounts.filter((mount) => mount.usage === usage);\n      }\n      return filteredMounts.sort((mountA, mountB) => {\n        if (mountA.name === mounts.default_backup_mount) {\n          return -1;\n        }\n        if (mountB.name === mounts.default_backup_mount) {\n          return 1;\n        }\n        return caseInsensitiveStringCompare(\n          mountA.name,\n          mountB.name,\n          this.hass.locale.language\n        );\n      });\n    }\n  );\n\n  private async _getMounts() {\n    try {\n      if (isComponentLoaded(this.hass, \"hassio\")) {\n        this._mounts = await fetchSupervisorMounts(this.hass);\n        if (this.usage === SupervisorMountUsage.BACKUP && !this.value) {\n          this.value = this._mounts.default_backup_mount || _BACKUP_DATA_DISK_;\n        }\n      } else {\n        this._error = this.hass.localize(\n          \"ui.components.mount-picker.error.no_supervisor\"\n        );\n      }\n    } catch (_err: any) {\n      this._error = this.hass.localize(\n        \"ui.components.mount-picker.error.fetch_mounts\"\n      );\n    }\n  }\n\n  private get _value() {\n    return this.value || \"\";\n  }\n\n  private _mountChanged(ev: Event) {\n    ev.stopPropagation();\n    const target = ev.target as HaSelect;\n    const newValue = target.value;\n\n    if (newValue !== this._value) {\n      this._setValue(newValue);\n    }\n  }\n\n  private _setValue(value: string) {\n    this.value = value;\n    setTimeout(() => {\n      fireEvent(this, \"value-changed\", { value });\n      fireEvent(this, \"change\");\n    }, 0);\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      css`\n        ha-select {\n          width: 100%;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-mount-picker\": HaMountPicker;\n  }\n}\n","import { css, html, LitElement } from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\nimport type { BackupLocationSelector } from \"../../data/selector\";\nimport type { HomeAssistant } from \"../../types\";\nimport \"../ha-mount-picker\";\n\n@customElement(\"ha-selector-backup_location\")\nexport class HaBackupLocationSelector extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public selector!: BackupLocationSelector;\n\n  @property() public value?: any;\n\n  @property() public label?: string;\n\n  @property() public helper?: string;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public required = true;\n\n  protected render() {\n    return html`<ha-mount-picker\n      .hass=${this.hass}\n      .value=${this.value}\n      .label=${this.label}\n      .helper=${this.helper}\n      .disabled=${this.disabled}\n      .required=${this.required}\n      usage=\"backup\"\n    ></ha-mount-picker>`;\n  }\n\n  static styles = css`\n    ha-mount-picker {\n      width: 100%;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-selector-backup_location\": HaBackupLocationSelector;\n  }\n}\n"],"names":["SupervisorMountType","SupervisorMountUsage","_BACKUP_DATA_DISK_","_decorate","customElement","_initialize","_LitElement","F","constructor","args","d","kind","key","value","decorators","property","type","Boolean","state","this","_getMounts","_error","html","_t","_","_mounts","nothing","dataDiskOption","_t2","hass","localize","_t3","undefined","label","_value","required","disabled","helper","_mountChanged","stopPropagation","usage","default_backup_mount","_filterMounts","map","mount","_t4","name","server","port","path","share","memoizeOne","mounts","filteredMounts","filter","includes","sort","mountA","mountB","caseInsensitiveStringCompare","locale","language","isComponentLoaded","async","callWS","endpoint","method","timeout","fetchSupervisorMounts","_err","ev","newValue","target","_setValue","setTimeout","fireEvent","static","css","_t5","LitElement","HaBackupLocationSelector","attribute"],"mappings":"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"}