{"version":3,"file":"669.3be80f7745f151fd.js","sources":["webpack://knx-frontend/./homeassistant-frontend/src/dialogs/config-flow/previews/flow-preview-generic.ts"],"sourcesContent":["import type { HassEntity, UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { LitElement, html } from \"lit\";\nimport type { nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport type { FlowType } from \"../../../data/data_entry_flow\";\nimport type { GenericPreview } from \"../../../data/preview\";\nimport { subscribePreviewGeneric } from \"../../../data/preview\";\nimport type { HomeAssistant } from \"../../../types\";\nimport \"./entity-preview-row\";\nimport { debounce } from \"../../../common/util/debounce\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport \"../../../components/ha-alert\";\n\n@customElement(\"flow-preview-generic\")\nexport class FlowPreviewGeneric extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ attribute: false }) public flowType!: FlowType;\n\n  public handler!: string;\n\n  @property() public domain!: string;\n\n  @property({ attribute: false }) public stepId!: string;\n\n  @property({ attribute: false }) public flowId!: string;\n\n  @property({ attribute: false }) public stepData!: Record<string, any>;\n\n  @state() protected _preview?: HassEntity;\n\n  @state() protected _error?: string;\n\n  private _unsub?: Promise<UnsubscribeFunc>;\n\n  disconnectedCallback(): void {\n    super.disconnectedCallback();\n    if (this._unsub) {\n      this._unsub.then((unsub) => unsub());\n      this._unsub = undefined;\n    }\n  }\n\n  willUpdate(changedProps) {\n    if (changedProps.has(\"stepData\")) {\n      this._debouncedSubscribePreview();\n    }\n  }\n\n  protected render(): TemplateResult | typeof nothing {\n    if (this._error) {\n      return html`<ha-alert alert-type=\"error\">${this._error}</ha-alert>`;\n    }\n    return html`<entity-preview-row\n      .hass=${this.hass}\n      .stateObj=${this._preview}\n    ></entity-preview-row>`;\n  }\n\n  private _setPreview = (preview: GenericPreview) => {\n    const now = new Date().toISOString();\n    this._preview = {\n      entity_id: `${this.stepId}.___flow_preview___`,\n      last_changed: now,\n      last_updated: now,\n      context: { id: \"\", parent_id: null, user_id: null },\n      ...preview,\n    };\n  };\n\n  private _debouncedSubscribePreview = debounce(() => {\n    this._subscribePreview();\n  }, 250);\n\n  private async _subscribePreview() {\n    if (this._unsub) {\n      (await this._unsub)();\n      this._unsub = undefined;\n    }\n    if (this.flowType !== \"config_flow\" && this.flowType !== \"options_flow\") {\n      return;\n    }\n    try {\n      this._unsub = subscribePreviewGeneric(\n        this.hass,\n        this.domain,\n        this.flowId,\n        this.flowType,\n        this.stepData,\n        this._setPreview\n      );\n      fireEvent(this, \"set-flow-errors\", { errors: {} });\n    } catch (err: any) {\n      if (typeof err.message === \"string\") {\n        this._error = err.message;\n      } else {\n        this._error = undefined;\n        fireEvent(this, \"set-flow-errors\", err.message);\n      }\n      this._unsub = undefined;\n      this._preview = undefined;\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"flow-preview-generic\": FlowPreviewGeneric;\n  }\n}\n"],"names":["FlowPreviewGeneric","_decorate","customElement","_initialize","_LitElement","constructor","args","F","d","kind","decorators","property","attribute","key","value","state","_superPropGet","this","_unsub","then","unsub","undefined","changedProps","has","_debouncedSubscribePreview","_error","html","_t","_","_t2","hass","_preview","preview","now","Date","toISOString","Object","assign","entity_id","stepId","last_changed","last_updated","context","id","parent_id","user_id","debounce","_subscribePreview","flowType","subscribePreviewGeneric","domain","flowId","stepData","_setPreview","fireEvent","errors","err","message","LitElement"],"mappings":"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"}